<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width; initial-scale=1; maximum-scale=1; user-scalable=1; interactive-widget=resizes-content;"/>
		<title>Ägir</title>
		<link rel="icon" href="favicon.png" />
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400..500&display=swap" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400..500&display=swap" rel="stylesheet">
		
		<link rel="stylesheet" href="assets/css/main.css"/>
		<link rel="stylesheet" href="assets/css/theme.css"/>
		<link rel="stylesheet" href="assets/css/utils.css"/>
		<link rel="stylesheet" href="assets/css/components.css"/>
		<link rel="stylesheet" href="assets/css/md.css"/>
		<script type="module" src="assets/index.js"></script>

		<link rel="prefetch" href="assets/gfx/send.svg" />
		<link rel="prefetch" href="assets/gfx/placeholder.png" />
	</head>

	<body>
		<ram-tabs id="tabs-main" tab="chats">
			<ram-tab key="chats">
				<div class="topbar row shadow">
					<button class="lineout fit" data-to="settings">settings</button>
					<button class="lineout fit" data-to="library">characters</button>
					<ram-file-picker id="main-import" accept=".aegir.chat.json" class="float-end">
						<div class="lineout fit">import chat</div>
					</ram-file-picker>
				</div>
				<div class="main col pad float-center">
					<div id="main-chats" class="list"></div>
				</div>
			</ram-tab>
			<ram-tab key="settings">
				<div class="topbar row shadow">
					<button class="lineout fit" data-to="chats">back</button>
				</div>
				<div class="main col pad float-center">
					<details>
						<summary class="settings-label">
							Personas
						</summary>
						<div id="settings-persona-form" class="list">
							<div id="settings-persona-list" class="virtual"></div>
							<hr id="settings-persona-divider" class="topbar-scroll-offset"/>
							<div class="row">
								<ram-image-picker id="settings-persona-picture" class="lineout pointer"></ram-image-picker>
								<div class="list wide">
									<input type="text" id="settings-persona-name" class="lineout wide" placeholder="Persona name" />
									<select id="settings-persona-pronouns" class="lineout">
										<option value="he">he/him</option>
										<option value="she">she/her</option>
										<option value="they" selected>they/them</option>
									</select>
								</div>
							</div>
							<textarea id="settings-persona-desc" class="lineout" placeholder="Persona description"></textarea>
							<button id="settings-add-persona" class="lineout">Save persona</button>
						</div>
					</details>
					<details>
						<summary class="settings-label">
							Engines
						</summary>
						<div class="list">
							<div class="hint">
								Click engine entry to edit
							</div>
							<div id="settings-engines-list" class="virtual">
							</div>
							<hr id="settings-engines-divider" class="topbar-scroll-offset" />
							<div class="hint">
								Any OpenAI-compatible LLM provider is supported, including OpenRouter and AI Horde
							</div>
							<ram-labeled
								legend="Display name"
								id="settings-engines-name"
								class="strip wide"
								placeholder="Goober"
							></ram-labeled>
							<ram-labeled
								legend="API URL"
								id="settings-engines-url"
								class="strip wide"
								placeholder="https://openrouter.ai/api/v1/chat/completions"
							></ram-labeled>
							<ram-labeled
								legend="API key"
								id="settings-engines-key"
								class="strip wide"
								placeholder="sk-or-v1-haha-nope"
							></ram-labeled>
							<ram-labeled
								legend="Model"
								id="settings-engines-model"
								class="strip wide"
								placeholder="xiaomi/mimo-v2-flash:free"
							></ram-labeled>
							<hr/>
							<div class="hint">
								Temperature controls randomness. Lower = focused, higher = creative
							</div>
							<ram-labeled
								legend="Temperature (0.0-2.0)"
								id="settings-engines-temp"
								class="strip wide"
								placeholder="0.9"
								value="0.9"
							></ram-labeled>
							<ram-labeled
								legend="Response length limit (in tokens, 0 = unlimited)"
								id="settings-engines-max"
								class="strip wide"
								placeholder="720"
								value="720"
							></ram-labeled>
							<div class="hint">
								A JSON object containing additional API request parameters. Refer to docs: <a href="https://platform.openai.com/docs/api-reference/chat/create">[OpenAI]</a>, <a href="https://openrouter.ai/docs/api/api-reference/chat/send-chat-completion-request">[OpenRouter]</a>
							</div>
							<div class="hint">
								Note: streaming is enabled and required
							</div>
							<ram-labeled
								legend="Additional parameters"
								id="settings-engines-additional"
								class="strip wide"
								placeholder='{ "top_p": 0.7 }'
								value=""
								multiline
							></ram-labeled>
							<button id="settings-engines-submit" class="lineout">Save engine</button>
						</div>
					</details>
					<details>
						<summary class="settings-label">
							Backup & Sync
						</summary>
						<div class="row-wrap">
							<button id="settings-backup-save" class="lineout fit">Save all</button>
							<ram-file-picker id="settings-backup-import" accept=".aegir.backup.json">
								<div class="lineout fit">Restore</div>
							</ram-file-picker>
						</div>
					</details>
					<details>
						<summary class="settings-label">
							Other options
						</summary>
						<div class="list">
							<div class="hint">Max count of messages to send to API. 0 to send all (not recommended due to potential context overflow)</div>
							<ram-labeled
								legend="Chat tail length"
								id="settings-options-tail"
								class="strip wide"
								placeholder="70"
							></ram-labeled>
							<button id="settings-misc-save" class="lineout">Save</button>
							<div>Theme:</div>
							<div id="settings-themes" class="row-wrap"></div>
						</div>
					</details>
				</div>
			</ram-tab>
			<ram-tab key="library">
				<div class="topbar row shadow">
					<button class="lineout fit" data-to="chats">back</button>
					<button class="lineout fit float-end" data-to="scenario-editor">new scenario</button>
					<ram-file-picker id="library-import" accept=".aegir.scenario.json" multiple>
						<div class="lineout fit">import scenario</div>
					</ram-file-picker>
				</div>
				<div id="library-cards" class="grid-list"></div>
			</ram-tab>
			<ram-tab key="scenario-editor">
				<div class="topbar row shadow">
					<button class="lineout fit" data-to="library">back</button>
					<button id="scenario-submit-button" class="lineout">save scenario</button>
				</div>
				<div class="main col pad float-center low-pad">
					<div class="scenario-pictures">
						<div class="list">
							<div>Card icon</div>
							<ram-image-picker id="scenario-card-picture" class="lineout pointer"></ram-image-picker>
						</div>
						<div class="list">
							<div>Chat icon</div>
							<ram-image-picker id="scenario-chat-picture" class="lineout pointer"></ram-image-picker>
						</div>
					</div>
					
					<ram-labeled
						legend="Card title"
						id="scenario-card-title"
						class="strip wide"
						placeholder=""
					></ram-labeled>
					<ram-labeled
						legend="Card description"
						id="scenario-description"
						class="strip wide"
						placeholder=""
						multiline
					></ram-labeled>
					<button id="scenario-preview-button" class="lineout">Card description preview</button>
					<div id="scenario-preview" class="lineout" hidden></div>
					<ram-labeled
						legend="Tags (comma separated)"
						id="scenario-tags"
						class="strip wide"
						placeholder=""
						multiline
						rows="1"
					></ram-labeled>
					<div class="list">
						<hr/>
						<div class="hint">Character definiton below</div>
					</div>
					<details>
						<summary>
							Macros
						</summary>
						<div class="lineout">
							Important!
							<div class="hint">
								<dl>
									<dt>{{persona}}</dt> <dd>User's persona description</dd>
								</dl>
							</div>
							Names:
							<div class="hint">
								<dl>
									<dt>{{char}}</dt> <dd>Character name</dd>
									<dt>{{user}}</dt> <dd>User's persona name</dd>
								</dl>
							</div>
							User's persona pronouns:
							<div class="hint">
								<dl>
									<dt>{{sub}}</dt>    <dd>subjective (he/she/they)</dd>
									<dt>{{obj}}</dt>    <dd>objective (him/her/them)</dd>
									<dt>{{poss}}</dt>   <dd>possessive (his/her/their)</dd>
									<dt>{{poss_p}}</dt> <dd>possessive pronoun (his/hers/theirs)</dd>
									<dt>{{ref}}</dt>    <dd>reflexive (himself/herself/themselves)</dd>
								</dl>
							</div>
						</div>
					</details>
					<ram-labeled
						legend="Character name (shown in chat)"
						id="scenario-character-name"
						class="strip wide"
						placeholder="Ägir"
					></ram-labeled>
					<ram-labeled
						legend="Scenario definition"
						id="scenario-defintion"
						class="strip wide"
						placeholder=""
						multiline
						rows="1"
					></ram-labeled>
					<div class="list">
						<div id="scenario-messages-clicker" class="row">
							<button class="lineout">&lt;</button>
							<div>1/1</div>
							<button class="lineout">&gt;</button>
						</div>
						<ram-labeled
							legend="First message"
							id="scenario-messages"
							class="strip wide"
							placeholder=""
							multiline
							rows="1"
						></ram-labeled>
					</div>
				</div>
			</ram-tab>
			<ram-tab key="play">
				<div class="chat-layout">
					<div class="chat-top shadow">
						<div class="row content-wide float-center">
							<button class="lineout fit" data-to="chats">back</button>
							<div class="chat-engine-control row-compact">
								<div>Engine:</div>
								<select id="chat-engine-picker" class="lineout"></select>
							</div>
							<select id="chat-menu-select" class="lineout"></select>
						</div>
					</div>
					<div id="play-messages" class="chat-scroll-container content-wide float-center"></div>
					<div class="shadow">
						<div class="chat-low content-wide float-center">
							<ram-tabs id="chat-controls" tab="main">
								<ram-tab key="main">
									<textarea id="chat-textarea" class="lineout"></textarea>
									<div id="chat-send-button">
										<ram-import path="assets/gfx/send.svg" class="chat-send"></ram-import>
									</div>
								</ram-tab>
								<ram-tab key="pending">
									<button id="chat-stop-button" class="lineout float-center">abort</button>
								</ram-tab>
								<ram-tab key="disabled">
									<div class="placeholder">Add an engine in settings to start chatting</div>
								</ram-tab>
							</ram-tabs>
						</div>
					</div>
				</div>
			</ram-tab>
		</ram-tabs>
		<ram-modal id="library-start">
			<div id="library-start-placeholder" class="placeholder">You need a persona to start a roleplay session. Make one in settings.</div>
			<div id="library-start-no-placeholder" class="virtual">
				<div class="list">
					<div>Pick a persona to start the chat</div>
					<select id="library-start-persona" class="lineout"></select>
				</div>
				<div class="list">
					<button id="library-start-button" class="lineout">Start</button>
					<ram-file-picker id="library-start-import" accept=".jsonl">
						<div class="lineout center-text">Import a chat in SillyTavern format and use selected persona</div>
					</ram-file-picker>
				</div>
			</div>
			<div id="library-start-description" class="lineout"></div>
		</ram-modal>
		<ram-modal id="play-editor">
			<div class="row">
				<button id="play-editor-save"  class="lineout fit">save</button>
				<button id="play-editor-reset" class="lineout fit float-end">reset</button>
				<button id="play-editor-close" class="lineout fit">close</button>
			</div>
			<ram-labeled
				legend="Character definition"
				id="play-editor-definition"
				class="strip wide"
				placeholder=""
				multiline
				rows="1"
			></ram-labeled>
		</ram-modal>
		<ram-modal id="play-rember">
			<div class="chat-engine-control row-compact">
				<div>Engine:</div>
				<select id="play-rember-engine-picker" class="lineout"></select>
			</div>
			<div class="list">
				<div class="hint">Stride is a number of message pairs (model + user) that will be summarized for each step</div>
				<ram-labeled
					legend="Stride"
					id="play-rember-stride"
					class="strip wide"
					placeholder="10"
				></ram-labeled>
			</div>
			<ram-labeled
				legend="Prompt"
				id="play-rember-prompt"
				class="strip wide"
				multiline
			></ram-labeled>
			<ram-labeled
				legend="State template"
				id="play-rember-template"
				class="strip wide"
				multiline
			></ram-labeled>
			<div class="row">
				<button id="play-rember-add-one" class="lineout fit">Add one</button>
				<button id="play-rember-add-all" class="lineout fit">Add all</button>
				<button id="play-rember-stop" class="lineout fit">Stop</button>
				<button id="play-rember-save" class="lineout fit">Save settings</button>
			</div>
			<div id="play-rember-messages" class="list"></div>
		</ram-modal>
	</body>

	<template id="template-theme-selector">
		<svg class="settings-theme-selector-button" viewBox="0 0 6 1" xmlns="http://www.w3.org/2000/svg">
			<path
				d="M0,0 l100,0 l0,1 l-100,0 Z"
				fill="var(--color-base)"
			/>
			<path
				d="M1,1 l1,-1 L100,0 L100,1 Z"
				fill="var(--color-secondary)"
			/>
			<path
				d="M2,1 l1,-1 L100,0 L100,1 Z"
				fill="var(--color-accent)"
			/>
			<path
				d="M3,1 l1,-1 L100,0 L100,1 Z"
				fill="var(--color-text)"
			/>
			<path
				d="M4,1 l1,-1 L100,0 L100,1 Z"
				fill="var(--color-base)"
			/>
		</svg>
	</template>
</html>
