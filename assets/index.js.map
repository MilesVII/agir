{
  "version": 3,
  "sources": ["../src/components/radio.ts", "../src/components/tabs.ts", "../node_modules/rampike/src/mudcrack.ts", "../node_modules/rampike/src/rampike.ts", "../node_modules/rampike/src/fromTemplate.ts", "../src/components/modal.ts", "../src/components/pagination.ts", "../src/components/import.ts", "../src/components/filepicker.ts", "../src/components/fieldset.ts", "../node_modules/marked/src/defaults.ts", "../node_modules/marked/src/rules.ts", "../node_modules/marked/src/helpers.ts", "../node_modules/marked/src/Tokenizer.ts", "../node_modules/marked/src/Lexer.ts", "../node_modules/marked/src/Renderer.ts", "../node_modules/marked/src/TextRenderer.ts", "../node_modules/marked/src/Parser.ts", "../node_modules/marked/src/Hooks.ts", "../node_modules/marked/src/Instance.ts", "../node_modules/marked/src/marked.ts", "../node_modules/dompurify/src/utils.ts", "../node_modules/dompurify/src/tags.ts", "../node_modules/dompurify/src/attrs.ts", "../node_modules/dompurify/src/regexp.ts", "../node_modules/dompurify/src/purify.ts", "../src/utils.ts", "../src/persist.ts", "../src/components/imagepicker.ts", "../src/units/navigation.ts", "../src/units/settings/engines.ts", "../src/units/settings/persona.ts", "../src/units/settings/themes.ts", "../src/units/settings/backup.ts", "../src/units/settings.ts", "../src/run.ts", "../src/units/chat/utils.ts", "../src/units/chat/message-view.ts", "../src/units/chat/load.ts", "../src/units/chat/send.ts", "../src/units/chat.ts", "../src/units/main.ts", "../src/units/scenario.ts", "../src/units/chat/start.ts", "../src/units/library.ts", "../src/index.ts"],
  "sourcesContent": ["\nconst TAG_NAME = {\n\tradio:  \"ram-radio\",\n\toption: \"ram-radio-option\",\n\tslider: \"ram-radio-slider\"\n};\n\nexport class RampikeRadio extends HTMLElement {\n\tget value() {\n\t\treturn this.getAttribute(\"value\") ?? \"\";\n\t}\n\tset value(v: string) {\n\t\tthis.select(v);\n\t}\n\n\tprivate options: RampikeRadioOption[] = [];\n\tprivate slider: RampikeRadioSlider | null = null;\n\tprivate select(v: string = this.value) {\n\t\tconst oldValue = this.value;\n\t\tif (oldValue !== v) {\n\t\t\tthis.setAttribute(\"value\", v);\n\t\t\tthis.dispatchEvent(new CustomEvent(\"r-change\", {\n\t\t\t\tdetail: {\n\t\t\t\t\toldValue,\n\t\t\t\t\tnewValue: v\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t\tthis.options.forEach(item => item.selected = this.value === item.key);\n\t\tconst selected: RampikeRadioOption | null = this.options.find(item => this.value === item.key) ?? null;\n\t\tif (selected) {\n\t\t\tthis.slider?.connect(selected);\n\t\t}\n\t}\n\n\tupdate() {\n\t\tconst options = Array.from(this.querySelectorAll<RampikeRadioOption>(TAG_NAME.option));\n\t\tconst groupFilter = (o: HTMLElement) =>\n\t\t\t\ttorpedo(\n\t\t\t\t\to,\n\t\t\t\t\tt => t.tagName === TAG_NAME.radio.toUpperCase()\n\t\t\t\t) === this;\n\t\tthis.options = options.filter(groupFilter);\n\n\t\tconst slider = this.querySelector<RampikeRadioSlider>(TAG_NAME.slider);\n\t\tthis.slider = (slider && groupFilter(slider)) ? slider : null;\n\n\t\tthis.style.setProperty(\"--option-count\", `${this.options.length}`);\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.style.position = \"relative\";\n\t\tsetTimeout(() => {\n\t\t\tthis.update();\n\t\t\tthis.select();\n\t\t}, 0);\n\t}\n};\n\nclass RampikeRadioOption extends HTMLElement {\n\tget selected() {\n\t\treturn this.getAttribute(\"selected\") === \"true\";\n\t}\n\tset selected(v: boolean) {\n\t\tif (v)\n\t\t\tthis.setAttribute(\"selected\", \"true\");\n\t\telse\n\t\t\tthis.removeAttribute(\"selected\");\n\t}\n\n\tget key() {\n\t\treturn this.getAttribute(\"key\") ?? \"\";\n\t}\n\tset key(v: string) {\n\t\tthis.setAttribute(\"key\", v);\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.style.position = \"relative\";\n\t\tconst seeker = (candidate: HTMLElement) => candidate.tagName === TAG_NAME.radio.toUpperCase();\n\t\tconst parent = torpedo<RampikeRadio>(this, seeker);\n\t\tif (!parent) return;\n\t\tthis.addEventListener(\"click\", () => parent.value = this.key);\n\t}\n};\n\nclass RampikeRadioSlider extends HTMLElement {\n\tprivate target?: RampikeRadioOption;\n\n\tconnect(target: RampikeRadioOption) {\n\t\tthis.target = target;\n\t\tconst container = torpedo(this, t => t.tagName === TAG_NAME.radio.toUpperCase())!;\n\n\t\tconst containerBox = container.getBoundingClientRect();\n\t\tconst targetBox = target.getBoundingClientRect();\n\t\tthis.style.left = `${targetBox.left - containerBox.left}px`;\n\t\tthis.style.right = `${containerBox.right - targetBox.right}px`;\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.style.position = \"absolute\";\n\t\tthis.style.top = \"0\";\n\t\tthis.style.bottom = \"0\";\n\n\t\tconst observer = new IntersectionObserver(() => this.target && this.connect(this.target));\n\t\tobserver.observe(this);\n\t}\n};\n\nexport function define() {\n\twindow.customElements.define(TAG_NAME.radio,  RampikeRadio);\n\twindow.customElements.define(TAG_NAME.option, RampikeRadioOption);\n\twindow.customElements.define(TAG_NAME.slider, RampikeRadioSlider);\n}\n\nfunction torpedo<T extends HTMLElement>(\n\torigin: Element,\n\tseeker: (target: HTMLElement) => boolean\n): T | null {\n\twhile(true) {\n\t\tconst parent = origin.parentElement;\n\t\tif (!parent) return null;\n\t\tif (seeker(parent)) return parent as T;\n\t\torigin = parent;\n\t}\n}\n", "\nconst TAG_NAME = {\n\tbutton: \"ram-tab-button\",\n\ttab:    \"ram-tab\",\n\ttabs:   \"ram-tabs\"\n};\n\nclass RampikeTab extends HTMLElement {\n\tget key() {\n\t\treturn this.getAttribute(\"key\") ?? \"\";\n\t}\n\tset key(value: string) {\n\t\tthis.setAttribute(\"key\", value)\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.style.display = \"contents\";\n\t}\n};\n\nclass RampikeTabContainer extends HTMLElement {\n\tstatic get observedAttributes() { return [\"tab\"]; }\n\tattributeChangedCallback(name: string, oldValue: string, value: string) {\n\t\tif (name !== \"tab\") return;\n\t\tif (oldValue === value) return;\n\t\tthis.tab = value;\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.style.display = \"contents\";\n\t\tthis.update();\n\t}\n\n\tget tab() {\n\t\treturn this.getAttribute(\"tab\") ?? \"\";\n\t}\n\tset tab(value: string) {\n\t\tif (value === this.tab) return;\n\t\tthis.setAttribute(\"tab\", value);\n\t\tthis.update();\n\t}\n\n\tprivate update() {\n\t\tconst value = this.tab;\n\t\tthis.querySelectorAll<RampikeTab>(TAG_NAME.tab).forEach(tab => {\n\t\t\tif (findParentTabContainer(tab)?.id !== this.id) return;\n\n\t\t\tconst hidden = tab.key !== value;\n\t\t\ttab.hidden = hidden;\n\t\t\ttab.style.display = hidden ? \"none\" : \"contents\";\n\t\t});\n\n\t\tif (this.id) {\n\t\t\tconst buttons = document.querySelectorAll<RampikeTabButton>(`${TAG_NAME.button}[for=\"${this.id}\"]`);\n\t\t\tbuttons.forEach(b => {\n\t\t\t\tb.active = b.tab === value;\n\t\t\t});\n\t\t}\n\t}\n}\n\nclass RampikeTabButton extends HTMLElement {\n\tget tab() {\n\t\treturn this.getAttribute(\"tab\");\n\t}\n\tget targetContainer() {\n\t\treturn this.getAttribute(\"for\");\n\t}\n\tget active(): boolean {\n\t\treturn this.getAttribute(\"tab-active\") === \"true\";\n\t}\n\tset active(value: boolean) {\n\t\tif (value)\n\t\t\tthis.setAttribute(\"tab-active\", \"true\");\n\t\telse\n\t\t\tthis.removeAttribute(\"tab-active\");\n\t}\n\tconstructor() {\n\t\tsuper();\n\t\tthis.addEventListener(\"click\", () => {\n\t\t\tconst containerId = this.getAttribute(\"for\");\n\t\t\tconst tab = this.getAttribute(\"tab\");\n\t\t\tif (!containerId || !tab) return;\n\n\t\t\tconst container = document.querySelector<RampikeTabContainer>(`${TAG_NAME.tabs}#${containerId}`);\n\t\t\tif (!container) return;\n\t\t\tcontainer.tab = tab;\n\t\t})\n\t}\n}\n\nexport function define() {\n\twindow.customElements.define(TAG_NAME.tab,    RampikeTab);\n\twindow.customElements.define(TAG_NAME.tabs,   RampikeTabContainer);\n\twindow.customElements.define(TAG_NAME.button, RampikeTabButton);\n}\nexport type RampikeTabs = RampikeTabContainer;\n\nfunction findParentTabContainer(origin: HTMLElement) {\n\tlet target = origin.parentElement;\n\twhile (target !== null && target.tagName !== TAG_NAME.tabs.toUpperCase()) {\n\t\ttarget = target.parentElement;\n\t}\n\treturn target;\n}\n", "type StringKeysAndValuesOnly<T> = {\r\n\t[P in keyof T as T[P] extends string | undefined ? (P extends string ? P : never) : never]: T[P];\r\n};\r\ntype AutocompleteString<T extends string> = T | (string & {});\r\n\r\ntype TagName = AutocompleteString<keyof HTMLElementTagNameMap>;\r\ntype MappedElement<T> = T extends keyof HTMLElementTagNameMap ? HTMLElementTagNameMap[T] : Element;\r\ntype MappedEvent<T> = T extends keyof HTMLElementEventMap ? HTMLElementEventMap[T] : Event;\r\ntype KnownElements = HTMLElementTagNameMap[keyof HTMLElementTagNameMap];\r\n\r\nexport type CSSProperties = StringKeysAndValuesOnly<Partial<CSSStyleDeclaration>>;\r\n\r\ntype EventsRecord<E> = {\r\n\t[K in keyof HTMLElementEventMap]?: (event: MappedEvent<K>, element: E) => void\r\n}\r\n\r\ntype Source<T> = Partial<{\r\n\ttagName: T\r\n\telementOptions: ElementCreationOptions,\r\n}>;\r\n\r\ntype BuildOptions<E> = Partial<{\r\n\tattributes: Record<string, string>,\r\n\tclassName: string,\r\n\tstyle: CSSProperties,\r\n\tevents: EventsRecord<E>,\r\n\tcontents: string | Element[]\r\n}>;\r\n\r\ntype MudcrackOptions<E> = BuildOptions<MappedElement<E>> & Source<E>;\r\n\r\nexport function mudcrack<\r\n\tElementType extends TagName | undefined\r\n> (\r\n\toptions: MudcrackOptions<ElementType> = {}\r\n): MappedElement<ElementType> {\r\n\tconst {\r\n\t\ttagName,\r\n\t\telementOptions\r\n\t} = options;\r\n\tconst el = document.createElement(tagName ?? \"div\", elementOptions) as MappedElement<ElementType>;\r\n\treturn soilborne(el, options);\r\n}\r\n\r\nexport function soilborne<T extends KnownElements | Element>(\r\n\tsource: T,\r\n\t{\r\n\t\tattributes,\r\n\t\tclassName,\r\n\t\tstyle,\r\n\t\tevents,\r\n\t\tcontents\r\n\t}: BuildOptions<T> = {}\r\n) {\r\n\tif (className) source.className = className;\r\n\r\n\tif (typeof contents === \"string\")\r\n\t\tsource.textContent = contents;\r\n\telse if (Array.isArray(contents))\r\n\t\tsource.append(...contents);\r\n\r\n\tif (style && \"style\" in source)\r\n\t\tfor (const styleKey of typedKeys(style)){\r\n\t\t\tif (styleKey.includes(\"-\"))\r\n\t\t\t\tsource.style.setProperty(styleKey, style[styleKey] ?? null);\r\n\t\t\telse\r\n\t\t\t\tsource.style[styleKey] = style[styleKey] ?? \"\";\r\n\t\t}\r\n\tif (attributes)\r\n\t\tfor (const attributeKey of Object.keys(attributes))\r\n\t\t\tsource.setAttribute(attributeKey, attributes[attributeKey]!);\r\n\r\n\tif (events)\r\n\t\tfor (const eventKey of typedKeys(events)) {\r\n\t\t\t// @ts-ignore\r\n\t\t\tsource.addEventListener(eventKey, e => events[eventKey](e, source));\r\n\t\t}\r\n\r\n\treturn source;\r\n}\r\n\r\nfunction typedKeys<T extends object>(value: T): (keyof T)[] {\r\n\treturn Object.keys(value) as (keyof T)[];\r\n}\r\n", "\r\nexport type Rampike<Root, Params> = Root & {\r\n\trampike: {\r\n\t\tparams: Params,\r\n\t\trender: () => void\r\n\t}\r\n};\r\n\r\ntype RampikeOptions = {\r\n\tskipInitialRender: boolean\r\n};\r\nconst defaultOptions: RampikeOptions = {\r\n\tskipInitialRender: false\r\n}\r\n\r\nexport function rampike<Root, Params>(\r\n\tsource: Root,\r\n\tparams: Params,\r\n\trender: (params: Params, root: Rampike<Root, Params>) => void,\r\n\toptions?: Partial<RampikeOptions>\r\n) {\r\n\tconst {\r\n\t\tskipInitialRender\r\n\t} = {\r\n\t\t...defaultOptions,\r\n\t\t...options\r\n\t};\r\n\r\n\tconst root = source as Rampike<Root, Params>;\r\n\troot.rampike = {\r\n\t\tparams,\r\n\t\trender: () => render(root.rampike.params, root)\r\n\t};\r\n\tif (!skipInitialRender) root.rampike.render();\r\n\r\n\treturn root;\r\n}\r\n", "\r\nexport function fromTemplateFirst<T extends Element>(template: HTMLTemplateElement) {\r\n\tconst elements = extractElements(template) as T[];\r\n\r\n\treturn elements[0] ?? null as T | null;\r\n};\r\nexport function fromTemplateAll<T extends Element>(template: HTMLTemplateElement) {\r\n\tconst elements = extractElements(template) as T[];\r\n\treturn elements;\r\n};\r\n\r\nfunction extractElements(template: HTMLTemplateElement) {\r\n\tconst contents = template.content.cloneNode(true);\r\n\tconst elements: Element[] = [];\r\n\tcontents.childNodes.forEach(node => {\r\n\t\tif (node.nodeType === Node.ELEMENT_NODE)\r\n\t\t\telements.push(node as Element);\r\n\t});\r\n\treturn elements;\r\n}\r\n", "import { mudcrack } from \"rampike\";\n\nexport class RampikeModal extends HTMLElement {\n\tdialog: HTMLDialogElement;\n\topen() {\n\t\tif (this.dialog.open) return;\n\t\tthis.dialog.showModal();\n\t}\n\tclose() {\n\t\tif (!this.dialog.open) return;\n\t\tthis.dialog.close();\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.style.display = \"contents\";\n\n\t\tconst contents = Array.from(this.childNodes);\n\n\t\tconst form = mudcrack({\n\t\t\ttagName: \"form\",\n\t\t\tattributes: {\n\t\t\t\tmethod: \"dialog\"\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tsubmit: e => e.preventDefault()\n\t\t\t}\n\t\t});\n\t\tthis.dialog = mudcrack({\n\t\t\ttagName: \"dialog\",\n\t\t\tevents: {\n\t\t\t\tclick: (e, el) => {\n\t\t\t\t\tif (e.target === el) el.close();\n\t\t\t\t}\n\t\t\t},\n\t\t\tcontents: [ form ]\n\t\t});\n\t\tthis.append(this.dialog);\n\n\t\tcontents.forEach(e => form.appendChild(e));\n\t}\n}\n\nexport function define(name: string) {\n\twindow.customElements.define(name, RampikeModal);\n}\n", "import { mudcrack } from \"rampike\";\n\nconst TAG_NAME = \"ram-pages\";\n\nclass RampikePages extends HTMLElement {\n\tprivate readAttribute(key: string, def: number) {\n\t\tconst raw = this.getAttribute(key);\n\t\treturn raw ? parseInt(raw, 10) : def;\n\t}\n\n\tget page() { return this.readAttribute(\"page\", 0) }\n\tset page(value: number) {\n\t\tthis.setAttribute(\"page\", `${value}`);\n\t\tthis.update();\n\t}\n\tget distance() { return this.readAttribute(\"distance\", 3) }\n\tset distance(value: number) {\n\t\tthis.setAttribute(\"distance\", `${value}`);\n\t\tthis.update();\n\t}\n\tget pageCount() { return this.readAttribute(\"pageCount\", 0) }\n\tset pageCount(value: number) {\n\t\tthis.setAttribute(\"pageCount\", `${value}`);\n\t\tthis.update();\n\t}\n\n\tprivate links() {\n\t\tconst r: number[] = [];\n\t\tlet jam = false;\n\t\tfor (let i = 0; i < this.pageCount; ++i){\n\t\t\tconst distances = [\n\t\t\t\tMath.abs(i - 0),\n\t\t\t\tMath.abs(i - (this.page)),\n\t\t\t\tMath.abs(i - (this.pageCount - 1))\n\t\t\t];\n\n\t\t\tif (Math.min(...distances) < (this.distance)){\n\t\t\t\tr.push(i);\n\t\t\t\tjam = false;\n\t\t\t} else {\n\t\t\t\tif (!jam)\n\t\t\t\t\tr.push(-1);\n\t\t\t\tjam = true;\n\t\t\t}\n\t\t}\n\t\treturn r;\n\t}\n\tprivate update() {\n\t\tthis.innerHTML = \"\";\n\t\tthis.append(...this.links().map(page => {\n\t\t\tconst current = page === this.page;\n\t\t\tconst ellipsis = page === -1;\n\n\t\t\tconst contents = ellipsis ? \"\u2026\" : `${page + 1}`;\n\t\t\tconst events = (ellipsis || current) ? {} : {\n\t\t\t\t\"click\": () => this.pick(page)\n\t\t\t}\n\t\t\tconst attributes: { \"data-current\": \"\" } | {} = current ? { \"data-current\": \"\" } : {};\n\n\t\t\tconst className = ellipsis\n\t\t\t\t? this.getAttribute(\"class-ellipsi\")\n\t\t\t\t: this.getAttribute(\"class-buttons\");\n\n\t\t\treturn mudcrack({\n\t\t\t\ttagName: ellipsis ? \"span\" : \"button\",\n\t\t\t\tclassName: className ?? undefined,\n\t\t\t\tattributes,\n\t\t\t\tevents,\n\t\t\t\tcontents\n\t\t\t});\n\t\t}));\n\t}\n\n\tprivate pick(page: number) {\n\t\tthis.dispatchEvent(new CustomEvent(\"pick\", {\n\t\t\tdetail: {\n\t\t\t\tpage\n\t\t\t},\n\t\t\t// bubbles: true,\n\t\t\t// cancelable: true\n\t\t}));\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.update();\n\t}\n};\n\nexport function define() {\n\twindow.customElements.define(TAG_NAME, RampikePages);\n}\nexport type RampikePagination = RampikePages;", "\r\nconst parser = new DOMParser();\r\n\r\nclass RampikeSVGImport extends HTMLElement {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tconst path = this.getAttribute(\"path\");\r\n\t\tconst attributes = this\r\n\t\t\t.getAttributeNames()\r\n\t\t\t.filter(a => a !== \"path\")\r\n\t\t\t.map(name => [name, this.getAttribute(name)] as [string, string]);\r\n\r\n\t\tif (!path) return;\r\n\t\tfetch(path).then(async response => {\r\n\t\t\tif (response.ok) {\r\n\t\t\t\tconst raw = await response.text();\r\n\t\t\t\tconst candidates = Array.from(parser.parseFromString(raw, \"image/svg+xml\").children);\r\n\t\t\t\tconst parsed = candidates.find(c => c.tagName.toLowerCase() === \"svg\") as SVGElement;\r\n\t\t\t\tif (!parsed) return;\r\n\r\n\t\t\t\tfor (const [a, v] of attributes) {\r\n\t\t\t\t\tparsed.setAttribute(a, v);\r\n\t\t\t\t}\r\n\t\t\t\tthis.parentElement?.replaceChild(parsed, this);\r\n\t\t\t};\r\n\t\t});\r\n\t}\r\n};\r\n\r\nexport function define(tagName: string) {\r\n\twindow.customElements.define(tagName, RampikeSVGImport);\r\n}\r\n", "import { mudcrack } from \"rampike\";\r\n\r\nclass _RampikeFilePicker extends HTMLElement {\r\n\tget input() {\r\n\t\treturn this.querySelector<HTMLInputElement>(`input[type=\"file\"]`)!;\r\n\t}\r\n\tget value() {\r\n\t\treturn this.input.value;\r\n\t}\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tconst contents = mudcrack({\r\n\t\t\ttagName: \"label\",\r\n\t\t\tstyle: {\r\n\t\t\t\tdisplay: \"contents\"\r\n\t\t\t},\r\n\t\t\tcontents: [\r\n\t\t\t\tmudcrack({\r\n\t\t\t\t\ttagName: \"input\",\r\n\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\ttype: \"file\",\r\n\t\t\t\t\t\taccept: this.getAttribute(\"accept\") ?? \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstyle: {\r\n\t\t\t\t\t\tdisplay: \"none\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t\t...Array.from(this.children)\r\n\t\t\t]\r\n\t\t});\r\n\t\tthis.append(contents);\r\n\t}\r\n};\r\n\r\nexport function define(tagName: string) {\r\n\twindow.customElements.define(tagName, _RampikeFilePicker);\r\n}\r\n\r\nexport type RampikeFilePicker = _RampikeFilePicker;\r\n", "import { mudcrack } from \"rampike\";\r\n\r\nclass RampikeLabeled extends HTMLElement {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tconst legend = this.getAttribute(\"legend\") ?? \"\";\r\n\t\tconst multiline = this.hasAttribute(\"multiline\");\r\n\t\tconst attributes = Object.fromEntries(\r\n\t\t\tthis\r\n\t\t\t\t.getAttributeNames()\r\n\t\t\t\t.filter(a => a !== \"legend\" && a !== \"multiline\")\r\n\t\t\t\t.map(name => [name, this.getAttribute(name)] as [string, string])\r\n\t\t);\r\n\t\tif (!multiline) attributes.type = \"text\";\r\n\r\n\t\tconst contents = mudcrack({\r\n\t\t\ttagName: \"fieldset\",\r\n\t\t\tcontents: [\r\n\t\t\t\tmudcrack({\r\n\t\t\t\t\ttagName: \"legend\",\r\n\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\tfor: attributes.id,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcontents: legend\r\n\t\t\t\t}),\r\n\t\t\t\tmudcrack({\r\n\t\t\t\t\ttagName: multiline ? \"textarea\" : \"input\",\r\n\t\t\t\t\tattributes\r\n\t\t\t\t})\r\n\t\t\t]\r\n\t\t});\r\n\t\tthis.parentElement?.replaceChild(contents, this);\r\n\t}\r\n};\r\n\r\nexport function define(tagName: string) {\r\n\twindow.customElements.define(tagName, RampikeLabeled);\r\n}\r\n\r\n", "import type { MarkedOptions } from './MarkedOptions.ts';\n\n/**\n * Gets the original marked default options.\n */\nexport function _getDefaults<ParserOutput = string, RendererOutput = string>(): MarkedOptions<ParserOutput, RendererOutput> {\n  return {\n    async: false,\n    breaks: false,\n    extensions: null,\n    gfm: true,\n    hooks: null,\n    pedantic: false,\n    renderer: null,\n    silent: false,\n    tokenizer: null,\n    walkTokens: null,\n  };\n}\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport let _defaults: MarkedOptions<any, any> = _getDefaults();\n\nexport function changeDefaults<ParserOutput = string, RendererOutput = string>(newDefaults: MarkedOptions<ParserOutput, RendererOutput>) {\n  _defaults = newDefaults;\n}\n", "const noopTest = { exec: () => null } as unknown as RegExp;\n\nfunction edit(regex: string | RegExp, opt = '') {\n  let source = typeof regex === 'string' ? regex : regex.source;\n  const obj = {\n    replace: (name: string | RegExp, val: string | RegExp) => {\n      let valSource = typeof val === 'string' ? val : val.source;\n      valSource = valSource.replace(other.caret, '$1');\n      source = source.replace(name, valSource);\n      return obj;\n    },\n    getRegex: () => {\n      return new RegExp(source, opt);\n    },\n  };\n  return obj;\n}\n\nconst supportsLookbehind = (() => {\ntry {\n  // eslint-disable-next-line prefer-regex-literals\n  return !!new RegExp('(?<=1)(?<!1)');\n} catch {\n  // See browser support here:\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Regular_expressions/Lookbehind_assertion\n  return false;\n}\n})();\n\nexport const other = {\n  codeRemoveIndent: /^(?: {1,4}| {0,3}\\t)/gm,\n  outputLinkReplace: /\\\\([\\[\\]])/g,\n  indentCodeCompensation: /^(\\s+)(?:```)/,\n  beginningSpace: /^\\s+/,\n  endingHash: /#$/,\n  startingSpaceChar: /^ /,\n  endingSpaceChar: / $/,\n  nonSpaceChar: /[^ ]/,\n  newLineCharGlobal: /\\n/g,\n  tabCharGlobal: /\\t/g,\n  multipleSpaceGlobal: /\\s+/g,\n  blankLine: /^[ \\t]*$/,\n  doubleBlankLine: /\\n[ \\t]*\\n[ \\t]*$/,\n  blockquoteStart: /^ {0,3}>/,\n  blockquoteSetextReplace: /\\n {0,3}((?:=+|-+) *)(?=\\n|$)/g,\n  blockquoteSetextReplace2: /^ {0,3}>[ \\t]?/gm,\n  listReplaceTabs: /^\\t+/,\n  listReplaceNesting: /^ {1,4}(?=( {4})*[^ ])/g,\n  listIsTask: /^\\[[ xX]\\] +\\S/,\n  listReplaceTask: /^\\[[ xX]\\] +/,\n  listTaskCheckbox: /\\[[ xX]\\]/,\n  anyLine: /\\n.*\\n/,\n  hrefBrackets: /^<(.*)>$/,\n  tableDelimiter: /[:|]/,\n  tableAlignChars: /^\\||\\| *$/g,\n  tableRowBlankLine: /\\n[ \\t]*$/,\n  tableAlignRight: /^ *-+: *$/,\n  tableAlignCenter: /^ *:-+: *$/,\n  tableAlignLeft: /^ *:-+ *$/,\n  startATag: /^<a /i,\n  endATag: /^<\\/a>/i,\n  startPreScriptTag: /^<(pre|code|kbd|script)(\\s|>)/i,\n  endPreScriptTag: /^<\\/(pre|code|kbd|script)(\\s|>)/i,\n  startAngleBracket: /^</,\n  endAngleBracket: />$/,\n  pedanticHrefTitle: /^([^'\"]*[^\\s])\\s+(['\"])(.*)\\2/,\n  unicodeAlphaNumeric: /[\\p{L}\\p{N}]/u,\n  escapeTest: /[&<>\"']/,\n  escapeReplace: /[&<>\"']/g,\n  escapeTestNoEncode: /[<>\"']|&(?!(#\\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\\w+);)/,\n  escapeReplaceNoEncode: /[<>\"']|&(?!(#\\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\\w+);)/g,\n  unescapeTest: /&(#(?:\\d+)|(?:#x[0-9A-Fa-f]+)|(?:\\w+));?/ig,\n  caret: /(^|[^\\[])\\^/g,\n  percentDecode: /%25/g,\n  findPipe: /\\|/g,\n  splitPipe: / \\|/,\n  slashPipe: /\\\\\\|/g,\n  carriageReturn: /\\r\\n|\\r/g,\n  spaceLine: /^ +$/gm,\n  notSpaceStart: /^\\S*/,\n  endingNewline: /\\n$/,\n  listItemRegex: (bull: string) => new RegExp(`^( {0,3}${bull})((?:[\\t ][^\\\\n]*)?(?:\\\\n|$))`),\n  nextBulletRegex: (indent: number) => new RegExp(`^ {0,${Math.min(3, indent - 1)}}(?:[*+-]|\\\\d{1,9}[.)])((?:[ \\t][^\\\\n]*)?(?:\\\\n|$))`),\n  hrRegex: (indent: number) => new RegExp(`^ {0,${Math.min(3, indent - 1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\\\* *){3,})(?:\\\\n+|$)`),\n  fencesBeginRegex: (indent: number) => new RegExp(`^ {0,${Math.min(3, indent - 1)}}(?:\\`\\`\\`|~~~)`),\n  headingBeginRegex: (indent: number) => new RegExp(`^ {0,${Math.min(3, indent - 1)}}#`),\n  htmlBeginRegex: (indent: number) => new RegExp(`^ {0,${Math.min(3, indent - 1)}}<(?:[a-z].*>|!--)`, 'i'),\n};\n\n/**\n * Block-Level Grammar\n */\n\nconst newline = /^(?:[ \\t]*(?:\\n|$))+/;\nconst blockCode = /^((?: {4}| {0,3}\\t)[^\\n]+(?:\\n(?:[ \\t]*(?:\\n|$))*)?)+/;\nconst fences = /^ {0,3}(`{3,}(?=[^`\\n]*(?:\\n|$))|~{3,})([^\\n]*)(?:\\n|$)(?:|([\\s\\S]*?)(?:\\n|$))(?: {0,3}\\1[~`]* *(?=\\n|$)|$)/;\nconst hr = /^ {0,3}((?:-[\\t ]*){3,}|(?:_[ \\t]*){3,}|(?:\\*[ \\t]*){3,})(?:\\n+|$)/;\nconst heading = /^ {0,3}(#{1,6})(?=\\s|$)(.*)(?:\\n+|$)/;\nconst bullet = /(?:[*+-]|\\d{1,9}[.)])/;\nconst lheadingCore = /^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\\n(?!\\s*?\\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\\n {0,3}(=+|-+) *(?:\\n+|$)/;\nconst lheading = edit(lheadingCore)\n  .replace(/bull/g, bullet) // lists can interrupt\n  .replace(/blockCode/g, /(?: {4}| {0,3}\\t)/) // indented code blocks can interrupt\n  .replace(/fences/g, / {0,3}(?:`{3,}|~{3,})/) // fenced code blocks can interrupt\n  .replace(/blockquote/g, / {0,3}>/) // blockquote can interrupt\n  .replace(/heading/g, / {0,3}#{1,6}/) // ATX heading can interrupt\n  .replace(/html/g, / {0,3}<[^\\n>]+>\\n/) // block html can interrupt\n  .replace(/\\|table/g, '') // table not in commonmark\n  .getRegex();\nconst lheadingGfm = edit(lheadingCore)\n  .replace(/bull/g, bullet) // lists can interrupt\n  .replace(/blockCode/g, /(?: {4}| {0,3}\\t)/) // indented code blocks can interrupt\n  .replace(/fences/g, / {0,3}(?:`{3,}|~{3,})/) // fenced code blocks can interrupt\n  .replace(/blockquote/g, / {0,3}>/) // blockquote can interrupt\n  .replace(/heading/g, / {0,3}#{1,6}/) // ATX heading can interrupt\n  .replace(/html/g, / {0,3}<[^\\n>]+>\\n/) // block html can interrupt\n  .replace(/table/g, / {0,3}\\|?(?:[:\\- ]*\\|)+[\\:\\- ]*\\n/) // table can interrupt\n  .getRegex();\nconst _paragraph = /^([^\\n]+(?:\\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\\n)[^\\n]+)*)/;\nconst blockText = /^[^\\n]+/;\nconst _blockLabel = /(?!\\s*\\])(?:\\\\[\\s\\S]|[^\\[\\]\\\\])+/;\nconst def = edit(/^ {0,3}\\[(label)\\]: *(?:\\n[ \\t]*)?([^<\\s][^\\s]*|<.*?>)(?:(?: +(?:\\n[ \\t]*)?| *\\n[ \\t]*)(title))? *(?:\\n+|$)/)\n  .replace('label', _blockLabel)\n  .replace('title', /(?:\"(?:\\\\\"?|[^\"\\\\])*\"|'[^'\\n]*(?:\\n[^'\\n]+)*\\n?'|\\([^()]*\\))/)\n  .getRegex();\n\nconst list = edit(/^( {0,3}bull)([ \\t][^\\n]+?)?(?:\\n|$)/)\n  .replace(/bull/g, bullet)\n  .getRegex();\n\nconst _tag = 'address|article|aside|base|basefont|blockquote|body|caption'\n  + '|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption'\n  + '|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe'\n  + '|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option'\n  + '|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title'\n  + '|tr|track|ul';\nconst _comment = /<!--(?:-?>|[\\s\\S]*?(?:-->|$))/;\nconst html = edit(\n  '^ {0,3}(?:' // optional indentation\n+ '<(script|pre|style|textarea)[\\\\s>][\\\\s\\\\S]*?(?:</\\\\1>[^\\\\n]*\\\\n+|$)' // (1)\n+ '|comment[^\\\\n]*(\\\\n+|$)' // (2)\n+ '|<\\\\?[\\\\s\\\\S]*?(?:\\\\?>\\\\n*|$)' // (3)\n+ '|<![A-Z][\\\\s\\\\S]*?(?:>\\\\n*|$)' // (4)\n+ '|<!\\\\[CDATA\\\\[[\\\\s\\\\S]*?(?:\\\\]\\\\]>\\\\n*|$)' // (5)\n+ '|</?(tag)(?: +|\\\\n|/?>)[\\\\s\\\\S]*?(?:(?:\\\\n[ \\t]*)+\\\\n|$)' // (6)\n+ '|<(?!script|pre|style|textarea)([a-z][\\\\w-]*)(?:attribute)*? */?>(?=[ \\\\t]*(?:\\\\n|$))[\\\\s\\\\S]*?(?:(?:\\\\n[ \\t]*)+\\\\n|$)' // (7) open tag\n+ '|</(?!script|pre|style|textarea)[a-z][\\\\w-]*\\\\s*>(?=[ \\\\t]*(?:\\\\n|$))[\\\\s\\\\S]*?(?:(?:\\\\n[ \\t]*)+\\\\n|$)' // (7) closing tag\n+ ')', 'i')\n  .replace('comment', _comment)\n  .replace('tag', _tag)\n  .replace('attribute', / +[a-zA-Z:_][\\w.:-]*(?: *= *\"[^\"\\n]*\"| *= *'[^'\\n]*'| *= *[^\\s\"'=<>`]+)?/)\n  .getRegex();\n\nconst paragraph = edit(_paragraph)\n  .replace('hr', hr)\n  .replace('heading', ' {0,3}#{1,6}(?:\\\\s|$)')\n  .replace('|lheading', '') // setext headings don't interrupt commonmark paragraphs\n  .replace('|table', '')\n  .replace('blockquote', ' {0,3}>')\n  .replace('fences', ' {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n')\n  .replace('list', ' {0,3}(?:[*+-]|1[.)]) ') // only lists starting from 1 can interrupt\n  .replace('html', '</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)')\n  .replace('tag', _tag) // pars can be interrupted by type (6) html blocks\n  .getRegex();\n\nconst blockquote = edit(/^( {0,3}> ?(paragraph|[^\\n]*)(?:\\n|$))+/)\n  .replace('paragraph', paragraph)\n  .getRegex();\n\n/**\n * Normal Block Grammar\n */\n\nconst blockNormal = {\n  blockquote,\n  code: blockCode,\n  def,\n  fences,\n  heading,\n  hr,\n  html,\n  lheading,\n  list,\n  newline,\n  paragraph,\n  table: noopTest,\n  text: blockText,\n};\n\ntype BlockKeys = keyof typeof blockNormal;\n\n/**\n * GFM Block Grammar\n */\n\nconst gfmTable = edit(\n  '^ *([^\\\\n ].*)\\\\n' // Header\n+ ' {0,3}((?:\\\\| *)?:?-+:? *(?:\\\\| *:?-+:? *)*(?:\\\\| *)?)' // Align\n+ '(?:\\\\n((?:(?! *\\\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\\\n|$))*)\\\\n*|$)') // Cells\n  .replace('hr', hr)\n  .replace('heading', ' {0,3}#{1,6}(?:\\\\s|$)')\n  .replace('blockquote', ' {0,3}>')\n  .replace('code', '(?: {4}| {0,3}\\t)[^\\\\n]')\n  .replace('fences', ' {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n')\n  .replace('list', ' {0,3}(?:[*+-]|1[.)]) ') // only lists starting from 1 can interrupt\n  .replace('html', '</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)')\n  .replace('tag', _tag) // tables can be interrupted by type (6) html blocks\n  .getRegex();\n\nconst blockGfm: Record<BlockKeys, RegExp> = {\n  ...blockNormal,\n  lheading: lheadingGfm,\n  table: gfmTable,\n  paragraph: edit(_paragraph)\n    .replace('hr', hr)\n    .replace('heading', ' {0,3}#{1,6}(?:\\\\s|$)')\n    .replace('|lheading', '') // setext headings don't interrupt commonmark paragraphs\n    .replace('table', gfmTable) // interrupt paragraphs with table\n    .replace('blockquote', ' {0,3}>')\n    .replace('fences', ' {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n')\n    .replace('list', ' {0,3}(?:[*+-]|1[.)]) ') // only lists starting from 1 can interrupt\n    .replace('html', '</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)')\n    .replace('tag', _tag) // pars can be interrupted by type (6) html blocks\n    .getRegex(),\n};\n\n/**\n * Pedantic grammar (original John Gruber's loose markdown specification)\n */\n\nconst blockPedantic: Record<BlockKeys, RegExp> = {\n  ...blockNormal,\n  html: edit(\n    '^ *(?:comment *(?:\\\\n|\\\\s*$)'\n    + '|<(tag)[\\\\s\\\\S]+?</\\\\1> *(?:\\\\n{2,}|\\\\s*$)' // closed tag\n    + '|<tag(?:\"[^\"]*\"|\\'[^\\']*\\'|\\\\s[^\\'\"/>\\\\s]*)*?/?> *(?:\\\\n{2,}|\\\\s*$))')\n    .replace('comment', _comment)\n    .replace(/tag/g, '(?!(?:'\n      + 'a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub'\n      + '|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)'\n      + '\\\\b)\\\\w+(?!:|[^\\\\w\\\\s@]*@)\\\\b')\n    .getRegex(),\n  def: /^ *\\[([^\\]]+)\\]: *<?([^\\s>]+)>?(?: +([\"(][^\\n]+[\")]))? *(?:\\n+|$)/,\n  heading: /^(#{1,6})(.*)(?:\\n+|$)/,\n  fences: noopTest, // fences not supported\n  lheading: /^(.+?)\\n {0,3}(=+|-+) *(?:\\n+|$)/,\n  paragraph: edit(_paragraph)\n    .replace('hr', hr)\n    .replace('heading', ' *#{1,6} *[^\\n]')\n    .replace('lheading', lheading)\n    .replace('|table', '')\n    .replace('blockquote', ' {0,3}>')\n    .replace('|fences', '')\n    .replace('|list', '')\n    .replace('|html', '')\n    .replace('|tag', '')\n    .getRegex(),\n};\n\n/**\n * Inline-Level Grammar\n */\n\nconst escape = /^\\\\([!\"#$%&'()*+,\\-./:;<=>?@\\[\\]\\\\^_`{|}~])/;\nconst inlineCode = /^(`+)([^`]|[^`][\\s\\S]*?[^`])\\1(?!`)/;\nconst br = /^( {2,}|\\\\)\\n(?!\\s*$)/;\nconst inlineText = /^(`+|[^`])(?:(?= {2,}\\n)|[\\s\\S]*?(?:(?=[\\\\<!\\[`*_]|\\b_|$)|[^ ](?= {2,}\\n)))/;\n\n// list of unicode punctuation marks, plus any missing characters from CommonMark spec\nconst _punctuation = /[\\p{P}\\p{S}]/u;\nconst _punctuationOrSpace = /[\\s\\p{P}\\p{S}]/u;\nconst _notPunctuationOrSpace = /[^\\s\\p{P}\\p{S}]/u;\nconst punctuation = edit(/^((?![*_])punctSpace)/, 'u')\n  .replace(/punctSpace/g, _punctuationOrSpace).getRegex();\n\n// GFM allows ~ inside strong and em for strikethrough\nconst _punctuationGfmStrongEm = /(?!~)[\\p{P}\\p{S}]/u;\nconst _punctuationOrSpaceGfmStrongEm = /(?!~)[\\s\\p{P}\\p{S}]/u;\nconst _notPunctuationOrSpaceGfmStrongEm = /(?:[^\\s\\p{P}\\p{S}]|~)/u;\n\n// sequences em should skip over [title](link), `code`, <html>\nconst blockSkip = edit(/link|precode-code|html/, 'g')\n  .replace('link', /\\[(?:[^\\[\\]`]|(?<a>`+)[^`]+\\k<a>(?!`))*?\\]\\((?:\\\\[\\s\\S]|[^\\\\\\(\\)]|\\((?:\\\\[\\s\\S]|[^\\\\\\(\\)])*\\))*\\)/)\n  .replace('precode-', supportsLookbehind ? '(?<!`)()' : '(^^|[^`])')\n  .replace('code', /(?<b>`+)[^`]+\\k<b>(?!`)/)\n  .replace('html', /<(?! )[^<>]*?>/)\n  .getRegex();\n\nconst emStrongLDelimCore = /^(?:\\*+(?:((?!\\*)punct)|[^\\s*]))|^_+(?:((?!_)punct)|([^\\s_]))/;\n\nconst emStrongLDelim = edit(emStrongLDelimCore, 'u')\n  .replace(/punct/g, _punctuation)\n  .getRegex();\n\nconst emStrongLDelimGfm = edit(emStrongLDelimCore, 'u')\n  .replace(/punct/g, _punctuationGfmStrongEm)\n  .getRegex();\n\nconst emStrongRDelimAstCore =\n  '^[^_*]*?__[^_*]*?\\\\*[^_*]*?(?=__)' // Skip orphan inside strong\n+ '|[^*]+(?=[^*])' // Consume to delim\n+ '|(?!\\\\*)punct(\\\\*+)(?=[\\\\s]|$)' // (1) #*** can only be a Right Delimiter\n+ '|notPunctSpace(\\\\*+)(?!\\\\*)(?=punctSpace|$)' // (2) a***#, a*** can only be a Right Delimiter\n+ '|(?!\\\\*)punctSpace(\\\\*+)(?=notPunctSpace)' // (3) #***a, ***a can only be Left Delimiter\n+ '|[\\\\s](\\\\*+)(?!\\\\*)(?=punct)' // (4) ***# can only be Left Delimiter\n+ '|(?!\\\\*)punct(\\\\*+)(?!\\\\*)(?=punct)' // (5) #***# can be either Left or Right Delimiter\n+ '|notPunctSpace(\\\\*+)(?=notPunctSpace)'; // (6) a***a can be either Left or Right Delimiter\n\nconst emStrongRDelimAst = edit(emStrongRDelimAstCore, 'gu')\n  .replace(/notPunctSpace/g, _notPunctuationOrSpace)\n  .replace(/punctSpace/g, _punctuationOrSpace)\n  .replace(/punct/g, _punctuation)\n  .getRegex();\n\nconst emStrongRDelimAstGfm = edit(emStrongRDelimAstCore, 'gu')\n  .replace(/notPunctSpace/g, _notPunctuationOrSpaceGfmStrongEm)\n  .replace(/punctSpace/g, _punctuationOrSpaceGfmStrongEm)\n  .replace(/punct/g, _punctuationGfmStrongEm)\n  .getRegex();\n\n// (6) Not allowed for _\nconst emStrongRDelimUnd = edit(\n  '^[^_*]*?\\\\*\\\\*[^_*]*?_[^_*]*?(?=\\\\*\\\\*)' // Skip orphan inside strong\n+ '|[^_]+(?=[^_])' // Consume to delim\n+ '|(?!_)punct(_+)(?=[\\\\s]|$)' // (1) #___ can only be a Right Delimiter\n+ '|notPunctSpace(_+)(?!_)(?=punctSpace|$)' // (2) a___#, a___ can only be a Right Delimiter\n+ '|(?!_)punctSpace(_+)(?=notPunctSpace)' // (3) #___a, ___a can only be Left Delimiter\n+ '|[\\\\s](_+)(?!_)(?=punct)' // (4) ___# can only be Left Delimiter\n+ '|(?!_)punct(_+)(?!_)(?=punct)', 'gu') // (5) #___# can be either Left or Right Delimiter\n  .replace(/notPunctSpace/g, _notPunctuationOrSpace)\n  .replace(/punctSpace/g, _punctuationOrSpace)\n  .replace(/punct/g, _punctuation)\n  .getRegex();\n\nconst anyPunctuation = edit(/\\\\(punct)/, 'gu')\n  .replace(/punct/g, _punctuation)\n  .getRegex();\n\nconst autolink = edit(/^<(scheme:[^\\s\\x00-\\x1f<>]*|email)>/)\n  .replace('scheme', /[a-zA-Z][a-zA-Z0-9+.-]{1,31}/)\n  .replace('email', /[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/)\n  .getRegex();\n\nconst _inlineComment = edit(_comment).replace('(?:-->|$)', '-->').getRegex();\nconst tag = edit(\n  '^comment'\n    + '|^</[a-zA-Z][\\\\w:-]*\\\\s*>' // self-closing tag\n    + '|^<[a-zA-Z][\\\\w-]*(?:attribute)*?\\\\s*/?>' // open tag\n    + '|^<\\\\?[\\\\s\\\\S]*?\\\\?>' // processing instruction, e.g. <?php ?>\n    + '|^<![a-zA-Z]+\\\\s[\\\\s\\\\S]*?>' // declaration, e.g. <!DOCTYPE html>\n    + '|^<!\\\\[CDATA\\\\[[\\\\s\\\\S]*?\\\\]\\\\]>') // CDATA section\n  .replace('comment', _inlineComment)\n  .replace('attribute', /\\s+[a-zA-Z:_][\\w.:-]*(?:\\s*=\\s*\"[^\"]*\"|\\s*=\\s*'[^']*'|\\s*=\\s*[^\\s\"'=<>`]+)?/)\n  .getRegex();\n\nconst _inlineLabel = /(?:\\[(?:\\\\[\\s\\S]|[^\\[\\]\\\\])*\\]|\\\\[\\s\\S]|`+[^`]*?`+(?!`)|[^\\[\\]\\\\`])*?/;\n\nconst link = edit(/^!?\\[(label)\\]\\(\\s*(href)(?:(?:[ \\t]*(?:\\n[ \\t]*)?)(title))?\\s*\\)/)\n  .replace('label', _inlineLabel)\n  .replace('href', /<(?:\\\\.|[^\\n<>\\\\])+>|[^ \\t\\n\\x00-\\x1f]*/)\n  .replace('title', /\"(?:\\\\\"?|[^\"\\\\])*\"|'(?:\\\\'?|[^'\\\\])*'|\\((?:\\\\\\)?|[^)\\\\])*\\)/)\n  .getRegex();\n\nconst reflink = edit(/^!?\\[(label)\\]\\[(ref)\\]/)\n  .replace('label', _inlineLabel)\n  .replace('ref', _blockLabel)\n  .getRegex();\n\nconst nolink = edit(/^!?\\[(ref)\\](?:\\[\\])?/)\n  .replace('ref', _blockLabel)\n  .getRegex();\n\nconst reflinkSearch = edit('reflink|nolink(?!\\\\()', 'g')\n  .replace('reflink', reflink)\n  .replace('nolink', nolink)\n  .getRegex();\n\nconst _caseInsensitiveProtocol = /[hH][tT][tT][pP][sS]?|[fF][tT][pP]/;\n\n/**\n * Normal Inline Grammar\n */\n\nconst inlineNormal = {\n  _backpedal: noopTest, // only used for GFM url\n  anyPunctuation,\n  autolink,\n  blockSkip,\n  br,\n  code: inlineCode,\n  del: noopTest,\n  emStrongLDelim,\n  emStrongRDelimAst,\n  emStrongRDelimUnd,\n  escape,\n  link,\n  nolink,\n  punctuation,\n  reflink,\n  reflinkSearch,\n  tag,\n  text: inlineText,\n  url: noopTest,\n};\n\ntype InlineKeys = keyof typeof inlineNormal;\n\n/**\n * Pedantic Inline Grammar\n */\n\nconst inlinePedantic: Record<InlineKeys, RegExp> = {\n  ...inlineNormal,\n  link: edit(/^!?\\[(label)\\]\\((.*?)\\)/)\n    .replace('label', _inlineLabel)\n    .getRegex(),\n  reflink: edit(/^!?\\[(label)\\]\\s*\\[([^\\]]*)\\]/)\n    .replace('label', _inlineLabel)\n    .getRegex(),\n};\n\n/**\n * GFM Inline Grammar\n */\n\nconst inlineGfm: Record<InlineKeys, RegExp> = {\n  ...inlineNormal,\n  emStrongRDelimAst: emStrongRDelimAstGfm,\n  emStrongLDelim: emStrongLDelimGfm,\n  url: edit(/^((?:protocol):\\/\\/|www\\.)(?:[a-zA-Z0-9\\-]+\\.?)+[^\\s<]*|^email/)\n    .replace('protocol', _caseInsensitiveProtocol)\n    .replace('email', /[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/)\n    .getRegex(),\n  _backpedal: /(?:[^?!.,:;*_'\"~()&]+|\\([^)]*\\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'\"~)]+(?!$))+/,\n  del: /^(~~?)(?=[^\\s~])((?:\\\\[\\s\\S]|[^\\\\])*?(?:\\\\[\\s\\S]|[^\\s~\\\\]))\\1(?=[^~]|$)/,\n  text: edit(/^([`~]+|[^`~])(?:(?= {2,}\\n)|(?=[a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-]+@)|[\\s\\S]*?(?:(?=[\\\\<!\\[`*~_]|\\b_|protocol:\\/\\/|www\\.|$)|[^ ](?= {2,}\\n)|[^a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-](?=[a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-]+@)))/)\n    .replace('protocol', _caseInsensitiveProtocol)\n    .getRegex(),\n};\n\n/**\n * GFM + Line Breaks Inline Grammar\n */\n\nconst inlineBreaks: Record<InlineKeys, RegExp> = {\n  ...inlineGfm,\n  br: edit(br).replace('{2,}', '*').getRegex(),\n  text: edit(inlineGfm.text)\n    .replace('\\\\b_', '\\\\b_| {2,}\\\\n')\n    .replace(/\\{2,\\}/g, '*')\n    .getRegex(),\n};\n\n/**\n * exports\n */\n\nexport const block = {\n  normal: blockNormal,\n  gfm: blockGfm,\n  pedantic: blockPedantic,\n};\n\nexport const inline = {\n  normal: inlineNormal,\n  gfm: inlineGfm,\n  breaks: inlineBreaks,\n  pedantic: inlinePedantic,\n};\n\nexport interface Rules {\n  other: typeof other\n  block: Record<BlockKeys, RegExp>\n  inline: Record<InlineKeys, RegExp>\n}\n", "import { other } from './rules.ts';\n\n/**\n * Helpers\n */\nconst escapeReplacements: { [index: string]: string } = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  \"'\": '&#39;',\n};\nconst getEscapeReplacement = (ch: string) => escapeReplacements[ch];\n\nexport function escape(html: string, encode?: boolean) {\n  if (encode) {\n    if (other.escapeTest.test(html)) {\n      return html.replace(other.escapeReplace, getEscapeReplacement);\n    }\n  } else {\n    if (other.escapeTestNoEncode.test(html)) {\n      return html.replace(other.escapeReplaceNoEncode, getEscapeReplacement);\n    }\n  }\n\n  return html;\n}\n\nexport function unescape(html: string) {\n  // explicitly match decimal, hex, and named HTML entities\n  return html.replace(other.unescapeTest, (_, n) => {\n    n = n.toLowerCase();\n    if (n === 'colon') return ':';\n    if (n.charAt(0) === '#') {\n      return n.charAt(1) === 'x'\n        ? String.fromCharCode(parseInt(n.substring(2), 16))\n        : String.fromCharCode(+n.substring(1));\n    }\n    return '';\n  });\n}\n\nexport function cleanUrl(href: string) {\n  try {\n    href = encodeURI(href).replace(other.percentDecode, '%');\n  } catch {\n    return null;\n  }\n  return href;\n}\n\nexport function splitCells(tableRow: string, count?: number) {\n  // ensure that every cell-delimiting pipe has a space\n  // before it to distinguish it from an escaped pipe\n  const row = tableRow.replace(other.findPipe, (match, offset, str) => {\n      let escaped = false;\n      let curr = offset;\n      while (--curr >= 0 && str[curr] === '\\\\') escaped = !escaped;\n      if (escaped) {\n        // odd number of slashes means | is escaped\n        // so we leave it alone\n        return '|';\n      } else {\n        // add space before unescaped |\n        return ' |';\n      }\n    }),\n    cells = row.split(other.splitPipe);\n  let i = 0;\n\n  // First/last cell in a row cannot be empty if it has no leading/trailing pipe\n  if (!cells[0].trim()) {\n    cells.shift();\n  }\n  if (cells.length > 0 && !cells.at(-1)?.trim()) {\n    cells.pop();\n  }\n\n  if (count) {\n    if (cells.length > count) {\n      cells.splice(count);\n    } else {\n      while (cells.length < count) cells.push('');\n    }\n  }\n\n  for (; i < cells.length; i++) {\n    // leading or trailing whitespace is ignored per the gfm spec\n    cells[i] = cells[i].trim().replace(other.slashPipe, '|');\n  }\n  return cells;\n}\n\n/**\n * Remove trailing 'c's. Equivalent to str.replace(/c*$/, '').\n * /c*$/ is vulnerable to REDOS.\n *\n * @param str\n * @param c\n * @param invert Remove suffix of non-c chars instead. Default falsey.\n */\nexport function rtrim(str: string, c: string, invert?: boolean) {\n  const l = str.length;\n  if (l === 0) {\n    return '';\n  }\n\n  // Length of suffix matching the invert condition.\n  let suffLen = 0;\n\n  // Step left until we fail to match the invert condition.\n  while (suffLen < l) {\n    const currChar = str.charAt(l - suffLen - 1);\n    if (currChar === c && !invert) {\n      suffLen++;\n    } else if (currChar !== c && invert) {\n      suffLen++;\n    } else {\n      break;\n    }\n  }\n\n  return str.slice(0, l - suffLen);\n}\n\nexport function findClosingBracket(str: string, b: string) {\n  if (str.indexOf(b[1]) === -1) {\n    return -1;\n  }\n\n  let level = 0;\n  for (let i = 0; i < str.length; i++) {\n    if (str[i] === '\\\\') {\n      i++;\n    } else if (str[i] === b[0]) {\n      level++;\n    } else if (str[i] === b[1]) {\n      level--;\n      if (level < 0) {\n        return i;\n      }\n    }\n  }\n  if (level > 0) {\n    return -2;\n  }\n\n  return -1;\n}\n", "import { _defaults } from './defaults.ts';\nimport {\n  rtrim,\n  splitCells,\n  findClosingBracket,\n} from './helpers.ts';\nimport type { Rules } from './rules.ts';\nimport type { _Lexer } from './Lexer.ts';\nimport type { Links, Tokens, Token } from './Tokens.ts';\nimport type { MarkedOptions } from './MarkedOptions.ts';\n\nfunction outputLink(cap: string[], link: Pick<Tokens.Link, 'href' | 'title'>, raw: string, lexer: _Lexer, rules: Rules): Tokens.Link | Tokens.Image {\n  const href = link.href;\n  const title = link.title || null;\n  const text = cap[1].replace(rules.other.outputLinkReplace, '$1');\n\n  lexer.state.inLink = true;\n  const token: Tokens.Link | Tokens.Image = {\n    type: cap[0].charAt(0) === '!' ? 'image' : 'link',\n    raw,\n    href,\n    title,\n    text,\n    tokens: lexer.inlineTokens(text),\n  };\n  lexer.state.inLink = false;\n  return token;\n}\n\nfunction indentCodeCompensation(raw: string, text: string, rules: Rules) {\n  const matchIndentToCode = raw.match(rules.other.indentCodeCompensation);\n\n  if (matchIndentToCode === null) {\n    return text;\n  }\n\n  const indentToCode = matchIndentToCode[1];\n\n  return text\n    .split('\\n')\n    .map(node => {\n      const matchIndentInNode = node.match(rules.other.beginningSpace);\n      if (matchIndentInNode === null) {\n        return node;\n      }\n\n      const [indentInNode] = matchIndentInNode;\n\n      if (indentInNode.length >= indentToCode.length) {\n        return node.slice(indentToCode.length);\n      }\n\n      return node;\n    })\n    .join('\\n');\n}\n\n/**\n * Tokenizer\n */\nexport class _Tokenizer<ParserOutput = string, RendererOutput = string> {\n  options: MarkedOptions<ParserOutput, RendererOutput>;\n  rules!: Rules; // set by the lexer\n  lexer!: _Lexer<ParserOutput, RendererOutput>; // set by the lexer\n\n  constructor(options?: MarkedOptions<ParserOutput, RendererOutput>) {\n    this.options = options || _defaults;\n  }\n\n  space(src: string): Tokens.Space | undefined {\n    const cap = this.rules.block.newline.exec(src);\n    if (cap && cap[0].length > 0) {\n      return {\n        type: 'space',\n        raw: cap[0],\n      };\n    }\n  }\n\n  code(src: string): Tokens.Code | undefined {\n    const cap = this.rules.block.code.exec(src);\n    if (cap) {\n      const text = cap[0].replace(this.rules.other.codeRemoveIndent, '');\n      return {\n        type: 'code',\n        raw: cap[0],\n        codeBlockStyle: 'indented',\n        text: !this.options.pedantic\n          ? rtrim(text, '\\n')\n          : text,\n      };\n    }\n  }\n\n  fences(src: string): Tokens.Code | undefined {\n    const cap = this.rules.block.fences.exec(src);\n    if (cap) {\n      const raw = cap[0];\n      const text = indentCodeCompensation(raw, cap[3] || '', this.rules);\n\n      return {\n        type: 'code',\n        raw,\n        lang: cap[2] ? cap[2].trim().replace(this.rules.inline.anyPunctuation, '$1') : cap[2],\n        text,\n      };\n    }\n  }\n\n  heading(src: string): Tokens.Heading | undefined {\n    const cap = this.rules.block.heading.exec(src);\n    if (cap) {\n      let text = cap[2].trim();\n\n      // remove trailing #s\n      if (this.rules.other.endingHash.test(text)) {\n        const trimmed = rtrim(text, '#');\n        if (this.options.pedantic) {\n          text = trimmed.trim();\n        } else if (!trimmed || this.rules.other.endingSpaceChar.test(trimmed)) {\n          // CommonMark requires space before trailing #s\n          text = trimmed.trim();\n        }\n      }\n\n      return {\n        type: 'heading',\n        raw: cap[0],\n        depth: cap[1].length,\n        text,\n        tokens: this.lexer.inline(text),\n      };\n    }\n  }\n\n  hr(src: string): Tokens.Hr | undefined {\n    const cap = this.rules.block.hr.exec(src);\n    if (cap) {\n      return {\n        type: 'hr',\n        raw: rtrim(cap[0], '\\n'),\n      };\n    }\n  }\n\n  blockquote(src: string): Tokens.Blockquote | undefined {\n    const cap = this.rules.block.blockquote.exec(src);\n    if (cap) {\n      let lines = rtrim(cap[0], '\\n').split('\\n');\n      let raw = '';\n      let text = '';\n      const tokens: Token[] = [];\n\n      while (lines.length > 0) {\n        let inBlockquote = false;\n        const currentLines = [];\n\n        let i;\n        for (i = 0; i < lines.length; i++) {\n          // get lines up to a continuation\n          if (this.rules.other.blockquoteStart.test(lines[i])) {\n            currentLines.push(lines[i]);\n            inBlockquote = true;\n          } else if (!inBlockquote) {\n            currentLines.push(lines[i]);\n          } else {\n            break;\n          }\n        }\n        lines = lines.slice(i);\n\n        const currentRaw = currentLines.join('\\n');\n        const currentText = currentRaw\n          // precede setext continuation with 4 spaces so it isn't a setext\n          .replace(this.rules.other.blockquoteSetextReplace, '\\n    $1')\n          .replace(this.rules.other.blockquoteSetextReplace2, '');\n        raw = raw ? `${raw}\\n${currentRaw}` : currentRaw;\n        text = text ? `${text}\\n${currentText}` : currentText;\n\n        // parse blockquote lines as top level tokens\n        // merge paragraphs if this is a continuation\n        const top = this.lexer.state.top;\n        this.lexer.state.top = true;\n        this.lexer.blockTokens(currentText, tokens, true);\n        this.lexer.state.top = top;\n\n        // if there is no continuation then we are done\n        if (lines.length === 0) {\n          break;\n        }\n\n        const lastToken = tokens.at(-1);\n\n        if (lastToken?.type === 'code') {\n          // blockquote continuation cannot be preceded by a code block\n          break;\n        } else if (lastToken?.type === 'blockquote') {\n          // include continuation in nested blockquote\n          const oldToken = lastToken as Tokens.Blockquote;\n          const newText = oldToken.raw + '\\n' + lines.join('\\n');\n          const newToken = this.blockquote(newText)!;\n          tokens[tokens.length - 1] = newToken;\n\n          raw = raw.substring(0, raw.length - oldToken.raw.length) + newToken.raw;\n          text = text.substring(0, text.length - oldToken.text.length) + newToken.text;\n          break;\n        } else if (lastToken?.type === 'list') {\n          // include continuation in nested list\n          const oldToken = lastToken as Tokens.List;\n          const newText = oldToken.raw + '\\n' + lines.join('\\n');\n          const newToken = this.list(newText)!;\n          tokens[tokens.length - 1] = newToken;\n\n          raw = raw.substring(0, raw.length - lastToken.raw.length) + newToken.raw;\n          text = text.substring(0, text.length - oldToken.raw.length) + newToken.raw;\n          lines = newText.substring(tokens.at(-1)!.raw.length).split('\\n');\n          continue;\n        }\n      }\n\n      return {\n        type: 'blockquote',\n        raw,\n        tokens,\n        text,\n      };\n    }\n  }\n\n  list(src: string): Tokens.List | undefined {\n    let cap = this.rules.block.list.exec(src);\n    if (cap) {\n      let bull = cap[1].trim();\n      const isordered = bull.length > 1;\n\n      const list: Tokens.List = {\n        type: 'list',\n        raw: '',\n        ordered: isordered,\n        start: isordered ? +bull.slice(0, -1) : '',\n        loose: false,\n        items: [],\n      };\n\n      bull = isordered ? `\\\\d{1,9}\\\\${bull.slice(-1)}` : `\\\\${bull}`;\n\n      if (this.options.pedantic) {\n        bull = isordered ? bull : '[*+-]';\n      }\n\n      // Get next list item\n      const itemRegex = this.rules.other.listItemRegex(bull);\n      let endsWithBlankLine = false;\n      // Check if current bullet point can start a new List Item\n      while (src) {\n        let endEarly = false;\n        let raw = '';\n        let itemContents = '';\n        if (!(cap = itemRegex.exec(src))) {\n          break;\n        }\n\n        if (this.rules.block.hr.test(src)) { // End list if bullet was actually HR (possibly move into itemRegex?)\n          break;\n        }\n\n        raw = cap[0];\n        src = src.substring(raw.length);\n\n        let line = cap[2].split('\\n', 1)[0].replace(this.rules.other.listReplaceTabs, (t: string) => ' '.repeat(3 * t.length));\n        let nextLine = src.split('\\n', 1)[0];\n        let blankLine = !line.trim();\n\n        let indent = 0;\n        if (this.options.pedantic) {\n          indent = 2;\n          itemContents = line.trimStart();\n        } else if (blankLine) {\n          indent = cap[1].length + 1;\n        } else {\n          indent = cap[2].search(this.rules.other.nonSpaceChar); // Find first non-space char\n          indent = indent > 4 ? 1 : indent; // Treat indented code blocks (> 4 spaces) as having only 1 indent\n          itemContents = line.slice(indent);\n          indent += cap[1].length;\n        }\n\n        if (blankLine && this.rules.other.blankLine.test(nextLine)) { // Items begin with at most one blank line\n          raw += nextLine + '\\n';\n          src = src.substring(nextLine.length + 1);\n          endEarly = true;\n        }\n\n        if (!endEarly) {\n          const nextBulletRegex = this.rules.other.nextBulletRegex(indent);\n          const hrRegex = this.rules.other.hrRegex(indent);\n          const fencesBeginRegex = this.rules.other.fencesBeginRegex(indent);\n          const headingBeginRegex = this.rules.other.headingBeginRegex(indent);\n          const htmlBeginRegex = this.rules.other.htmlBeginRegex(indent);\n\n          // Check if following lines should be included in List Item\n          while (src) {\n            const rawLine = src.split('\\n', 1)[0];\n            let nextLineWithoutTabs;\n            nextLine = rawLine;\n\n            // Re-align to follow commonmark nesting rules\n            if (this.options.pedantic) {\n              nextLine = nextLine.replace(this.rules.other.listReplaceNesting, '  ');\n              nextLineWithoutTabs = nextLine;\n            } else {\n              nextLineWithoutTabs = nextLine.replace(this.rules.other.tabCharGlobal, '    ');\n            }\n\n            // End list item if found code fences\n            if (fencesBeginRegex.test(nextLine)) {\n              break;\n            }\n\n            // End list item if found start of new heading\n            if (headingBeginRegex.test(nextLine)) {\n              break;\n            }\n\n            // End list item if found start of html block\n            if (htmlBeginRegex.test(nextLine)) {\n              break;\n            }\n\n            // End list item if found start of new bullet\n            if (nextBulletRegex.test(nextLine)) {\n              break;\n            }\n\n            // Horizontal rule found\n            if (hrRegex.test(nextLine)) {\n              break;\n            }\n\n            if (nextLineWithoutTabs.search(this.rules.other.nonSpaceChar) >= indent || !nextLine.trim()) { // Dedent if possible\n              itemContents += '\\n' + nextLineWithoutTabs.slice(indent);\n            } else {\n              // not enough indentation\n              if (blankLine) {\n                break;\n              }\n\n              // paragraph continuation unless last line was a different block level element\n              if (line.replace(this.rules.other.tabCharGlobal, '    ').search(this.rules.other.nonSpaceChar) >= 4) { // indented code block\n                break;\n              }\n              if (fencesBeginRegex.test(line)) {\n                break;\n              }\n              if (headingBeginRegex.test(line)) {\n                break;\n              }\n              if (hrRegex.test(line)) {\n                break;\n              }\n\n              itemContents += '\\n' + nextLine;\n            }\n\n            if (!blankLine && !nextLine.trim()) { // Check if current line is blank\n              blankLine = true;\n            }\n\n            raw += rawLine + '\\n';\n            src = src.substring(rawLine.length + 1);\n            line = nextLineWithoutTabs.slice(indent);\n          }\n        }\n\n        if (!list.loose) {\n          // If the previous item ended with a blank line, the list is loose\n          if (endsWithBlankLine) {\n            list.loose = true;\n          } else if (this.rules.other.doubleBlankLine.test(raw)) {\n            endsWithBlankLine = true;\n          }\n        }\n\n        list.items.push({\n          type: 'list_item',\n          raw,\n          task: !!this.options.gfm && this.rules.other.listIsTask.test(itemContents),\n          loose: false,\n          text: itemContents,\n          tokens: [],\n        });\n\n        list.raw += raw;\n      }\n\n      // Do not consume newlines at end of final item. Alternatively, make itemRegex *start* with any newlines to simplify/speed up endsWithBlankLine logic\n      const lastItem = list.items.at(-1);\n      if (lastItem) {\n        lastItem.raw = lastItem.raw.trimEnd();\n        lastItem.text = lastItem.text.trimEnd();\n      } else {\n        // not a list since there were no items\n        return;\n      }\n      list.raw = list.raw.trimEnd();\n\n      // Item child tokens handled here at end because we needed to have the final item to trim it first\n      for (const item of list.items) {\n        this.lexer.state.top = false;\n        item.tokens = this.lexer.blockTokens(item.text, []);\n        if (item.task) {\n          // Remove checkbox markdown from item tokens\n          item.text = item.text.replace(this.rules.other.listReplaceTask, '');\n          if (item.tokens[0]?.type === 'text' || item.tokens[0]?.type === 'paragraph') {\n            item.tokens[0].raw = item.tokens[0].raw.replace(this.rules.other.listReplaceTask, '');\n            item.tokens[0].text = item.tokens[0].text.replace(this.rules.other.listReplaceTask, '');\n            for (let i = this.lexer.inlineQueue.length - 1; i >= 0; i--) {\n              if (this.rules.other.listIsTask.test(this.lexer.inlineQueue[i].src)) {\n                this.lexer.inlineQueue[i].src = this.lexer.inlineQueue[i].src.replace(this.rules.other.listReplaceTask, '');\n                break;\n              }\n            }\n          }\n\n          const taskRaw = this.rules.other.listTaskCheckbox.exec(item.raw);\n          if (taskRaw) {\n            const checkboxToken: Tokens.Checkbox = {\n              type: 'checkbox',\n              raw: taskRaw[0] + ' ',\n              checked: taskRaw[0] !== '[ ]',\n            };\n            item.checked = checkboxToken.checked;\n            if (list.loose) {\n              if (item.tokens[0] && ['paragraph', 'text'].includes(item.tokens[0].type) && 'tokens' in item.tokens[0] && item.tokens[0].tokens) {\n                item.tokens[0].raw = checkboxToken.raw + item.tokens[0].raw;\n                item.tokens[0].text = checkboxToken.raw + item.tokens[0].text;\n                item.tokens[0].tokens.unshift(checkboxToken);\n              } else {\n                item.tokens.unshift({\n                  type: 'paragraph',\n                  raw: checkboxToken.raw,\n                  text: checkboxToken.raw,\n                  tokens: [checkboxToken],\n                });\n              }\n            } else {\n              item.tokens.unshift(checkboxToken);\n            }\n          }\n        }\n\n        if (!list.loose) {\n          // Check if list should be loose\n          const spacers = item.tokens.filter(t => t.type === 'space');\n          const hasMultipleLineBreaks = spacers.length > 0 && spacers.some(t => this.rules.other.anyLine.test(t.raw));\n\n          list.loose = hasMultipleLineBreaks;\n        }\n      }\n\n      // Set all items to loose if list is loose\n      if (list.loose) {\n        for (const item of list.items) {\n          item.loose = true;\n          for (const token of item.tokens) {\n            if (token.type === 'text') {\n              token.type = 'paragraph';\n            }\n          }\n        }\n      }\n\n      return list;\n    }\n  }\n\n  html(src: string): Tokens.HTML | undefined {\n    const cap = this.rules.block.html.exec(src);\n    if (cap) {\n      const token: Tokens.HTML = {\n        type: 'html',\n        block: true,\n        raw: cap[0],\n        pre: cap[1] === 'pre' || cap[1] === 'script' || cap[1] === 'style',\n        text: cap[0],\n      };\n      return token;\n    }\n  }\n\n  def(src: string): Tokens.Def | undefined {\n    const cap = this.rules.block.def.exec(src);\n    if (cap) {\n      const tag = cap[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal, ' ');\n      const href = cap[2] ? cap[2].replace(this.rules.other.hrefBrackets, '$1').replace(this.rules.inline.anyPunctuation, '$1') : '';\n      const title = cap[3] ? cap[3].substring(1, cap[3].length - 1).replace(this.rules.inline.anyPunctuation, '$1') : cap[3];\n      return {\n        type: 'def',\n        tag,\n        raw: cap[0],\n        href,\n        title,\n      };\n    }\n  }\n\n  table(src: string): Tokens.Table | undefined {\n    const cap = this.rules.block.table.exec(src);\n    if (!cap) {\n      return;\n    }\n\n    if (!this.rules.other.tableDelimiter.test(cap[2])) {\n      // delimiter row must have a pipe (|) or colon (:) otherwise it is a setext heading\n      return;\n    }\n\n    const headers = splitCells(cap[1]);\n    const aligns = cap[2].replace(this.rules.other.tableAlignChars, '').split('|');\n    const rows = cap[3]?.trim() ? cap[3].replace(this.rules.other.tableRowBlankLine, '').split('\\n') : [];\n\n    const item: Tokens.Table = {\n      type: 'table',\n      raw: cap[0],\n      header: [],\n      align: [],\n      rows: [],\n    };\n\n    if (headers.length !== aligns.length) {\n      // header and align columns must be equal, rows can be different.\n      return;\n    }\n\n    for (const align of aligns) {\n      if (this.rules.other.tableAlignRight.test(align)) {\n        item.align.push('right');\n      } else if (this.rules.other.tableAlignCenter.test(align)) {\n        item.align.push('center');\n      } else if (this.rules.other.tableAlignLeft.test(align)) {\n        item.align.push('left');\n      } else {\n        item.align.push(null);\n      }\n    }\n\n    for (let i = 0; i < headers.length; i++) {\n      item.header.push({\n        text: headers[i],\n        tokens: this.lexer.inline(headers[i]),\n        header: true,\n        align: item.align[i],\n      });\n    }\n\n    for (const row of rows) {\n      item.rows.push(splitCells(row, item.header.length).map((cell, i) => {\n        return {\n          text: cell,\n          tokens: this.lexer.inline(cell),\n          header: false,\n          align: item.align[i],\n        };\n      }));\n    }\n\n    return item;\n  }\n\n  lheading(src: string): Tokens.Heading | undefined {\n    const cap = this.rules.block.lheading.exec(src);\n    if (cap) {\n      return {\n        type: 'heading',\n        raw: cap[0],\n        depth: cap[2].charAt(0) === '=' ? 1 : 2,\n        text: cap[1],\n        tokens: this.lexer.inline(cap[1]),\n      };\n    }\n  }\n\n  paragraph(src: string): Tokens.Paragraph | undefined {\n    const cap = this.rules.block.paragraph.exec(src);\n    if (cap) {\n      const text = cap[1].charAt(cap[1].length - 1) === '\\n'\n        ? cap[1].slice(0, -1)\n        : cap[1];\n      return {\n        type: 'paragraph',\n        raw: cap[0],\n        text,\n        tokens: this.lexer.inline(text),\n      };\n    }\n  }\n\n  text(src: string): Tokens.Text | undefined {\n    const cap = this.rules.block.text.exec(src);\n    if (cap) {\n      return {\n        type: 'text',\n        raw: cap[0],\n        text: cap[0],\n        tokens: this.lexer.inline(cap[0]),\n      };\n    }\n  }\n\n  escape(src: string): Tokens.Escape | undefined {\n    const cap = this.rules.inline.escape.exec(src);\n    if (cap) {\n      return {\n        type: 'escape',\n        raw: cap[0],\n        text: cap[1],\n      };\n    }\n  }\n\n  tag(src: string): Tokens.Tag | undefined {\n    const cap = this.rules.inline.tag.exec(src);\n    if (cap) {\n      if (!this.lexer.state.inLink && this.rules.other.startATag.test(cap[0])) {\n        this.lexer.state.inLink = true;\n      } else if (this.lexer.state.inLink && this.rules.other.endATag.test(cap[0])) {\n        this.lexer.state.inLink = false;\n      }\n      if (!this.lexer.state.inRawBlock && this.rules.other.startPreScriptTag.test(cap[0])) {\n        this.lexer.state.inRawBlock = true;\n      } else if (this.lexer.state.inRawBlock && this.rules.other.endPreScriptTag.test(cap[0])) {\n        this.lexer.state.inRawBlock = false;\n      }\n\n      return {\n        type: 'html',\n        raw: cap[0],\n        inLink: this.lexer.state.inLink,\n        inRawBlock: this.lexer.state.inRawBlock,\n        block: false,\n        text: cap[0],\n      };\n    }\n  }\n\n  link(src: string): Tokens.Link | Tokens.Image | undefined {\n    const cap = this.rules.inline.link.exec(src);\n    if (cap) {\n      const trimmedUrl = cap[2].trim();\n      if (!this.options.pedantic && this.rules.other.startAngleBracket.test(trimmedUrl)) {\n        // commonmark requires matching angle brackets\n        if (!(this.rules.other.endAngleBracket.test(trimmedUrl))) {\n          return;\n        }\n\n        // ending angle bracket cannot be escaped\n        const rtrimSlash = rtrim(trimmedUrl.slice(0, -1), '\\\\');\n        if ((trimmedUrl.length - rtrimSlash.length) % 2 === 0) {\n          return;\n        }\n      } else {\n        // find closing parenthesis\n        const lastParenIndex = findClosingBracket(cap[2], '()');\n        if (lastParenIndex === -2) {\n          // more open parens than closed\n          return;\n        }\n\n        if (lastParenIndex > -1) {\n          const start = cap[0].indexOf('!') === 0 ? 5 : 4;\n          const linkLen = start + cap[1].length + lastParenIndex;\n          cap[2] = cap[2].substring(0, lastParenIndex);\n          cap[0] = cap[0].substring(0, linkLen).trim();\n          cap[3] = '';\n        }\n      }\n      let href = cap[2];\n      let title = '';\n      if (this.options.pedantic) {\n        // split pedantic href and title\n        const link = this.rules.other.pedanticHrefTitle.exec(href);\n\n        if (link) {\n          href = link[1];\n          title = link[3];\n        }\n      } else {\n        title = cap[3] ? cap[3].slice(1, -1) : '';\n      }\n\n      href = href.trim();\n      if (this.rules.other.startAngleBracket.test(href)) {\n        if (this.options.pedantic && !(this.rules.other.endAngleBracket.test(trimmedUrl))) {\n          // pedantic allows starting angle bracket without ending angle bracket\n          href = href.slice(1);\n        } else {\n          href = href.slice(1, -1);\n        }\n      }\n      return outputLink(cap, {\n        href: href ? href.replace(this.rules.inline.anyPunctuation, '$1') : href,\n        title: title ? title.replace(this.rules.inline.anyPunctuation, '$1') : title,\n      }, cap[0], this.lexer, this.rules);\n    }\n  }\n\n  reflink(src: string, links: Links): Tokens.Link | Tokens.Image | Tokens.Text | undefined {\n    let cap;\n    if ((cap = this.rules.inline.reflink.exec(src))\n      || (cap = this.rules.inline.nolink.exec(src))) {\n      const linkString = (cap[2] || cap[1]).replace(this.rules.other.multipleSpaceGlobal, ' ');\n      const link = links[linkString.toLowerCase()];\n      if (!link) {\n        const text = cap[0].charAt(0);\n        return {\n          type: 'text',\n          raw: text,\n          text,\n        };\n      }\n      return outputLink(cap, link, cap[0], this.lexer, this.rules);\n    }\n  }\n\n  emStrong(src: string, maskedSrc: string, prevChar = ''): Tokens.Em | Tokens.Strong | undefined {\n    let match = this.rules.inline.emStrongLDelim.exec(src);\n    if (!match) return;\n\n    // _ can't be between two alphanumerics. \\p{L}\\p{N} includes non-english alphabet/numbers as well\n    if (match[3] && prevChar.match(this.rules.other.unicodeAlphaNumeric)) return;\n\n    const nextChar = match[1] || match[2] || '';\n\n    if (!nextChar || !prevChar || this.rules.inline.punctuation.exec(prevChar)) {\n      // unicode Regex counts emoji as 1 char; spread into array for proper count (used multiple times below)\n      const lLength = [...match[0]].length - 1;\n      let rDelim, rLength, delimTotal = lLength, midDelimTotal = 0;\n\n      const endReg = match[0][0] === '*' ? this.rules.inline.emStrongRDelimAst : this.rules.inline.emStrongRDelimUnd;\n      endReg.lastIndex = 0;\n\n      // Clip maskedSrc to same section of string as src (move to lexer?)\n      maskedSrc = maskedSrc.slice(-1 * src.length + lLength);\n\n      while ((match = endReg.exec(maskedSrc)) != null) {\n        rDelim = match[1] || match[2] || match[3] || match[4] || match[5] || match[6];\n\n        if (!rDelim) continue; // skip single * in __abc*abc__\n\n        rLength = [...rDelim].length;\n\n        if (match[3] || match[4]) { // found another Left Delim\n          delimTotal += rLength;\n          continue;\n        } else if (match[5] || match[6]) { // either Left or Right Delim\n          if (lLength % 3 && !((lLength + rLength) % 3)) {\n            midDelimTotal += rLength;\n            continue; // CommonMark Emphasis Rules 9-10\n          }\n        }\n\n        delimTotal -= rLength;\n\n        if (delimTotal > 0) continue; // Haven't found enough closing delimiters\n\n        // Remove extra characters. *a*** -> *a*\n        rLength = Math.min(rLength, rLength + delimTotal + midDelimTotal);\n        // char length can be >1 for unicode characters;\n        const lastCharLength = [...match[0]][0].length;\n        const raw = src.slice(0, lLength + match.index + lastCharLength + rLength);\n\n        // Create `em` if smallest delimiter has odd char count. *a***\n        if (Math.min(lLength, rLength) % 2) {\n          const text = raw.slice(1, -1);\n          return {\n            type: 'em',\n            raw,\n            text,\n            tokens: this.lexer.inlineTokens(text),\n          };\n        }\n\n        // Create 'strong' if smallest delimiter has even char count. **a***\n        const text = raw.slice(2, -2);\n        return {\n          type: 'strong',\n          raw,\n          text,\n          tokens: this.lexer.inlineTokens(text),\n        };\n      }\n    }\n  }\n\n  codespan(src: string): Tokens.Codespan | undefined {\n    const cap = this.rules.inline.code.exec(src);\n    if (cap) {\n      let text = cap[2].replace(this.rules.other.newLineCharGlobal, ' ');\n      const hasNonSpaceChars = this.rules.other.nonSpaceChar.test(text);\n      const hasSpaceCharsOnBothEnds = this.rules.other.startingSpaceChar.test(text) && this.rules.other.endingSpaceChar.test(text);\n      if (hasNonSpaceChars && hasSpaceCharsOnBothEnds) {\n        text = text.substring(1, text.length - 1);\n      }\n      return {\n        type: 'codespan',\n        raw: cap[0],\n        text,\n      };\n    }\n  }\n\n  br(src: string): Tokens.Br | undefined {\n    const cap = this.rules.inline.br.exec(src);\n    if (cap) {\n      return {\n        type: 'br',\n        raw: cap[0],\n      };\n    }\n  }\n\n  del(src: string): Tokens.Del | undefined {\n    const cap = this.rules.inline.del.exec(src);\n    if (cap) {\n      return {\n        type: 'del',\n        raw: cap[0],\n        text: cap[2],\n        tokens: this.lexer.inlineTokens(cap[2]),\n      };\n    }\n  }\n\n  autolink(src: string): Tokens.Link | undefined {\n    const cap = this.rules.inline.autolink.exec(src);\n    if (cap) {\n      let text, href;\n      if (cap[2] === '@') {\n        text = cap[1];\n        href = 'mailto:' + text;\n      } else {\n        text = cap[1];\n        href = text;\n      }\n\n      return {\n        type: 'link',\n        raw: cap[0],\n        text,\n        href,\n        tokens: [\n          {\n            type: 'text',\n            raw: text,\n            text,\n          },\n        ],\n      };\n    }\n  }\n\n  url(src: string): Tokens.Link | undefined {\n    let cap;\n    if (cap = this.rules.inline.url.exec(src)) {\n      let text, href;\n      if (cap[2] === '@') {\n        text = cap[0];\n        href = 'mailto:' + text;\n      } else {\n        // do extended autolink path validation\n        let prevCapZero;\n        do {\n          prevCapZero = cap[0];\n          cap[0] = this.rules.inline._backpedal.exec(cap[0])?.[0] ?? '';\n        } while (prevCapZero !== cap[0]);\n        text = cap[0];\n        if (cap[1] === 'www.') {\n          href = 'http://' + cap[0];\n        } else {\n          href = cap[0];\n        }\n      }\n      return {\n        type: 'link',\n        raw: cap[0],\n        text,\n        href,\n        tokens: [\n          {\n            type: 'text',\n            raw: text,\n            text,\n          },\n        ],\n      };\n    }\n  }\n\n  inlineText(src: string): Tokens.Text | undefined {\n    const cap = this.rules.inline.text.exec(src);\n    if (cap) {\n      const escaped = this.lexer.state.inRawBlock;\n      return {\n        type: 'text',\n        raw: cap[0],\n        text: cap[0],\n        escaped,\n      };\n    }\n  }\n}\n", "import { _Tokenizer } from './Tokenizer.ts';\nimport { _defaults } from './defaults.ts';\nimport { other, block, inline } from './rules.ts';\nimport type { Token, TokensList, Tokens } from './Tokens.ts';\nimport type { MarkedOptions } from './MarkedOptions.ts';\n\n/**\n * Block Lexer\n */\nexport class _Lexer<ParserOutput = string, RendererOutput = string> {\n  tokens: TokensList;\n  options: MarkedOptions<ParserOutput, RendererOutput>;\n  state: {\n    inLink: boolean;\n    inRawBlock: boolean;\n    top: boolean;\n  };\n\n  public inlineQueue: { src: string, tokens: Token[] }[];\n\n  private tokenizer: _Tokenizer<ParserOutput, RendererOutput>;\n\n  constructor(options?: MarkedOptions<ParserOutput, RendererOutput>) {\n    // TokenList cannot be created in one go\n    this.tokens = [] as unknown as TokensList;\n    this.tokens.links = Object.create(null);\n    this.options = options || _defaults;\n    this.options.tokenizer = this.options.tokenizer || new _Tokenizer<ParserOutput, RendererOutput>();\n    this.tokenizer = this.options.tokenizer;\n    this.tokenizer.options = this.options;\n    this.tokenizer.lexer = this;\n    this.inlineQueue = [];\n    this.state = {\n      inLink: false,\n      inRawBlock: false,\n      top: true,\n    };\n\n    const rules = {\n      other,\n      block: block.normal,\n      inline: inline.normal,\n    };\n\n    if (this.options.pedantic) {\n      rules.block = block.pedantic;\n      rules.inline = inline.pedantic;\n    } else if (this.options.gfm) {\n      rules.block = block.gfm;\n      if (this.options.breaks) {\n        rules.inline = inline.breaks;\n      } else {\n        rules.inline = inline.gfm;\n      }\n    }\n    this.tokenizer.rules = rules;\n  }\n\n  /**\n   * Expose Rules\n   */\n  static get rules() {\n    return {\n      block,\n      inline,\n    };\n  }\n\n  /**\n   * Static Lex Method\n   */\n  static lex<ParserOutput = string, RendererOutput = string>(src: string, options?: MarkedOptions<ParserOutput, RendererOutput>) {\n    const lexer = new _Lexer<ParserOutput, RendererOutput>(options);\n    return lexer.lex(src);\n  }\n\n  /**\n   * Static Lex Inline Method\n   */\n  static lexInline<ParserOutput = string, RendererOutput = string>(src: string, options?: MarkedOptions<ParserOutput, RendererOutput>) {\n    const lexer = new _Lexer<ParserOutput, RendererOutput>(options);\n    return lexer.inlineTokens(src);\n  }\n\n  /**\n   * Preprocessing\n   */\n  lex(src: string) {\n    src = src.replace(other.carriageReturn, '\\n');\n\n    this.blockTokens(src, this.tokens);\n\n    for (let i = 0; i < this.inlineQueue.length; i++) {\n      const next = this.inlineQueue[i];\n      this.inlineTokens(next.src, next.tokens);\n    }\n    this.inlineQueue = [];\n\n    return this.tokens;\n  }\n\n  /**\n   * Lexing\n   */\n  blockTokens(src: string, tokens?: Token[], lastParagraphClipped?: boolean): Token[];\n  blockTokens(src: string, tokens?: TokensList, lastParagraphClipped?: boolean): TokensList;\n  blockTokens(src: string, tokens: Token[] = [], lastParagraphClipped = false) {\n    if (this.options.pedantic) {\n      src = src.replace(other.tabCharGlobal, '    ').replace(other.spaceLine, '');\n    }\n\n    while (src) {\n      let token: Tokens.Generic | undefined;\n\n      if (this.options.extensions?.block?.some((extTokenizer) => {\n        if (token = extTokenizer.call({ lexer: this }, src, tokens)) {\n          src = src.substring(token.raw.length);\n          tokens.push(token);\n          return true;\n        }\n        return false;\n      })) {\n        continue;\n      }\n\n      // newline\n      if (token = this.tokenizer.space(src)) {\n        src = src.substring(token.raw.length);\n        const lastToken = tokens.at(-1);\n        if (token.raw.length === 1 && lastToken !== undefined) {\n          // if there's a single \\n as a spacer, it's terminating the last line,\n          // so move it there so that we don't get unnecessary paragraph tags\n          lastToken.raw += '\\n';\n        } else {\n          tokens.push(token);\n        }\n        continue;\n      }\n\n      // code\n      if (token = this.tokenizer.code(src)) {\n        src = src.substring(token.raw.length);\n        const lastToken = tokens.at(-1);\n        // An indented code block cannot interrupt a paragraph.\n        if (lastToken?.type === 'paragraph' || lastToken?.type === 'text') {\n          lastToken.raw += (lastToken.raw.endsWith('\\n') ? '' : '\\n') + token.raw;\n          lastToken.text += '\\n' + token.text;\n          this.inlineQueue.at(-1)!.src = lastToken.text;\n        } else {\n          tokens.push(token);\n        }\n        continue;\n      }\n\n      // fences\n      if (token = this.tokenizer.fences(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // heading\n      if (token = this.tokenizer.heading(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // hr\n      if (token = this.tokenizer.hr(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // blockquote\n      if (token = this.tokenizer.blockquote(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // list\n      if (token = this.tokenizer.list(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // html\n      if (token = this.tokenizer.html(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // def\n      if (token = this.tokenizer.def(src)) {\n        src = src.substring(token.raw.length);\n        const lastToken = tokens.at(-1);\n        if (lastToken?.type === 'paragraph' || lastToken?.type === 'text') {\n          lastToken.raw += (lastToken.raw.endsWith('\\n') ? '' : '\\n') + token.raw;\n          lastToken.text += '\\n' + token.raw;\n          this.inlineQueue.at(-1)!.src = lastToken.text;\n        } else if (!this.tokens.links[token.tag]) {\n          this.tokens.links[token.tag] = {\n            href: token.href,\n            title: token.title,\n          };\n          tokens.push(token);\n        }\n        continue;\n      }\n\n      // table (gfm)\n      if (token = this.tokenizer.table(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // lheading\n      if (token = this.tokenizer.lheading(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // top-level paragraph\n      // prevent paragraph consuming extensions by clipping 'src' to extension start\n      let cutSrc = src;\n      if (this.options.extensions?.startBlock) {\n        let startIndex = Infinity;\n        const tempSrc = src.slice(1);\n        let tempStart;\n        this.options.extensions.startBlock.forEach((getStartIndex) => {\n          tempStart = getStartIndex.call({ lexer: this }, tempSrc);\n          if (typeof tempStart === 'number' && tempStart >= 0) {\n            startIndex = Math.min(startIndex, tempStart);\n          }\n        });\n        if (startIndex < Infinity && startIndex >= 0) {\n          cutSrc = src.substring(0, startIndex + 1);\n        }\n      }\n      if (this.state.top && (token = this.tokenizer.paragraph(cutSrc))) {\n        const lastToken = tokens.at(-1);\n        if (lastParagraphClipped && lastToken?.type === 'paragraph') {\n          lastToken.raw += (lastToken.raw.endsWith('\\n') ? '' : '\\n') + token.raw;\n          lastToken.text += '\\n' + token.text;\n          this.inlineQueue.pop();\n          this.inlineQueue.at(-1)!.src = lastToken.text;\n        } else {\n          tokens.push(token);\n        }\n        lastParagraphClipped = cutSrc.length !== src.length;\n        src = src.substring(token.raw.length);\n        continue;\n      }\n\n      // text\n      if (token = this.tokenizer.text(src)) {\n        src = src.substring(token.raw.length);\n        const lastToken = tokens.at(-1);\n        if (lastToken?.type === 'text') {\n          lastToken.raw += (lastToken.raw.endsWith('\\n') ? '' : '\\n') + token.raw;\n          lastToken.text += '\\n' + token.text;\n          this.inlineQueue.pop();\n          this.inlineQueue.at(-1)!.src = lastToken.text;\n        } else {\n          tokens.push(token);\n        }\n        continue;\n      }\n\n      if (src) {\n        const errMsg = 'Infinite loop on byte: ' + src.charCodeAt(0);\n        if (this.options.silent) {\n          console.error(errMsg);\n          break;\n        } else {\n          throw new Error(errMsg);\n        }\n      }\n    }\n\n    this.state.top = true;\n    return tokens;\n  }\n\n  inline(src: string, tokens: Token[] = []) {\n    this.inlineQueue.push({ src, tokens });\n    return tokens;\n  }\n\n  /**\n   * Lexing/Compiling\n   */\n  inlineTokens(src: string, tokens: Token[] = []): Token[] {\n    // String with links masked to avoid interference with em and strong\n    let maskedSrc = src;\n    let match: RegExpExecArray | null = null;\n\n    // Mask out reflinks\n    if (this.tokens.links) {\n      const links = Object.keys(this.tokens.links);\n      if (links.length > 0) {\n        while ((match = this.tokenizer.rules.inline.reflinkSearch.exec(maskedSrc)) != null) {\n          if (links.includes(match[0].slice(match[0].lastIndexOf('[') + 1, -1))) {\n            maskedSrc = maskedSrc.slice(0, match.index)\n              + '[' + 'a'.repeat(match[0].length - 2) + ']'\n              + maskedSrc.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex);\n          }\n        }\n      }\n    }\n\n    // Mask out escaped characters\n    while ((match = this.tokenizer.rules.inline.anyPunctuation.exec(maskedSrc)) != null) {\n      maskedSrc = maskedSrc.slice(0, match.index) + '++' + maskedSrc.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);\n    }\n\n    // Mask out other blocks\n    let offset;\n    while ((match = this.tokenizer.rules.inline.blockSkip.exec(maskedSrc)) != null) {\n      offset = match[2] ? match[2].length : 0;\n      maskedSrc = maskedSrc.slice(0, match.index + offset) + '[' + 'a'.repeat(match[0].length - offset - 2) + ']' + maskedSrc.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);\n    }\n\n    // Mask out blocks from extensions\n    maskedSrc = this.options.hooks?.emStrongMask?.call({ lexer: this }, maskedSrc) ?? maskedSrc;\n\n    let keepPrevChar = false;\n    let prevChar = '';\n    while (src) {\n      if (!keepPrevChar) {\n        prevChar = '';\n      }\n      keepPrevChar = false;\n\n      let token: Tokens.Generic | undefined;\n\n      // extensions\n      if (this.options.extensions?.inline?.some((extTokenizer) => {\n        if (token = extTokenizer.call({ lexer: this }, src, tokens)) {\n          src = src.substring(token.raw.length);\n          tokens.push(token);\n          return true;\n        }\n        return false;\n      })) {\n        continue;\n      }\n\n      // escape\n      if (token = this.tokenizer.escape(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // tag\n      if (token = this.tokenizer.tag(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // link\n      if (token = this.tokenizer.link(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // reflink, nolink\n      if (token = this.tokenizer.reflink(src, this.tokens.links)) {\n        src = src.substring(token.raw.length);\n        const lastToken = tokens.at(-1);\n        if (token.type === 'text' && lastToken?.type === 'text') {\n          lastToken.raw += token.raw;\n          lastToken.text += token.text;\n        } else {\n          tokens.push(token);\n        }\n        continue;\n      }\n\n      // em & strong\n      if (token = this.tokenizer.emStrong(src, maskedSrc, prevChar)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // code\n      if (token = this.tokenizer.codespan(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // br\n      if (token = this.tokenizer.br(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // del (gfm)\n      if (token = this.tokenizer.del(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // autolink\n      if (token = this.tokenizer.autolink(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // url (gfm)\n      if (!this.state.inLink && (token = this.tokenizer.url(src))) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // text\n      // prevent inlineText consuming extensions by clipping 'src' to extension start\n      let cutSrc = src;\n      if (this.options.extensions?.startInline) {\n        let startIndex = Infinity;\n        const tempSrc = src.slice(1);\n        let tempStart;\n        this.options.extensions.startInline.forEach((getStartIndex) => {\n          tempStart = getStartIndex.call({ lexer: this }, tempSrc);\n          if (typeof tempStart === 'number' && tempStart >= 0) {\n            startIndex = Math.min(startIndex, tempStart);\n          }\n        });\n        if (startIndex < Infinity && startIndex >= 0) {\n          cutSrc = src.substring(0, startIndex + 1);\n        }\n      }\n      if (token = this.tokenizer.inlineText(cutSrc)) {\n        src = src.substring(token.raw.length);\n        if (token.raw.slice(-1) !== '_') { // Track prevChar before string of ____ started\n          prevChar = token.raw.slice(-1);\n        }\n        keepPrevChar = true;\n        const lastToken = tokens.at(-1);\n        if (lastToken?.type === 'text') {\n          lastToken.raw += token.raw;\n          lastToken.text += token.text;\n        } else {\n          tokens.push(token);\n        }\n        continue;\n      }\n\n      if (src) {\n        const errMsg = 'Infinite loop on byte: ' + src.charCodeAt(0);\n        if (this.options.silent) {\n          console.error(errMsg);\n          break;\n        } else {\n          throw new Error(errMsg);\n        }\n      }\n    }\n\n    return tokens;\n  }\n}\n", "import { _defaults } from './defaults.ts';\nimport {\n  cleanUrl,\n  escape,\n} from './helpers.ts';\nimport { other } from './rules.ts';\nimport type { MarkedOptions } from './MarkedOptions.ts';\nimport type { Tokens } from './Tokens.ts';\nimport type { _Parser } from './Parser.ts';\n\n/**\n * Renderer\n */\nexport class _Renderer<ParserOutput = string, RendererOutput = string> {\n  options: MarkedOptions<ParserOutput, RendererOutput>;\n  parser!: _Parser<ParserOutput, RendererOutput>; // set by the parser\n  constructor(options?: MarkedOptions<ParserOutput, RendererOutput>) {\n    this.options = options || _defaults;\n  }\n\n  space(token: Tokens.Space): RendererOutput {\n    return '' as RendererOutput;\n  }\n\n  code({ text, lang, escaped }: Tokens.Code): RendererOutput {\n    const langString = (lang || '').match(other.notSpaceStart)?.[0];\n\n    const code = text.replace(other.endingNewline, '') + '\\n';\n\n    if (!langString) {\n      return '<pre><code>'\n        + (escaped ? code : escape(code, true))\n        + '</code></pre>\\n' as RendererOutput;\n    }\n\n    return '<pre><code class=\"language-'\n      + escape(langString)\n      + '\">'\n      + (escaped ? code : escape(code, true))\n      + '</code></pre>\\n' as RendererOutput;\n  }\n\n  blockquote({ tokens }: Tokens.Blockquote): RendererOutput {\n    const body = this.parser.parse(tokens);\n    return `<blockquote>\\n${body}</blockquote>\\n` as RendererOutput;\n  }\n\n  html({ text }: Tokens.HTML | Tokens.Tag): RendererOutput {\n    return text as RendererOutput;\n  }\n\n  def(token: Tokens.Def): RendererOutput {\n    return '' as RendererOutput;\n  }\n\n  heading({ tokens, depth }: Tokens.Heading): RendererOutput {\n    return `<h${depth}>${this.parser.parseInline(tokens)}</h${depth}>\\n` as RendererOutput;\n  }\n\n  hr(token: Tokens.Hr): RendererOutput {\n    return '<hr>\\n' as RendererOutput;\n  }\n\n  list(token: Tokens.List): RendererOutput {\n    const ordered = token.ordered;\n    const start = token.start;\n\n    let body = '';\n    for (let j = 0; j < token.items.length; j++) {\n      const item = token.items[j];\n      body += this.listitem(item);\n    }\n\n    const type = ordered ? 'ol' : 'ul';\n    const startAttr = (ordered && start !== 1) ? (' start=\"' + start + '\"') : '';\n    return '<' + type + startAttr + '>\\n' + body + '</' + type + '>\\n' as RendererOutput;\n  }\n\n  listitem(item: Tokens.ListItem): RendererOutput {\n    return `<li>${this.parser.parse(item.tokens)}</li>\\n` as RendererOutput;\n  }\n\n  checkbox({ checked }: Tokens.Checkbox): RendererOutput {\n    return '<input '\n      + (checked ? 'checked=\"\" ' : '')\n      + 'disabled=\"\" type=\"checkbox\"> ' as RendererOutput;\n  }\n\n  paragraph({ tokens }: Tokens.Paragraph): RendererOutput {\n    return `<p>${this.parser.parseInline(tokens)}</p>\\n` as RendererOutput;\n  }\n\n  table(token: Tokens.Table): RendererOutput {\n    let header = '';\n\n    // header\n    let cell = '';\n    for (let j = 0; j < token.header.length; j++) {\n      cell += this.tablecell(token.header[j]);\n    }\n    header += this.tablerow({ text: cell as ParserOutput });\n\n    let body = '';\n    for (let j = 0; j < token.rows.length; j++) {\n      const row = token.rows[j];\n\n      cell = '';\n      for (let k = 0; k < row.length; k++) {\n        cell += this.tablecell(row[k]);\n      }\n\n      body += this.tablerow({ text: cell as ParserOutput });\n    }\n    if (body) body = `<tbody>${body}</tbody>`;\n\n    return '<table>\\n'\n      + '<thead>\\n'\n      + header\n      + '</thead>\\n'\n      + body\n      + '</table>\\n' as RendererOutput;\n  }\n\n  tablerow({ text }: Tokens.TableRow<ParserOutput>): RendererOutput {\n    return `<tr>\\n${text}</tr>\\n` as RendererOutput;\n  }\n\n  tablecell(token: Tokens.TableCell): RendererOutput {\n    const content = this.parser.parseInline(token.tokens);\n    const type = token.header ? 'th' : 'td';\n    const tag = token.align\n      ? `<${type} align=\"${token.align}\">`\n      : `<${type}>`;\n    return tag + content + `</${type}>\\n` as RendererOutput;\n  }\n\n  /**\n   * span level renderer\n   */\n  strong({ tokens }: Tokens.Strong): RendererOutput {\n    return `<strong>${this.parser.parseInline(tokens)}</strong>` as RendererOutput;\n  }\n\n  em({ tokens }: Tokens.Em): RendererOutput {\n    return `<em>${this.parser.parseInline(tokens)}</em>` as RendererOutput;\n  }\n\n  codespan({ text }: Tokens.Codespan): RendererOutput {\n    return `<code>${escape(text, true)}</code>` as RendererOutput;\n  }\n\n  br(token: Tokens.Br): RendererOutput {\n    return '<br>' as RendererOutput;\n  }\n\n  del({ tokens }: Tokens.Del): RendererOutput {\n    return `<del>${this.parser.parseInline(tokens)}</del>` as RendererOutput;\n  }\n\n  link({ href, title, tokens }: Tokens.Link): RendererOutput {\n    const text = this.parser.parseInline(tokens) as string;\n    const cleanHref = cleanUrl(href);\n    if (cleanHref === null) {\n      return text as RendererOutput;\n    }\n    href = cleanHref;\n    let out = '<a href=\"' + href + '\"';\n    if (title) {\n      out += ' title=\"' + (escape(title)) + '\"';\n    }\n    out += '>' + text + '</a>';\n    return out as RendererOutput;\n  }\n\n  image({ href, title, text, tokens }: Tokens.Image): RendererOutput {\n    if (tokens) {\n      text = this.parser.parseInline(tokens, this.parser.textRenderer) as string;\n    }\n    const cleanHref = cleanUrl(href);\n    if (cleanHref === null) {\n      return escape(text) as RendererOutput;\n    }\n    href = cleanHref;\n\n    let out = `<img src=\"${href}\" alt=\"${text}\"`;\n    if (title) {\n      out += ` title=\"${escape(title)}\"`;\n    }\n    out += '>';\n    return out as RendererOutput;\n  }\n\n  text(token: Tokens.Text | Tokens.Escape): RendererOutput {\n    return 'tokens' in token && token.tokens\n      ? this.parser.parseInline(token.tokens) as unknown as RendererOutput\n      : ('escaped' in token && token.escaped ? token.text as RendererOutput : escape(token.text) as RendererOutput);\n  }\n}\n", "import type { Tokens } from './Tokens.ts';\n\n/**\n * TextRenderer\n * returns only the textual part of the token\n */\nexport class _TextRenderer<RendererOutput = string> {\n  // no need for block level renderers\n  strong({ text }: Tokens.Strong): RendererOutput {\n    return text as RendererOutput;\n  }\n\n  em({ text }: Tokens.Em): RendererOutput {\n    return text as RendererOutput;\n  }\n\n  codespan({ text }: Tokens.Codespan): RendererOutput {\n    return text as RendererOutput;\n  }\n\n  del({ text }: Tokens.Del): RendererOutput {\n    return text as RendererOutput;\n  }\n\n  html({ text }: Tokens.HTML | Tokens.Tag): RendererOutput {\n    return text as RendererOutput;\n  }\n\n  text({ text }: Tokens.Text | Tokens.Escape | Tokens.Tag): RendererOutput {\n    return text as RendererOutput;\n  }\n\n  link({ text }: Tokens.Link): RendererOutput {\n    return '' + text as RendererOutput;\n  }\n\n  image({ text }: Tokens.Image): RendererOutput {\n    return '' + text as RendererOutput;\n  }\n\n  br(): RendererOutput {\n    return '' as RendererOutput;\n  }\n\n  checkbox({ raw }: Tokens.Checkbox): RendererOutput {\n    return raw as RendererOutput;\n  }\n}\n", "import { _Renderer } from './Renderer.ts';\nimport { _TextRenderer } from './TextRenderer.ts';\nimport { _defaults } from './defaults.ts';\nimport type { MarkedToken, Token, Tokens } from './Tokens.ts';\nimport type { MarkedOptions } from './MarkedOptions.ts';\n\n/**\n * Parsing & Compiling\n */\nexport class _Parser<ParserOutput = string, RendererOutput = string> {\n  options: MarkedOptions<ParserOutput, RendererOutput>;\n  renderer: _Renderer<ParserOutput, RendererOutput>;\n  textRenderer: _TextRenderer<RendererOutput>;\n  constructor(options?: MarkedOptions<ParserOutput, RendererOutput>) {\n    this.options = options || _defaults;\n    this.options.renderer = this.options.renderer || new _Renderer<ParserOutput, RendererOutput>();\n    this.renderer = this.options.renderer;\n    this.renderer.options = this.options;\n    this.renderer.parser = this;\n    this.textRenderer = new _TextRenderer<RendererOutput>();\n  }\n\n  /**\n   * Static Parse Method\n   */\n  static parse<ParserOutput = string, RendererOutput = string>(tokens: Token[], options?: MarkedOptions<ParserOutput, RendererOutput>) {\n    const parser = new _Parser<ParserOutput, RendererOutput>(options);\n    return parser.parse(tokens);\n  }\n\n  /**\n   * Static Parse Inline Method\n   */\n  static parseInline<ParserOutput = string, RendererOutput = string>(tokens: Token[], options?: MarkedOptions<ParserOutput, RendererOutput>) {\n    const parser = new _Parser<ParserOutput, RendererOutput>(options);\n    return parser.parseInline(tokens);\n  }\n\n  /**\n   * Parse Loop\n   */\n  parse(tokens: Token[]): ParserOutput {\n    let out = '';\n\n    for (let i = 0; i < tokens.length; i++) {\n      const anyToken = tokens[i];\n\n      // Run any renderer extensions\n      if (this.options.extensions?.renderers?.[anyToken.type]) {\n        const genericToken = anyToken as Tokens.Generic;\n        const ret = this.options.extensions.renderers[genericToken.type].call({ parser: this }, genericToken);\n        if (ret !== false || !['space', 'hr', 'heading', 'code', 'table', 'blockquote', 'list', 'html', 'def', 'paragraph', 'text'].includes(genericToken.type)) {\n          out += ret || '';\n          continue;\n        }\n      }\n\n      const token = anyToken as MarkedToken;\n\n      switch (token.type) {\n        case 'space': {\n          out += this.renderer.space(token);\n          break;\n        }\n        case 'hr': {\n          out += this.renderer.hr(token);\n          break;\n        }\n        case 'heading': {\n          out += this.renderer.heading(token);\n          break;\n        }\n        case 'code': {\n          out += this.renderer.code(token);\n          break;\n        }\n        case 'table': {\n          out += this.renderer.table(token);\n          break;\n        }\n        case 'blockquote': {\n          out += this.renderer.blockquote(token);\n          break;\n        }\n        case 'list': {\n          out += this.renderer.list(token);\n          break;\n        }\n        case 'checkbox': {\n          out += this.renderer.checkbox(token);\n          break;\n        }\n        case 'html': {\n          out += this.renderer.html(token);\n          break;\n        }\n        case 'def': {\n          out += this.renderer.def(token);\n          break;\n        }\n        case 'paragraph': {\n          out += this.renderer.paragraph(token);\n          break;\n        }\n        case 'text': {\n          out += this.renderer.text(token);\n          break;\n        }\n\n        default: {\n          const errMsg = 'Token with \"' + token.type + '\" type was not found.';\n          if (this.options.silent) {\n            console.error(errMsg);\n            return '' as ParserOutput;\n          } else {\n            throw new Error(errMsg);\n          }\n        }\n      }\n    }\n\n    return out as ParserOutput;\n  }\n\n  /**\n   * Parse Inline Tokens\n   */\n  parseInline(tokens: Token[], renderer: _Renderer<ParserOutput, RendererOutput> | _TextRenderer<RendererOutput> = this.renderer): ParserOutput {\n    let out = '';\n\n    for (let i = 0; i < tokens.length; i++) {\n      const anyToken = tokens[i];\n\n      // Run any renderer extensions\n      if (this.options.extensions?.renderers?.[anyToken.type]) {\n        const ret = this.options.extensions.renderers[anyToken.type].call({ parser: this }, anyToken);\n        if (ret !== false || !['escape', 'html', 'link', 'image', 'strong', 'em', 'codespan', 'br', 'del', 'text'].includes(anyToken.type)) {\n          out += ret || '';\n          continue;\n        }\n      }\n\n      const token = anyToken as MarkedToken;\n\n      switch (token.type) {\n        case 'escape': {\n          out += renderer.text(token);\n          break;\n        }\n        case 'html': {\n          out += renderer.html(token);\n          break;\n        }\n        case 'link': {\n          out += renderer.link(token);\n          break;\n        }\n        case 'image': {\n          out += renderer.image(token);\n          break;\n        }\n        case 'checkbox': {\n          out += renderer.checkbox(token);\n          break;\n        }\n        case 'strong': {\n          out += renderer.strong(token);\n          break;\n        }\n        case 'em': {\n          out += renderer.em(token);\n          break;\n        }\n        case 'codespan': {\n          out += renderer.codespan(token);\n          break;\n        }\n        case 'br': {\n          out += renderer.br(token);\n          break;\n        }\n        case 'del': {\n          out += renderer.del(token);\n          break;\n        }\n        case 'text': {\n          out += renderer.text(token);\n          break;\n        }\n        default: {\n          const errMsg = 'Token with \"' + token.type + '\" type was not found.';\n          if (this.options.silent) {\n            console.error(errMsg);\n            return '' as ParserOutput;\n          } else {\n            throw new Error(errMsg);\n          }\n        }\n      }\n    }\n    return out as ParserOutput;\n  }\n}\n", "import { _defaults } from './defaults.ts';\nimport { _Lexer } from './Lexer.ts';\nimport { _Parser } from './Parser.ts';\nimport type { MarkedOptions } from './MarkedOptions.ts';\nimport type { Token, TokensList } from './Tokens.ts';\n\nexport class _Hooks<ParserOutput = string, RendererOutput = string> {\n  options: MarkedOptions<ParserOutput, RendererOutput>;\n  block?: boolean;\n\n  constructor(options?: MarkedOptions<ParserOutput, RendererOutput>) {\n    this.options = options || _defaults;\n  }\n\n  static passThroughHooks = new Set([\n    'preprocess',\n    'postprocess',\n    'processAllTokens',\n    'emStrongMask',\n  ]);\n\n  static passThroughHooksRespectAsync = new Set([\n    'preprocess',\n    'postprocess',\n    'processAllTokens',\n  ]);\n\n  /**\n   * Process markdown before marked\n   */\n  preprocess(markdown: string) {\n    return markdown;\n  }\n\n  /**\n   * Process HTML after marked is finished\n   */\n  postprocess(html: ParserOutput) {\n    return html;\n  }\n\n  /**\n   * Process all tokens before walk tokens\n   */\n  processAllTokens(tokens: Token[] | TokensList) {\n    return tokens;\n  }\n\n  /**\n   * Mask contents that should not be interpreted as em/strong delimiters\n   */\n  emStrongMask(src: string) {\n    return src;\n  }\n\n  /**\n   * Provide function to tokenize markdown\n   */\n  provideLexer() {\n    return this.block ? _Lexer.lex : _Lexer.lexInline;\n  }\n\n  /**\n   * Provide function to parse tokens\n   */\n  provideParser() {\n    return this.block ? _Parser.parse<ParserOutput, RendererOutput> : _Parser.parseInline<ParserOutput, RendererOutput>;\n  }\n}\n", "import { _getDefaults } from './defaults.ts';\nimport { _Lexer } from './Lexer.ts';\nimport { _Parser } from './Parser.ts';\nimport { _Hooks } from './Hooks.ts';\nimport { _Renderer } from './Renderer.ts';\nimport { _Tokenizer } from './Tokenizer.ts';\nimport { _TextRenderer } from './TextRenderer.ts';\nimport { escape } from './helpers.ts';\nimport type { MarkedExtension, MarkedOptions } from './MarkedOptions.ts';\nimport type { Token, Tokens, TokensList } from './Tokens.ts';\n\nexport type MaybePromise = void | Promise<void>;\n\ntype UnknownFunction = (...args: unknown[]) => unknown;\ntype GenericRendererFunction = (...args: unknown[]) => string | false;\n\nexport class Marked<ParserOutput = string, RendererOutput = string> {\n  defaults = _getDefaults<ParserOutput, RendererOutput>();\n  options = this.setOptions;\n\n  parse = this.parseMarkdown(true);\n  parseInline = this.parseMarkdown(false);\n\n  Parser = _Parser<ParserOutput, RendererOutput>;\n  Renderer = _Renderer<ParserOutput, RendererOutput>;\n  TextRenderer = _TextRenderer<RendererOutput>;\n  Lexer = _Lexer;\n  Tokenizer = _Tokenizer<ParserOutput, RendererOutput>;\n  Hooks = _Hooks<ParserOutput, RendererOutput>;\n\n  constructor(...args: MarkedExtension<ParserOutput, RendererOutput>[]) {\n    this.use(...args);\n  }\n\n  /**\n   * Run callback for every token\n   */\n  walkTokens(tokens: Token[] | TokensList, callback: (token: Token) => MaybePromise | MaybePromise[]) {\n    let values: MaybePromise[] = [];\n    for (const token of tokens) {\n      values = values.concat(callback.call(this, token));\n      switch (token.type) {\n        case 'table': {\n          const tableToken = token as Tokens.Table;\n          for (const cell of tableToken.header) {\n            values = values.concat(this.walkTokens(cell.tokens, callback));\n          }\n          for (const row of tableToken.rows) {\n            for (const cell of row) {\n              values = values.concat(this.walkTokens(cell.tokens, callback));\n            }\n          }\n          break;\n        }\n        case 'list': {\n          const listToken = token as Tokens.List;\n          values = values.concat(this.walkTokens(listToken.items, callback));\n          break;\n        }\n        default: {\n          const genericToken = token as Tokens.Generic;\n          if (this.defaults.extensions?.childTokens?.[genericToken.type]) {\n            this.defaults.extensions.childTokens[genericToken.type].forEach((childTokens) => {\n              const tokens = genericToken[childTokens].flat(Infinity) as Token[] | TokensList;\n              values = values.concat(this.walkTokens(tokens, callback));\n            });\n          } else if (genericToken.tokens) {\n            values = values.concat(this.walkTokens(genericToken.tokens, callback));\n          }\n        }\n      }\n    }\n    return values;\n  }\n\n  use(...args: MarkedExtension<ParserOutput, RendererOutput>[]) {\n    const extensions: MarkedOptions<ParserOutput, RendererOutput>['extensions'] = this.defaults.extensions || { renderers: {}, childTokens: {} };\n\n    args.forEach((pack) => {\n      // copy options to new object\n      const opts = { ...pack } as MarkedOptions<ParserOutput, RendererOutput>;\n\n      // set async to true if it was set to true before\n      opts.async = this.defaults.async || opts.async || false;\n\n      // ==-- Parse \"addon\" extensions --== //\n      if (pack.extensions) {\n        pack.extensions.forEach((ext) => {\n          if (!ext.name) {\n            throw new Error('extension name required');\n          }\n          if ('renderer' in ext) { // Renderer extensions\n            const prevRenderer = extensions.renderers[ext.name];\n            if (prevRenderer) {\n              // Replace extension with func to run new extension but fall back if false\n              extensions.renderers[ext.name] = function(...args) {\n                let ret = ext.renderer.apply(this, args);\n                if (ret === false) {\n                  ret = prevRenderer.apply(this, args);\n                }\n                return ret;\n              };\n            } else {\n              extensions.renderers[ext.name] = ext.renderer;\n            }\n          }\n          if ('tokenizer' in ext) { // Tokenizer Extensions\n            if (!ext.level || (ext.level !== 'block' && ext.level !== 'inline')) {\n              throw new Error(\"extension level must be 'block' or 'inline'\");\n            }\n            const extLevel = extensions[ext.level];\n            if (extLevel) {\n              extLevel.unshift(ext.tokenizer);\n            } else {\n              extensions[ext.level] = [ext.tokenizer];\n            }\n            if (ext.start) { // Function to check for start of token\n              if (ext.level === 'block') {\n                if (extensions.startBlock) {\n                  extensions.startBlock.push(ext.start);\n                } else {\n                  extensions.startBlock = [ext.start];\n                }\n              } else if (ext.level === 'inline') {\n                if (extensions.startInline) {\n                  extensions.startInline.push(ext.start);\n                } else {\n                  extensions.startInline = [ext.start];\n                }\n              }\n            }\n          }\n          if ('childTokens' in ext && ext.childTokens) { // Child tokens to be visited by walkTokens\n            extensions.childTokens[ext.name] = ext.childTokens;\n          }\n        });\n        opts.extensions = extensions;\n      }\n\n      // ==-- Parse \"overwrite\" extensions --== //\n      if (pack.renderer) {\n        const renderer = this.defaults.renderer || new _Renderer<ParserOutput, RendererOutput>(this.defaults);\n        for (const prop in pack.renderer) {\n          if (!(prop in renderer)) {\n            throw new Error(`renderer '${prop}' does not exist`);\n          }\n          if (['options', 'parser'].includes(prop)) {\n            // ignore options property\n            continue;\n          }\n          const rendererProp = prop as Exclude<keyof _Renderer<ParserOutput, RendererOutput>, 'options' | 'parser'>;\n          const rendererFunc = pack.renderer[rendererProp] as GenericRendererFunction;\n          const prevRenderer = renderer[rendererProp] as GenericRendererFunction;\n          // Replace renderer with func to run extension, but fall back if false\n          renderer[rendererProp] = (...args: unknown[]) => {\n            let ret = rendererFunc.apply(renderer, args);\n            if (ret === false) {\n              ret = prevRenderer.apply(renderer, args);\n            }\n            return (ret || '') as RendererOutput;\n          };\n        }\n        opts.renderer = renderer;\n      }\n      if (pack.tokenizer) {\n        const tokenizer = this.defaults.tokenizer || new _Tokenizer<ParserOutput, RendererOutput>(this.defaults);\n        for (const prop in pack.tokenizer) {\n          if (!(prop in tokenizer)) {\n            throw new Error(`tokenizer '${prop}' does not exist`);\n          }\n          if (['options', 'rules', 'lexer'].includes(prop)) {\n            // ignore options, rules, and lexer properties\n            continue;\n          }\n          const tokenizerProp = prop as Exclude<keyof _Tokenizer<ParserOutput, RendererOutput>, 'options' | 'rules' | 'lexer'>;\n          const tokenizerFunc = pack.tokenizer[tokenizerProp] as UnknownFunction;\n          const prevTokenizer = tokenizer[tokenizerProp] as UnknownFunction;\n          // Replace tokenizer with func to run extension, but fall back if false\n          // @ts-expect-error cannot type tokenizer function dynamically\n          tokenizer[tokenizerProp] = (...args: unknown[]) => {\n            let ret = tokenizerFunc.apply(tokenizer, args);\n            if (ret === false) {\n              ret = prevTokenizer.apply(tokenizer, args);\n            }\n            return ret;\n          };\n        }\n        opts.tokenizer = tokenizer;\n      }\n\n      // ==-- Parse Hooks extensions --== //\n      if (pack.hooks) {\n        const hooks = this.defaults.hooks || new _Hooks<ParserOutput, RendererOutput>();\n        for (const prop in pack.hooks) {\n          if (!(prop in hooks)) {\n            throw new Error(`hook '${prop}' does not exist`);\n          }\n          if (['options', 'block'].includes(prop)) {\n            // ignore options and block properties\n            continue;\n          }\n          const hooksProp = prop as Exclude<keyof _Hooks<ParserOutput, RendererOutput>, 'options' | 'block'>;\n          const hooksFunc = pack.hooks[hooksProp] as UnknownFunction;\n          const prevHook = hooks[hooksProp] as UnknownFunction;\n          if (_Hooks.passThroughHooks.has(prop)) {\n            // @ts-expect-error cannot type hook function dynamically\n            hooks[hooksProp] = (arg: unknown) => {\n              if (this.defaults.async && _Hooks.passThroughHooksRespectAsync.has(prop)) {\n                return (async() => {\n                  const ret = await hooksFunc.call(hooks, arg);\n                  return prevHook.call(hooks, ret);\n                })();\n              }\n\n              const ret = hooksFunc.call(hooks, arg);\n              return prevHook.call(hooks, ret);\n            };\n          } else {\n            // @ts-expect-error cannot type hook function dynamically\n            hooks[hooksProp] = (...args: unknown[]) => {\n              if (this.defaults.async) {\n                return (async() => {\n                  let ret = await hooksFunc.apply(hooks, args);\n                  if (ret === false) {\n                    ret = await prevHook.apply(hooks, args);\n                  }\n                  return ret;\n                })();\n              }\n\n              let ret = hooksFunc.apply(hooks, args);\n              if (ret === false) {\n                ret = prevHook.apply(hooks, args);\n              }\n              return ret;\n            };\n          }\n        }\n        opts.hooks = hooks;\n      }\n\n      // ==-- Parse WalkTokens extensions --== //\n      if (pack.walkTokens) {\n        const walkTokens = this.defaults.walkTokens;\n        const packWalktokens = pack.walkTokens;\n        opts.walkTokens = function(token) {\n          let values: MaybePromise[] = [];\n          values.push(packWalktokens.call(this, token));\n          if (walkTokens) {\n            values = values.concat(walkTokens.call(this, token));\n          }\n          return values;\n        };\n      }\n\n      this.defaults = { ...this.defaults, ...opts };\n    });\n\n    return this;\n  }\n\n  setOptions(opt: MarkedOptions<ParserOutput, RendererOutput>) {\n    this.defaults = { ...this.defaults, ...opt };\n    return this;\n  }\n\n  lexer(src: string, options?: MarkedOptions<ParserOutput, RendererOutput>) {\n    return _Lexer.lex(src, options ?? this.defaults);\n  }\n\n  parser(tokens: Token[], options?: MarkedOptions<ParserOutput, RendererOutput>) {\n    return _Parser.parse<ParserOutput, RendererOutput>(tokens, options ?? this.defaults);\n  }\n\n  private parseMarkdown(blockType: boolean) {\n    type overloadedParse = {\n      (src: string, options: MarkedOptions<ParserOutput, RendererOutput> & { async: true }): Promise<ParserOutput>;\n      (src: string, options: MarkedOptions<ParserOutput, RendererOutput> & { async: false }): ParserOutput;\n      (src: string, options?: MarkedOptions<ParserOutput, RendererOutput> | null): ParserOutput | Promise<ParserOutput>;\n    };\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const parse: overloadedParse = (src: string, options?: MarkedOptions<ParserOutput, RendererOutput> | null): any => {\n      const origOpt = { ...options };\n      const opt = { ...this.defaults, ...origOpt };\n\n      const throwError = this.onError(!!opt.silent, !!opt.async);\n\n      // throw error if an extension set async to true but parse was called with async: false\n      if (this.defaults.async === true && origOpt.async === false) {\n        return throwError(new Error('marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise.'));\n      }\n\n      // throw error in case of non string input\n      if (typeof src === 'undefined' || src === null) {\n        return throwError(new Error('marked(): input parameter is undefined or null'));\n      }\n      if (typeof src !== 'string') {\n        return throwError(new Error('marked(): input parameter is of type '\n          + Object.prototype.toString.call(src) + ', string expected'));\n      }\n\n      if (opt.hooks) {\n        opt.hooks.options = opt;\n        opt.hooks.block = blockType;\n      }\n\n      if (opt.async) {\n        return (async() => {\n          const processedSrc = opt.hooks ? await opt.hooks.preprocess(src) : src;\n          const lexer = opt.hooks ? await opt.hooks.provideLexer() : (blockType ? _Lexer.lex : _Lexer.lexInline);\n          const tokens = await lexer(processedSrc, opt);\n          const processedTokens = opt.hooks ? await opt.hooks.processAllTokens(tokens) : tokens;\n          if (opt.walkTokens) {\n            await Promise.all(this.walkTokens(processedTokens, opt.walkTokens));\n          }\n          const parser = opt.hooks ? await opt.hooks.provideParser() : (blockType ? _Parser.parse : _Parser.parseInline);\n          const html = await parser(processedTokens, opt);\n          return opt.hooks ? await opt.hooks.postprocess(html) : html;\n        })().catch(throwError);\n      }\n\n      try {\n        if (opt.hooks) {\n          src = opt.hooks.preprocess(src) as string;\n        }\n        const lexer = opt.hooks ? opt.hooks.provideLexer() : (blockType ? _Lexer.lex : _Lexer.lexInline);\n        let tokens = lexer(src, opt);\n        if (opt.hooks) {\n          tokens = opt.hooks.processAllTokens(tokens);\n        }\n        if (opt.walkTokens) {\n          this.walkTokens(tokens, opt.walkTokens);\n        }\n        const parser = opt.hooks ? opt.hooks.provideParser() : (blockType ? _Parser.parse : _Parser.parseInline);\n        let html = parser(tokens, opt);\n        if (opt.hooks) {\n          html = opt.hooks.postprocess(html);\n        }\n        return html;\n      } catch(e) {\n        return throwError(e as Error);\n      }\n    };\n\n    return parse;\n  }\n\n  private onError(silent: boolean, async: boolean) {\n    return (e: Error): string | Promise<string> => {\n      e.message += '\\nPlease report this to https://github.com/markedjs/marked.';\n\n      if (silent) {\n        const msg = '<p>An error occurred:</p><pre>'\n          + escape(e.message + '', true)\n          + '</pre>';\n        if (async) {\n          return Promise.resolve(msg);\n        }\n        return msg;\n      }\n\n      if (async) {\n        return Promise.reject(e);\n      }\n      throw e;\n    };\n  }\n}\n", "import { _Lexer } from './Lexer.ts';\nimport { _Parser } from './Parser.ts';\nimport { _Tokenizer } from './Tokenizer.ts';\nimport { _Renderer } from './Renderer.ts';\nimport { _TextRenderer } from './TextRenderer.ts';\nimport { _Hooks } from './Hooks.ts';\nimport { Marked } from './Instance.ts';\nimport {\n  _getDefaults,\n  changeDefaults,\n  _defaults,\n} from './defaults.ts';\nimport type { MarkedExtension, MarkedOptions } from './MarkedOptions.ts';\nimport type { Token, TokensList } from './Tokens.ts';\nimport type { MaybePromise } from './Instance.ts';\n\nconst markedInstance = new Marked();\n\n/**\n * Compiles markdown to HTML asynchronously.\n *\n * @param src String of markdown source to be compiled\n * @param options Hash of options, having async: true\n * @return Promise of string of compiled HTML\n */\nexport function marked(src: string, options: MarkedOptions & { async: true }): Promise<string>;\n\n/**\n * Compiles markdown to HTML.\n *\n * @param src String of markdown source to be compiled\n * @param options Optional hash of options\n * @return String of compiled HTML. Will be a Promise of string if async is set to true by any extensions.\n */\nexport function marked(src: string, options: MarkedOptions & { async: false }): string;\nexport function marked(src: string, options: MarkedOptions & { async: true }): Promise<string>;\nexport function marked(src: string, options?: MarkedOptions | null): string | Promise<string>;\nexport function marked(src: string, opt?: MarkedOptions | null): string | Promise<string> {\n  return markedInstance.parse(src, opt);\n}\n\n/**\n * Sets the default options.\n *\n * @param options Hash of options\n */\nmarked.options =\n  marked.setOptions = function(options: MarkedOptions) {\n    markedInstance.setOptions(options);\n    marked.defaults = markedInstance.defaults;\n    changeDefaults(marked.defaults);\n    return marked;\n  };\n\n/**\n * Gets the original marked default options.\n */\nmarked.getDefaults = _getDefaults;\n\nmarked.defaults = _defaults;\n\n/**\n * Use Extension\n */\n\nmarked.use = function(...args: MarkedExtension[]) {\n  markedInstance.use(...args);\n  marked.defaults = markedInstance.defaults;\n  changeDefaults(marked.defaults);\n  return marked;\n};\n\n/**\n * Run callback for every token\n */\n\nmarked.walkTokens = function(tokens: Token[] | TokensList, callback: (token: Token) => MaybePromise | MaybePromise[]) {\n  return markedInstance.walkTokens(tokens, callback);\n};\n\n/**\n * Compiles markdown to HTML without enclosing `p` tag.\n *\n * @param src String of markdown source to be compiled\n * @param options Hash of options\n * @return String of compiled HTML\n */\nmarked.parseInline = markedInstance.parseInline;\n\n/**\n * Expose\n */\nmarked.Parser = _Parser;\nmarked.parser = _Parser.parse;\nmarked.Renderer = _Renderer;\nmarked.TextRenderer = _TextRenderer;\nmarked.Lexer = _Lexer;\nmarked.lexer = _Lexer.lex;\nmarked.Tokenizer = _Tokenizer;\nmarked.Hooks = _Hooks;\nmarked.parse = marked;\n\nexport const options = marked.options;\nexport const setOptions = marked.setOptions;\nexport const use = marked.use;\nexport const walkTokens = marked.walkTokens;\nexport const parseInline = marked.parseInline;\nexport const parse = marked;\nexport const parser = _Parser.parse;\nexport const lexer = _Lexer.lex;\nexport { _defaults as defaults, _getDefaults as getDefaults } from './defaults.ts';\nexport { _Lexer as Lexer } from './Lexer.ts';\nexport { _Parser as Parser } from './Parser.ts';\nexport { _Tokenizer as Tokenizer } from './Tokenizer.ts';\nexport { _Renderer as Renderer } from './Renderer.ts';\nexport { _TextRenderer as TextRenderer } from './TextRenderer.ts';\nexport { _Hooks as Hooks } from './Hooks.ts';\nexport { Marked } from './Instance.ts';\nexport type * from './MarkedOptions.ts';\nexport type * from './Tokens.ts';\n", "const {\n  entries,\n  setPrototypeOf,\n  isFrozen,\n  getPrototypeOf,\n  getOwnPropertyDescriptor,\n} = Object;\n\nlet { freeze, seal, create } = Object; // eslint-disable-line import/no-mutable-exports\nlet { apply, construct } = typeof Reflect !== 'undefined' && Reflect;\n\nif (!freeze) {\n  freeze = function <T>(x: T): T {\n    return x;\n  };\n}\n\nif (!seal) {\n  seal = function <T>(x: T): T {\n    return x;\n  };\n}\n\nif (!apply) {\n  apply = function <T>(\n    func: (thisArg: any, ...args: any[]) => T,\n    thisArg: any,\n    ...args: any[]\n  ): T {\n    return func.apply(thisArg, args);\n  };\n}\n\nif (!construct) {\n  construct = function <T>(Func: new (...args: any[]) => T, ...args: any[]): T {\n    return new Func(...args);\n  };\n}\n\nconst arrayForEach = unapply(Array.prototype.forEach);\nconst arrayIndexOf = unapply(Array.prototype.indexOf);\nconst arrayLastIndexOf = unapply(Array.prototype.lastIndexOf);\nconst arrayPop = unapply(Array.prototype.pop);\nconst arrayPush = unapply(Array.prototype.push);\nconst arraySlice = unapply(Array.prototype.slice);\nconst arraySplice = unapply(Array.prototype.splice);\n\nconst stringToLowerCase = unapply(String.prototype.toLowerCase);\nconst stringToString = unapply(String.prototype.toString);\nconst stringMatch = unapply(String.prototype.match);\nconst stringReplace = unapply(String.prototype.replace);\nconst stringIndexOf = unapply(String.prototype.indexOf);\nconst stringTrim = unapply(String.prototype.trim);\n\nconst objectHasOwnProperty = unapply(Object.prototype.hasOwnProperty);\n\nconst regExpTest = unapply(RegExp.prototype.test);\n\nconst typeErrorCreate = unconstruct(TypeError);\n\n/**\n * Creates a new function that calls the given function with a specified thisArg and arguments.\n *\n * @param func - The function to be wrapped and called.\n * @returns A new function that calls the given function with a specified thisArg and arguments.\n */\nfunction unapply<T>(\n  func: (thisArg: any, ...args: any[]) => T\n): (thisArg: any, ...args: any[]) => T {\n  return (thisArg: any, ...args: any[]): T => {\n    if (thisArg instanceof RegExp) {\n      thisArg.lastIndex = 0;\n    }\n\n    return apply(func, thisArg, args);\n  };\n}\n\n/**\n * Creates a new function that constructs an instance of the given constructor function with the provided arguments.\n *\n * @param func - The constructor function to be wrapped and called.\n * @returns A new function that constructs an instance of the given constructor function with the provided arguments.\n */\nfunction unconstruct<T>(\n  Func: new (...args: any[]) => T\n): (...args: any[]) => T {\n  return (...args: any[]): T => construct(Func, args);\n}\n\n/**\n * Add properties to a lookup table\n *\n * @param set - The set to which elements will be added.\n * @param array - The array containing elements to be added to the set.\n * @param transformCaseFunc - An optional function to transform the case of each element before adding to the set.\n * @returns The modified set with added elements.\n */\nfunction addToSet(\n  set: Record<string, any>,\n  array: readonly any[],\n  transformCaseFunc: ReturnType<typeof unapply<string>> = stringToLowerCase\n): Record<string, any> {\n  if (setPrototypeOf) {\n    // Make 'in' and truthy checks like Boolean(set.constructor)\n    // independent of any properties defined on Object.prototype.\n    // Prevent prototype setters from intercepting set as a this value.\n    setPrototypeOf(set, null);\n  }\n\n  let l = array.length;\n  while (l--) {\n    let element = array[l];\n    if (typeof element === 'string') {\n      const lcElement = transformCaseFunc(element);\n      if (lcElement !== element) {\n        // Config presets (e.g. tags.js, attrs.js) are immutable.\n        if (!isFrozen(array)) {\n          (array as any[])[l] = lcElement;\n        }\n\n        element = lcElement;\n      }\n    }\n\n    set[element] = true;\n  }\n\n  return set;\n}\n\n/**\n * Clean up an array to harden against CSPP\n *\n * @param array - The array to be cleaned.\n * @returns The cleaned version of the array\n */\nfunction cleanArray<T>(array: T[]): Array<T | null> {\n  for (let index = 0; index < array.length; index++) {\n    const isPropertyExist = objectHasOwnProperty(array, index);\n\n    if (!isPropertyExist) {\n      array[index] = null;\n    }\n  }\n\n  return array;\n}\n\n/**\n * Shallow clone an object\n *\n * @param object - The object to be cloned.\n * @returns A new object that copies the original.\n */\nfunction clone<T extends Record<string, any>>(object: T): T {\n  const newObject = create(null);\n\n  for (const [property, value] of entries(object)) {\n    const isPropertyExist = objectHasOwnProperty(object, property);\n\n    if (isPropertyExist) {\n      if (Array.isArray(value)) {\n        newObject[property] = cleanArray(value);\n      } else if (\n        value &&\n        typeof value === 'object' &&\n        value.constructor === Object\n      ) {\n        newObject[property] = clone(value);\n      } else {\n        newObject[property] = value;\n      }\n    }\n  }\n\n  return newObject;\n}\n\n/**\n * This method automatically checks if the prop is function or getter and behaves accordingly.\n *\n * @param object - The object to look up the getter function in its prototype chain.\n * @param prop - The property name for which to find the getter function.\n * @returns The getter function found in the prototype chain or a fallback function.\n */\nfunction lookupGetter<T extends Record<string, any>>(\n  object: T,\n  prop: string\n): ReturnType<typeof unapply<any>> | (() => null) {\n  while (object !== null) {\n    const desc = getOwnPropertyDescriptor(object, prop);\n\n    if (desc) {\n      if (desc.get) {\n        return unapply(desc.get);\n      }\n\n      if (typeof desc.value === 'function') {\n        return unapply(desc.value);\n      }\n    }\n\n    object = getPrototypeOf(object);\n  }\n\n  function fallbackValue(): null {\n    return null;\n  }\n\n  return fallbackValue;\n}\n\nexport {\n  // Array\n  arrayForEach,\n  arrayIndexOf,\n  arrayLastIndexOf,\n  arrayPop,\n  arrayPush,\n  arraySlice,\n  arraySplice,\n  // Object\n  entries,\n  freeze,\n  getPrototypeOf,\n  getOwnPropertyDescriptor,\n  isFrozen,\n  setPrototypeOf,\n  seal,\n  clone,\n  create,\n  objectHasOwnProperty,\n  // RegExp\n  regExpTest,\n  // String\n  stringIndexOf,\n  stringMatch,\n  stringReplace,\n  stringToLowerCase,\n  stringToString,\n  stringTrim,\n  // Errors\n  typeErrorCreate,\n  // Other\n  lookupGetter,\n  addToSet,\n  // Reflect\n  unapply,\n  unconstruct,\n};\n", "import { freeze } from './utils.js';\n\nexport const html = freeze([\n  'a',\n  'abbr',\n  'acronym',\n  'address',\n  'area',\n  'article',\n  'aside',\n  'audio',\n  'b',\n  'bdi',\n  'bdo',\n  'big',\n  'blink',\n  'blockquote',\n  'body',\n  'br',\n  'button',\n  'canvas',\n  'caption',\n  'center',\n  'cite',\n  'code',\n  'col',\n  'colgroup',\n  'content',\n  'data',\n  'datalist',\n  'dd',\n  'decorator',\n  'del',\n  'details',\n  'dfn',\n  'dialog',\n  'dir',\n  'div',\n  'dl',\n  'dt',\n  'element',\n  'em',\n  'fieldset',\n  'figcaption',\n  'figure',\n  'font',\n  'footer',\n  'form',\n  'h1',\n  'h2',\n  'h3',\n  'h4',\n  'h5',\n  'h6',\n  'head',\n  'header',\n  'hgroup',\n  'hr',\n  'html',\n  'i',\n  'img',\n  'input',\n  'ins',\n  'kbd',\n  'label',\n  'legend',\n  'li',\n  'main',\n  'map',\n  'mark',\n  'marquee',\n  'menu',\n  'menuitem',\n  'meter',\n  'nav',\n  'nobr',\n  'ol',\n  'optgroup',\n  'option',\n  'output',\n  'p',\n  'picture',\n  'pre',\n  'progress',\n  'q',\n  'rp',\n  'rt',\n  'ruby',\n  's',\n  'samp',\n  'search',\n  'section',\n  'select',\n  'shadow',\n  'slot',\n  'small',\n  'source',\n  'spacer',\n  'span',\n  'strike',\n  'strong',\n  'style',\n  'sub',\n  'summary',\n  'sup',\n  'table',\n  'tbody',\n  'td',\n  'template',\n  'textarea',\n  'tfoot',\n  'th',\n  'thead',\n  'time',\n  'tr',\n  'track',\n  'tt',\n  'u',\n  'ul',\n  'var',\n  'video',\n  'wbr',\n] as const);\n\nexport const svg = freeze([\n  'svg',\n  'a',\n  'altglyph',\n  'altglyphdef',\n  'altglyphitem',\n  'animatecolor',\n  'animatemotion',\n  'animatetransform',\n  'circle',\n  'clippath',\n  'defs',\n  'desc',\n  'ellipse',\n  'enterkeyhint',\n  'exportparts',\n  'filter',\n  'font',\n  'g',\n  'glyph',\n  'glyphref',\n  'hkern',\n  'image',\n  'inputmode',\n  'line',\n  'lineargradient',\n  'marker',\n  'mask',\n  'metadata',\n  'mpath',\n  'part',\n  'path',\n  'pattern',\n  'polygon',\n  'polyline',\n  'radialgradient',\n  'rect',\n  'stop',\n  'style',\n  'switch',\n  'symbol',\n  'text',\n  'textpath',\n  'title',\n  'tref',\n  'tspan',\n  'view',\n  'vkern',\n] as const);\n\nexport const svgFilters = freeze([\n  'feBlend',\n  'feColorMatrix',\n  'feComponentTransfer',\n  'feComposite',\n  'feConvolveMatrix',\n  'feDiffuseLighting',\n  'feDisplacementMap',\n  'feDistantLight',\n  'feDropShadow',\n  'feFlood',\n  'feFuncA',\n  'feFuncB',\n  'feFuncG',\n  'feFuncR',\n  'feGaussianBlur',\n  'feImage',\n  'feMerge',\n  'feMergeNode',\n  'feMorphology',\n  'feOffset',\n  'fePointLight',\n  'feSpecularLighting',\n  'feSpotLight',\n  'feTile',\n  'feTurbulence',\n] as const);\n\n// List of SVG elements that are disallowed by default.\n// We still need to know them so that we can do namespace\n// checks properly in case one wants to add them to\n// allow-list.\nexport const svgDisallowed = freeze([\n  'animate',\n  'color-profile',\n  'cursor',\n  'discard',\n  'font-face',\n  'font-face-format',\n  'font-face-name',\n  'font-face-src',\n  'font-face-uri',\n  'foreignobject',\n  'hatch',\n  'hatchpath',\n  'mesh',\n  'meshgradient',\n  'meshpatch',\n  'meshrow',\n  'missing-glyph',\n  'script',\n  'set',\n  'solidcolor',\n  'unknown',\n  'use',\n] as const);\n\nexport const mathMl = freeze([\n  'math',\n  'menclose',\n  'merror',\n  'mfenced',\n  'mfrac',\n  'mglyph',\n  'mi',\n  'mlabeledtr',\n  'mmultiscripts',\n  'mn',\n  'mo',\n  'mover',\n  'mpadded',\n  'mphantom',\n  'mroot',\n  'mrow',\n  'ms',\n  'mspace',\n  'msqrt',\n  'mstyle',\n  'msub',\n  'msup',\n  'msubsup',\n  'mtable',\n  'mtd',\n  'mtext',\n  'mtr',\n  'munder',\n  'munderover',\n  'mprescripts',\n] as const);\n\n// Similarly to SVG, we want to know all MathML elements,\n// even those that we disallow by default.\nexport const mathMlDisallowed = freeze([\n  'maction',\n  'maligngroup',\n  'malignmark',\n  'mlongdiv',\n  'mscarries',\n  'mscarry',\n  'msgroup',\n  'mstack',\n  'msline',\n  'msrow',\n  'semantics',\n  'annotation',\n  'annotation-xml',\n  'mprescripts',\n  'none',\n] as const);\n\nexport const text = freeze(['#text'] as const);\n", "import { freeze } from './utils.js';\n\nexport const html = freeze([\n  'accept',\n  'action',\n  'align',\n  'alt',\n  'autocapitalize',\n  'autocomplete',\n  'autopictureinpicture',\n  'autoplay',\n  'background',\n  'bgcolor',\n  'border',\n  'capture',\n  'cellpadding',\n  'cellspacing',\n  'checked',\n  'cite',\n  'class',\n  'clear',\n  'color',\n  'cols',\n  'colspan',\n  'controls',\n  'controlslist',\n  'coords',\n  'crossorigin',\n  'datetime',\n  'decoding',\n  'default',\n  'dir',\n  'disabled',\n  'disablepictureinpicture',\n  'disableremoteplayback',\n  'download',\n  'draggable',\n  'enctype',\n  'enterkeyhint',\n  'exportparts',\n  'face',\n  'for',\n  'headers',\n  'height',\n  'hidden',\n  'high',\n  'href',\n  'hreflang',\n  'id',\n  'inert',\n  'inputmode',\n  'integrity',\n  'ismap',\n  'kind',\n  'label',\n  'lang',\n  'list',\n  'loading',\n  'loop',\n  'low',\n  'max',\n  'maxlength',\n  'media',\n  'method',\n  'min',\n  'minlength',\n  'multiple',\n  'muted',\n  'name',\n  'nonce',\n  'noshade',\n  'novalidate',\n  'nowrap',\n  'open',\n  'optimum',\n  'part',\n  'pattern',\n  'placeholder',\n  'playsinline',\n  'popover',\n  'popovertarget',\n  'popovertargetaction',\n  'poster',\n  'preload',\n  'pubdate',\n  'radiogroup',\n  'readonly',\n  'rel',\n  'required',\n  'rev',\n  'reversed',\n  'role',\n  'rows',\n  'rowspan',\n  'spellcheck',\n  'scope',\n  'selected',\n  'shape',\n  'size',\n  'sizes',\n  'slot',\n  'span',\n  'srclang',\n  'start',\n  'src',\n  'srcset',\n  'step',\n  'style',\n  'summary',\n  'tabindex',\n  'title',\n  'translate',\n  'type',\n  'usemap',\n  'valign',\n  'value',\n  'width',\n  'wrap',\n  'xmlns',\n  'slot',\n] as const);\n\nexport const svg = freeze([\n  'accent-height',\n  'accumulate',\n  'additive',\n  'alignment-baseline',\n  'amplitude',\n  'ascent',\n  'attributename',\n  'attributetype',\n  'azimuth',\n  'basefrequency',\n  'baseline-shift',\n  'begin',\n  'bias',\n  'by',\n  'class',\n  'clip',\n  'clippathunits',\n  'clip-path',\n  'clip-rule',\n  'color',\n  'color-interpolation',\n  'color-interpolation-filters',\n  'color-profile',\n  'color-rendering',\n  'cx',\n  'cy',\n  'd',\n  'dx',\n  'dy',\n  'diffuseconstant',\n  'direction',\n  'display',\n  'divisor',\n  'dur',\n  'edgemode',\n  'elevation',\n  'end',\n  'exponent',\n  'fill',\n  'fill-opacity',\n  'fill-rule',\n  'filter',\n  'filterunits',\n  'flood-color',\n  'flood-opacity',\n  'font-family',\n  'font-size',\n  'font-size-adjust',\n  'font-stretch',\n  'font-style',\n  'font-variant',\n  'font-weight',\n  'fx',\n  'fy',\n  'g1',\n  'g2',\n  'glyph-name',\n  'glyphref',\n  'gradientunits',\n  'gradienttransform',\n  'height',\n  'href',\n  'id',\n  'image-rendering',\n  'in',\n  'in2',\n  'intercept',\n  'k',\n  'k1',\n  'k2',\n  'k3',\n  'k4',\n  'kerning',\n  'keypoints',\n  'keysplines',\n  'keytimes',\n  'lang',\n  'lengthadjust',\n  'letter-spacing',\n  'kernelmatrix',\n  'kernelunitlength',\n  'lighting-color',\n  'local',\n  'marker-end',\n  'marker-mid',\n  'marker-start',\n  'markerheight',\n  'markerunits',\n  'markerwidth',\n  'maskcontentunits',\n  'maskunits',\n  'max',\n  'mask',\n  'mask-type',\n  'media',\n  'method',\n  'mode',\n  'min',\n  'name',\n  'numoctaves',\n  'offset',\n  'operator',\n  'opacity',\n  'order',\n  'orient',\n  'orientation',\n  'origin',\n  'overflow',\n  'paint-order',\n  'path',\n  'pathlength',\n  'patterncontentunits',\n  'patterntransform',\n  'patternunits',\n  'points',\n  'preservealpha',\n  'preserveaspectratio',\n  'primitiveunits',\n  'r',\n  'rx',\n  'ry',\n  'radius',\n  'refx',\n  'refy',\n  'repeatcount',\n  'repeatdur',\n  'restart',\n  'result',\n  'rotate',\n  'scale',\n  'seed',\n  'shape-rendering',\n  'slope',\n  'specularconstant',\n  'specularexponent',\n  'spreadmethod',\n  'startoffset',\n  'stddeviation',\n  'stitchtiles',\n  'stop-color',\n  'stop-opacity',\n  'stroke-dasharray',\n  'stroke-dashoffset',\n  'stroke-linecap',\n  'stroke-linejoin',\n  'stroke-miterlimit',\n  'stroke-opacity',\n  'stroke',\n  'stroke-width',\n  'style',\n  'surfacescale',\n  'systemlanguage',\n  'tabindex',\n  'tablevalues',\n  'targetx',\n  'targety',\n  'transform',\n  'transform-origin',\n  'text-anchor',\n  'text-decoration',\n  'text-rendering',\n  'textlength',\n  'type',\n  'u1',\n  'u2',\n  'unicode',\n  'values',\n  'viewbox',\n  'visibility',\n  'version',\n  'vert-adv-y',\n  'vert-origin-x',\n  'vert-origin-y',\n  'width',\n  'word-spacing',\n  'wrap',\n  'writing-mode',\n  'xchannelselector',\n  'ychannelselector',\n  'x',\n  'x1',\n  'x2',\n  'xmlns',\n  'y',\n  'y1',\n  'y2',\n  'z',\n  'zoomandpan',\n] as const);\n\nexport const mathMl = freeze([\n  'accent',\n  'accentunder',\n  'align',\n  'bevelled',\n  'close',\n  'columnsalign',\n  'columnlines',\n  'columnspan',\n  'denomalign',\n  'depth',\n  'dir',\n  'display',\n  'displaystyle',\n  'encoding',\n  'fence',\n  'frame',\n  'height',\n  'href',\n  'id',\n  'largeop',\n  'length',\n  'linethickness',\n  'lspace',\n  'lquote',\n  'mathbackground',\n  'mathcolor',\n  'mathsize',\n  'mathvariant',\n  'maxsize',\n  'minsize',\n  'movablelimits',\n  'notation',\n  'numalign',\n  'open',\n  'rowalign',\n  'rowlines',\n  'rowspacing',\n  'rowspan',\n  'rspace',\n  'rquote',\n  'scriptlevel',\n  'scriptminsize',\n  'scriptsizemultiplier',\n  'selection',\n  'separator',\n  'separators',\n  'stretchy',\n  'subscriptshift',\n  'supscriptshift',\n  'symmetric',\n  'voffset',\n  'width',\n  'xmlns',\n]);\n\nexport const xml = freeze([\n  'xlink:href',\n  'xml:id',\n  'xlink:title',\n  'xml:space',\n  'xmlns:xlink',\n] as const);\n", "import { seal } from './utils.js';\n\n// eslint-disable-next-line unicorn/better-regex\nexport const MUSTACHE_EXPR = seal(/\\{\\{[\\w\\W]*|[\\w\\W]*\\}\\}/gm); // Specify template detection regex for SAFE_FOR_TEMPLATES mode\nexport const ERB_EXPR = seal(/<%[\\w\\W]*|[\\w\\W]*%>/gm);\nexport const TMPLIT_EXPR = seal(/\\$\\{[\\w\\W]*/gm); // eslint-disable-line unicorn/better-regex\nexport const DATA_ATTR = seal(/^data-[\\-\\w.\\u00B7-\\uFFFF]+$/); // eslint-disable-line no-useless-escape\nexport const ARIA_ATTR = seal(/^aria-[\\-\\w]+$/); // eslint-disable-line no-useless-escape\nexport const IS_ALLOWED_URI = seal(\n  /^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\\-]+(?:[^a-z+.\\-:]|$))/i // eslint-disable-line no-useless-escape\n);\nexport const IS_SCRIPT_OR_DATA = seal(/^(?:\\w+script|data):/i);\nexport const ATTR_WHITESPACE = seal(\n  /[\\u0000-\\u0020\\u00A0\\u1680\\u180E\\u2000-\\u2029\\u205F\\u3000]/g // eslint-disable-line no-control-regex\n);\nexport const DOCTYPE_NAME = seal(/^html$/i);\nexport const CUSTOM_ELEMENT = seal(/^[a-z][.\\w]*(-[.\\w]+)+$/i);\n", "/* eslint-disable @typescript-eslint/indent */\n\nimport type {\n  TrustedHTML,\n  TrustedTypesWindow,\n} from 'trusted-types/lib/index.js';\nimport type { Config, UseProfilesConfig } from './config';\nimport * as TAGS from './tags.js';\nimport * as ATTRS from './attrs.js';\nimport * as EXPRESSIONS from './regexp.js';\nimport {\n  addToSet,\n  clone,\n  entries,\n  freeze,\n  arrayForEach,\n  arrayLastIndexOf,\n  arrayPop,\n  arrayPush,\n  arraySplice,\n  stringMatch,\n  stringReplace,\n  stringToLowerCase,\n  stringToString,\n  stringIndexOf,\n  stringTrim,\n  regExpTest,\n  typeErrorCreate,\n  lookupGetter,\n  create,\n  objectHasOwnProperty,\n} from './utils.js';\n\nexport type { Config } from './config';\n\ndeclare const VERSION: string;\n\n// https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType\nconst NODE_TYPE = {\n  element: 1,\n  attribute: 2,\n  text: 3,\n  cdataSection: 4,\n  entityReference: 5, // Deprecated\n  entityNode: 6, // Deprecated\n  progressingInstruction: 7,\n  comment: 8,\n  document: 9,\n  documentType: 10,\n  documentFragment: 11,\n  notation: 12, // Deprecated\n};\n\nconst getGlobal = function (): WindowLike {\n  return typeof window === 'undefined' ? null : window;\n};\n\n/**\n * Creates a no-op policy for internal use only.\n * Don't export this function outside this module!\n * @param trustedTypes The policy factory.\n * @param purifyHostElement The Script element used to load DOMPurify (to determine policy name suffix).\n * @return The policy created (or null, if Trusted Types\n * are not supported or creating the policy failed).\n */\nconst _createTrustedTypesPolicy = function (\n  trustedTypes: TrustedTypePolicyFactory,\n  purifyHostElement: HTMLScriptElement\n) {\n  if (\n    typeof trustedTypes !== 'object' ||\n    typeof trustedTypes.createPolicy !== 'function'\n  ) {\n    return null;\n  }\n\n  // Allow the callers to control the unique policy name\n  // by adding a data-tt-policy-suffix to the script element with the DOMPurify.\n  // Policy creation with duplicate names throws in Trusted Types.\n  let suffix = null;\n  const ATTR_NAME = 'data-tt-policy-suffix';\n  if (purifyHostElement && purifyHostElement.hasAttribute(ATTR_NAME)) {\n    suffix = purifyHostElement.getAttribute(ATTR_NAME);\n  }\n\n  const policyName = 'dompurify' + (suffix ? '#' + suffix : '');\n\n  try {\n    return trustedTypes.createPolicy(policyName, {\n      createHTML(html) {\n        return html;\n      },\n      createScriptURL(scriptUrl) {\n        return scriptUrl;\n      },\n    });\n  } catch (_) {\n    // Policy creation failed (most likely another DOMPurify script has\n    // already run). Skip creating the policy, as this will only cause errors\n    // if TT are enforced.\n    console.warn(\n      'TrustedTypes policy ' + policyName + ' could not be created.'\n    );\n    return null;\n  }\n};\n\nconst _createHooksMap = function (): HooksMap {\n  return {\n    afterSanitizeAttributes: [],\n    afterSanitizeElements: [],\n    afterSanitizeShadowDOM: [],\n    beforeSanitizeAttributes: [],\n    beforeSanitizeElements: [],\n    beforeSanitizeShadowDOM: [],\n    uponSanitizeAttribute: [],\n    uponSanitizeElement: [],\n    uponSanitizeShadowNode: [],\n  };\n};\n\nfunction createDOMPurify(window: WindowLike = getGlobal()): DOMPurify {\n  const DOMPurify: DOMPurify = (root: WindowLike) => createDOMPurify(root);\n\n  DOMPurify.version = VERSION;\n\n  DOMPurify.removed = [];\n\n  if (\n    !window ||\n    !window.document ||\n    window.document.nodeType !== NODE_TYPE.document ||\n    !window.Element\n  ) {\n    // Not running in a browser, provide a factory function\n    // so that you can pass your own Window\n    DOMPurify.isSupported = false;\n\n    return DOMPurify;\n  }\n\n  let { document } = window;\n\n  const originalDocument = document;\n  const currentScript: HTMLScriptElement =\n    originalDocument.currentScript as HTMLScriptElement;\n  const {\n    DocumentFragment,\n    HTMLTemplateElement,\n    Node,\n    Element,\n    NodeFilter,\n    NamedNodeMap = window.NamedNodeMap || (window as any).MozNamedAttrMap,\n    HTMLFormElement,\n    DOMParser,\n    trustedTypes,\n  } = window;\n\n  const ElementPrototype = Element.prototype;\n\n  const cloneNode = lookupGetter(ElementPrototype, 'cloneNode');\n  const remove = lookupGetter(ElementPrototype, 'remove');\n  const getNextSibling = lookupGetter(ElementPrototype, 'nextSibling');\n  const getChildNodes = lookupGetter(ElementPrototype, 'childNodes');\n  const getParentNode = lookupGetter(ElementPrototype, 'parentNode');\n\n  // As per issue #47, the web-components registry is inherited by a\n  // new document created via createHTMLDocument. As per the spec\n  // (http://w3c.github.io/webcomponents/spec/custom/#creating-and-passing-registries)\n  // a new empty registry is used when creating a template contents owner\n  // document, so we use that as our parent document to ensure nothing\n  // is inherited.\n  if (typeof HTMLTemplateElement === 'function') {\n    const template = document.createElement('template');\n    if (template.content && template.content.ownerDocument) {\n      document = template.content.ownerDocument;\n    }\n  }\n\n  let trustedTypesPolicy;\n  let emptyHTML = '';\n\n  const {\n    implementation,\n    createNodeIterator,\n    createDocumentFragment,\n    getElementsByTagName,\n  } = document;\n  const { importNode } = originalDocument;\n\n  let hooks = _createHooksMap();\n\n  /**\n   * Expose whether this browser supports running the full DOMPurify.\n   */\n  DOMPurify.isSupported =\n    typeof entries === 'function' &&\n    typeof getParentNode === 'function' &&\n    implementation &&\n    implementation.createHTMLDocument !== undefined;\n\n  const {\n    MUSTACHE_EXPR,\n    ERB_EXPR,\n    TMPLIT_EXPR,\n    DATA_ATTR,\n    ARIA_ATTR,\n    IS_SCRIPT_OR_DATA,\n    ATTR_WHITESPACE,\n    CUSTOM_ELEMENT,\n  } = EXPRESSIONS;\n\n  let { IS_ALLOWED_URI } = EXPRESSIONS;\n\n  /**\n   * We consider the elements and attributes below to be safe. Ideally\n   * don't add any new ones but feel free to remove unwanted ones.\n   */\n\n  /* allowed element names */\n  let ALLOWED_TAGS = null;\n  const DEFAULT_ALLOWED_TAGS = addToSet({}, [\n    ...TAGS.html,\n    ...TAGS.svg,\n    ...TAGS.svgFilters,\n    ...TAGS.mathMl,\n    ...TAGS.text,\n  ]);\n\n  /* Allowed attribute names */\n  let ALLOWED_ATTR = null;\n  const DEFAULT_ALLOWED_ATTR = addToSet({}, [\n    ...ATTRS.html,\n    ...ATTRS.svg,\n    ...ATTRS.mathMl,\n    ...ATTRS.xml,\n  ]);\n\n  /*\n   * Configure how DOMPurify should handle custom elements and their attributes as well as customized built-in elements.\n   * @property {RegExp|Function|null} tagNameCheck one of [null, regexPattern, predicate]. Default: `null` (disallow any custom elements)\n   * @property {RegExp|Function|null} attributeNameCheck one of [null, regexPattern, predicate]. Default: `null` (disallow any attributes not on the allow list)\n   * @property {boolean} allowCustomizedBuiltInElements allow custom elements derived from built-ins if they pass CUSTOM_ELEMENT_HANDLING.tagNameCheck. Default: `false`.\n   */\n  let CUSTOM_ELEMENT_HANDLING = Object.seal(\n    create(null, {\n      tagNameCheck: {\n        writable: true,\n        configurable: false,\n        enumerable: true,\n        value: null,\n      },\n      attributeNameCheck: {\n        writable: true,\n        configurable: false,\n        enumerable: true,\n        value: null,\n      },\n      allowCustomizedBuiltInElements: {\n        writable: true,\n        configurable: false,\n        enumerable: true,\n        value: false,\n      },\n    })\n  );\n\n  /* Explicitly forbidden tags (overrides ALLOWED_TAGS/ADD_TAGS) */\n  let FORBID_TAGS = null;\n\n  /* Explicitly forbidden attributes (overrides ALLOWED_ATTR/ADD_ATTR) */\n  let FORBID_ATTR = null;\n\n  /* Config object to store ADD_TAGS/ADD_ATTR functions (when used as functions) */\n  const EXTRA_ELEMENT_HANDLING = Object.seal(\n    create(null, {\n      tagCheck: {\n        writable: true,\n        configurable: false,\n        enumerable: true,\n        value: null,\n      },\n      attributeCheck: {\n        writable: true,\n        configurable: false,\n        enumerable: true,\n        value: null,\n      },\n    })\n  );\n\n  /* Decide if ARIA attributes are okay */\n  let ALLOW_ARIA_ATTR = true;\n\n  /* Decide if custom data attributes are okay */\n  let ALLOW_DATA_ATTR = true;\n\n  /* Decide if unknown protocols are okay */\n  let ALLOW_UNKNOWN_PROTOCOLS = false;\n\n  /* Decide if self-closing tags in attributes are allowed.\n   * Usually removed due to a mXSS issue in jQuery 3.0 */\n  let ALLOW_SELF_CLOSE_IN_ATTR = true;\n\n  /* Output should be safe for common template engines.\n   * This means, DOMPurify removes data attributes, mustaches and ERB\n   */\n  let SAFE_FOR_TEMPLATES = false;\n\n  /* Output should be safe even for XML used within HTML and alike.\n   * This means, DOMPurify removes comments when containing risky content.\n   */\n  let SAFE_FOR_XML = true;\n\n  /* Decide if document with <html>... should be returned */\n  let WHOLE_DOCUMENT = false;\n\n  /* Track whether config is already set on this instance of DOMPurify. */\n  let SET_CONFIG = false;\n\n  /* Decide if all elements (e.g. style, script) must be children of\n   * document.body. By default, browsers might move them to document.head */\n  let FORCE_BODY = false;\n\n  /* Decide if a DOM `HTMLBodyElement` should be returned, instead of a html\n   * string (or a TrustedHTML object if Trusted Types are supported).\n   * If `WHOLE_DOCUMENT` is enabled a `HTMLHtmlElement` will be returned instead\n   */\n  let RETURN_DOM = false;\n\n  /* Decide if a DOM `DocumentFragment` should be returned, instead of a html\n   * string  (or a TrustedHTML object if Trusted Types are supported) */\n  let RETURN_DOM_FRAGMENT = false;\n\n  /* Try to return a Trusted Type object instead of a string, return a string in\n   * case Trusted Types are not supported  */\n  let RETURN_TRUSTED_TYPE = false;\n\n  /* Output should be free from DOM clobbering attacks?\n   * This sanitizes markups named with colliding, clobberable built-in DOM APIs.\n   */\n  let SANITIZE_DOM = true;\n\n  /* Achieve full DOM Clobbering protection by isolating the namespace of named\n   * properties and JS variables, mitigating attacks that abuse the HTML/DOM spec rules.\n   *\n   * HTML/DOM spec rules that enable DOM Clobbering:\n   *   - Named Access on Window (§7.3.3)\n   *   - DOM Tree Accessors (§3.1.5)\n   *   - Form Element Parent-Child Relations (§4.10.3)\n   *   - Iframe srcdoc / Nested WindowProxies (§4.8.5)\n   *   - HTMLCollection (§4.2.10.2)\n   *\n   * Namespace isolation is implemented by prefixing `id` and `name` attributes\n   * with a constant string, i.e., `user-content-`\n   */\n  let SANITIZE_NAMED_PROPS = false;\n  const SANITIZE_NAMED_PROPS_PREFIX = 'user-content-';\n\n  /* Keep element content when removing element? */\n  let KEEP_CONTENT = true;\n\n  /* If a `Node` is passed to sanitize(), then performs sanitization in-place instead\n   * of importing it into a new Document and returning a sanitized copy */\n  let IN_PLACE = false;\n\n  /* Allow usage of profiles like html, svg and mathMl */\n  let USE_PROFILES: UseProfilesConfig | false = {};\n\n  /* Tags to ignore content of when KEEP_CONTENT is true */\n  let FORBID_CONTENTS = null;\n  const DEFAULT_FORBID_CONTENTS = addToSet({}, [\n    'annotation-xml',\n    'audio',\n    'colgroup',\n    'desc',\n    'foreignobject',\n    'head',\n    'iframe',\n    'math',\n    'mi',\n    'mn',\n    'mo',\n    'ms',\n    'mtext',\n    'noembed',\n    'noframes',\n    'noscript',\n    'plaintext',\n    'script',\n    'style',\n    'svg',\n    'template',\n    'thead',\n    'title',\n    'video',\n    'xmp',\n  ]);\n\n  /* Tags that are safe for data: URIs */\n  let DATA_URI_TAGS = null;\n  const DEFAULT_DATA_URI_TAGS = addToSet({}, [\n    'audio',\n    'video',\n    'img',\n    'source',\n    'image',\n    'track',\n  ]);\n\n  /* Attributes safe for values like \"javascript:\" */\n  let URI_SAFE_ATTRIBUTES = null;\n  const DEFAULT_URI_SAFE_ATTRIBUTES = addToSet({}, [\n    'alt',\n    'class',\n    'for',\n    'id',\n    'label',\n    'name',\n    'pattern',\n    'placeholder',\n    'role',\n    'summary',\n    'title',\n    'value',\n    'style',\n    'xmlns',\n  ]);\n\n  const MATHML_NAMESPACE = 'http://www.w3.org/1998/Math/MathML';\n  const SVG_NAMESPACE = 'http://www.w3.org/2000/svg';\n  const HTML_NAMESPACE = 'http://www.w3.org/1999/xhtml';\n  /* Document namespace */\n  let NAMESPACE = HTML_NAMESPACE;\n  let IS_EMPTY_INPUT = false;\n\n  /* Allowed XHTML+XML namespaces */\n  let ALLOWED_NAMESPACES = null;\n  const DEFAULT_ALLOWED_NAMESPACES = addToSet(\n    {},\n    [MATHML_NAMESPACE, SVG_NAMESPACE, HTML_NAMESPACE],\n    stringToString\n  );\n\n  let MATHML_TEXT_INTEGRATION_POINTS = addToSet({}, [\n    'mi',\n    'mo',\n    'mn',\n    'ms',\n    'mtext',\n  ]);\n\n  let HTML_INTEGRATION_POINTS = addToSet({}, ['annotation-xml']);\n\n  // Certain elements are allowed in both SVG and HTML\n  // namespace. We need to specify them explicitly\n  // so that they don't get erroneously deleted from\n  // HTML namespace.\n  const COMMON_SVG_AND_HTML_ELEMENTS = addToSet({}, [\n    'title',\n    'style',\n    'font',\n    'a',\n    'script',\n  ]);\n\n  /* Parsing of strict XHTML documents */\n  let PARSER_MEDIA_TYPE: null | DOMParserSupportedType = null;\n  const SUPPORTED_PARSER_MEDIA_TYPES = ['application/xhtml+xml', 'text/html'];\n  const DEFAULT_PARSER_MEDIA_TYPE = 'text/html';\n  let transformCaseFunc: null | Parameters<typeof addToSet>[2] = null;\n\n  /* Keep a reference to config to pass to hooks */\n  let CONFIG: Config | null = null;\n\n  /* Ideally, do not touch anything below this line */\n  /* ______________________________________________ */\n\n  const formElement = document.createElement('form');\n\n  const isRegexOrFunction = function (\n    testValue: unknown\n  ): testValue is Function | RegExp {\n    return testValue instanceof RegExp || testValue instanceof Function;\n  };\n\n  /**\n   * _parseConfig\n   *\n   * @param cfg optional config literal\n   */\n  // eslint-disable-next-line complexity\n  const _parseConfig = function (cfg: Config = {}): void {\n    if (CONFIG && CONFIG === cfg) {\n      return;\n    }\n\n    /* Shield configuration object from tampering */\n    if (!cfg || typeof cfg !== 'object') {\n      cfg = {};\n    }\n\n    /* Shield configuration object from prototype pollution */\n    cfg = clone(cfg);\n\n    PARSER_MEDIA_TYPE =\n      // eslint-disable-next-line unicorn/prefer-includes\n      SUPPORTED_PARSER_MEDIA_TYPES.indexOf(cfg.PARSER_MEDIA_TYPE) === -1\n        ? DEFAULT_PARSER_MEDIA_TYPE\n        : cfg.PARSER_MEDIA_TYPE;\n\n    // HTML tags and attributes are not case-sensitive, converting to lowercase. Keeping XHTML as is.\n    transformCaseFunc =\n      PARSER_MEDIA_TYPE === 'application/xhtml+xml'\n        ? stringToString\n        : stringToLowerCase;\n\n    /* Set configuration parameters */\n    ALLOWED_TAGS = objectHasOwnProperty(cfg, 'ALLOWED_TAGS')\n      ? addToSet({}, cfg.ALLOWED_TAGS, transformCaseFunc)\n      : DEFAULT_ALLOWED_TAGS;\n    ALLOWED_ATTR = objectHasOwnProperty(cfg, 'ALLOWED_ATTR')\n      ? addToSet({}, cfg.ALLOWED_ATTR, transformCaseFunc)\n      : DEFAULT_ALLOWED_ATTR;\n    ALLOWED_NAMESPACES = objectHasOwnProperty(cfg, 'ALLOWED_NAMESPACES')\n      ? addToSet({}, cfg.ALLOWED_NAMESPACES, stringToString)\n      : DEFAULT_ALLOWED_NAMESPACES;\n    URI_SAFE_ATTRIBUTES = objectHasOwnProperty(cfg, 'ADD_URI_SAFE_ATTR')\n      ? addToSet(\n          clone(DEFAULT_URI_SAFE_ATTRIBUTES),\n          cfg.ADD_URI_SAFE_ATTR,\n          transformCaseFunc\n        )\n      : DEFAULT_URI_SAFE_ATTRIBUTES;\n    DATA_URI_TAGS = objectHasOwnProperty(cfg, 'ADD_DATA_URI_TAGS')\n      ? addToSet(\n          clone(DEFAULT_DATA_URI_TAGS),\n          cfg.ADD_DATA_URI_TAGS,\n          transformCaseFunc\n        )\n      : DEFAULT_DATA_URI_TAGS;\n    FORBID_CONTENTS = objectHasOwnProperty(cfg, 'FORBID_CONTENTS')\n      ? addToSet({}, cfg.FORBID_CONTENTS, transformCaseFunc)\n      : DEFAULT_FORBID_CONTENTS;\n    FORBID_TAGS = objectHasOwnProperty(cfg, 'FORBID_TAGS')\n      ? addToSet({}, cfg.FORBID_TAGS, transformCaseFunc)\n      : clone({});\n    FORBID_ATTR = objectHasOwnProperty(cfg, 'FORBID_ATTR')\n      ? addToSet({}, cfg.FORBID_ATTR, transformCaseFunc)\n      : clone({});\n    USE_PROFILES = objectHasOwnProperty(cfg, 'USE_PROFILES')\n      ? cfg.USE_PROFILES\n      : false;\n    ALLOW_ARIA_ATTR = cfg.ALLOW_ARIA_ATTR !== false; // Default true\n    ALLOW_DATA_ATTR = cfg.ALLOW_DATA_ATTR !== false; // Default true\n    ALLOW_UNKNOWN_PROTOCOLS = cfg.ALLOW_UNKNOWN_PROTOCOLS || false; // Default false\n    ALLOW_SELF_CLOSE_IN_ATTR = cfg.ALLOW_SELF_CLOSE_IN_ATTR !== false; // Default true\n    SAFE_FOR_TEMPLATES = cfg.SAFE_FOR_TEMPLATES || false; // Default false\n    SAFE_FOR_XML = cfg.SAFE_FOR_XML !== false; // Default true\n    WHOLE_DOCUMENT = cfg.WHOLE_DOCUMENT || false; // Default false\n    RETURN_DOM = cfg.RETURN_DOM || false; // Default false\n    RETURN_DOM_FRAGMENT = cfg.RETURN_DOM_FRAGMENT || false; // Default false\n    RETURN_TRUSTED_TYPE = cfg.RETURN_TRUSTED_TYPE || false; // Default false\n    FORCE_BODY = cfg.FORCE_BODY || false; // Default false\n    SANITIZE_DOM = cfg.SANITIZE_DOM !== false; // Default true\n    SANITIZE_NAMED_PROPS = cfg.SANITIZE_NAMED_PROPS || false; // Default false\n    KEEP_CONTENT = cfg.KEEP_CONTENT !== false; // Default true\n    IN_PLACE = cfg.IN_PLACE || false; // Default false\n    IS_ALLOWED_URI = cfg.ALLOWED_URI_REGEXP || EXPRESSIONS.IS_ALLOWED_URI;\n    NAMESPACE = cfg.NAMESPACE || HTML_NAMESPACE;\n    MATHML_TEXT_INTEGRATION_POINTS =\n      cfg.MATHML_TEXT_INTEGRATION_POINTS || MATHML_TEXT_INTEGRATION_POINTS;\n    HTML_INTEGRATION_POINTS =\n      cfg.HTML_INTEGRATION_POINTS || HTML_INTEGRATION_POINTS;\n\n    CUSTOM_ELEMENT_HANDLING = cfg.CUSTOM_ELEMENT_HANDLING || {};\n    if (\n      cfg.CUSTOM_ELEMENT_HANDLING &&\n      isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck)\n    ) {\n      CUSTOM_ELEMENT_HANDLING.tagNameCheck =\n        cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck;\n    }\n\n    if (\n      cfg.CUSTOM_ELEMENT_HANDLING &&\n      isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)\n    ) {\n      CUSTOM_ELEMENT_HANDLING.attributeNameCheck =\n        cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck;\n    }\n\n    if (\n      cfg.CUSTOM_ELEMENT_HANDLING &&\n      typeof cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements ===\n        'boolean'\n    ) {\n      CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements =\n        cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements;\n    }\n\n    if (SAFE_FOR_TEMPLATES) {\n      ALLOW_DATA_ATTR = false;\n    }\n\n    if (RETURN_DOM_FRAGMENT) {\n      RETURN_DOM = true;\n    }\n\n    /* Parse profile info */\n    if (USE_PROFILES) {\n      ALLOWED_TAGS = addToSet({}, TAGS.text);\n      ALLOWED_ATTR = [];\n      if (USE_PROFILES.html === true) {\n        addToSet(ALLOWED_TAGS, TAGS.html);\n        addToSet(ALLOWED_ATTR, ATTRS.html);\n      }\n\n      if (USE_PROFILES.svg === true) {\n        addToSet(ALLOWED_TAGS, TAGS.svg);\n        addToSet(ALLOWED_ATTR, ATTRS.svg);\n        addToSet(ALLOWED_ATTR, ATTRS.xml);\n      }\n\n      if (USE_PROFILES.svgFilters === true) {\n        addToSet(ALLOWED_TAGS, TAGS.svgFilters);\n        addToSet(ALLOWED_ATTR, ATTRS.svg);\n        addToSet(ALLOWED_ATTR, ATTRS.xml);\n      }\n\n      if (USE_PROFILES.mathMl === true) {\n        addToSet(ALLOWED_TAGS, TAGS.mathMl);\n        addToSet(ALLOWED_ATTR, ATTRS.mathMl);\n        addToSet(ALLOWED_ATTR, ATTRS.xml);\n      }\n    }\n\n    /* Merge configuration parameters */\n    if (cfg.ADD_TAGS) {\n      if (typeof cfg.ADD_TAGS === 'function') {\n        EXTRA_ELEMENT_HANDLING.tagCheck = cfg.ADD_TAGS;\n      } else {\n        if (ALLOWED_TAGS === DEFAULT_ALLOWED_TAGS) {\n          ALLOWED_TAGS = clone(ALLOWED_TAGS);\n        }\n\n        addToSet(ALLOWED_TAGS, cfg.ADD_TAGS, transformCaseFunc);\n      }\n    }\n\n    if (cfg.ADD_ATTR) {\n      if (typeof cfg.ADD_ATTR === 'function') {\n        EXTRA_ELEMENT_HANDLING.attributeCheck = cfg.ADD_ATTR;\n      } else {\n        if (ALLOWED_ATTR === DEFAULT_ALLOWED_ATTR) {\n          ALLOWED_ATTR = clone(ALLOWED_ATTR);\n        }\n\n        addToSet(ALLOWED_ATTR, cfg.ADD_ATTR, transformCaseFunc);\n      }\n    }\n\n    if (cfg.ADD_URI_SAFE_ATTR) {\n      addToSet(URI_SAFE_ATTRIBUTES, cfg.ADD_URI_SAFE_ATTR, transformCaseFunc);\n    }\n\n    if (cfg.FORBID_CONTENTS) {\n      if (FORBID_CONTENTS === DEFAULT_FORBID_CONTENTS) {\n        FORBID_CONTENTS = clone(FORBID_CONTENTS);\n      }\n\n      addToSet(FORBID_CONTENTS, cfg.FORBID_CONTENTS, transformCaseFunc);\n    }\n\n    if (cfg.ADD_FORBID_CONTENTS) {\n      if (FORBID_CONTENTS === DEFAULT_FORBID_CONTENTS) {\n        FORBID_CONTENTS = clone(FORBID_CONTENTS);\n      }\n\n      addToSet(FORBID_CONTENTS, cfg.ADD_FORBID_CONTENTS, transformCaseFunc);\n    }\n\n    /* Add #text in case KEEP_CONTENT is set to true */\n    if (KEEP_CONTENT) {\n      ALLOWED_TAGS['#text'] = true;\n    }\n\n    /* Add html, head and body to ALLOWED_TAGS in case WHOLE_DOCUMENT is true */\n    if (WHOLE_DOCUMENT) {\n      addToSet(ALLOWED_TAGS, ['html', 'head', 'body']);\n    }\n\n    /* Add tbody to ALLOWED_TAGS in case tables are permitted, see #286, #365 */\n    if (ALLOWED_TAGS.table) {\n      addToSet(ALLOWED_TAGS, ['tbody']);\n      delete FORBID_TAGS.tbody;\n    }\n\n    if (cfg.TRUSTED_TYPES_POLICY) {\n      if (typeof cfg.TRUSTED_TYPES_POLICY.createHTML !== 'function') {\n        throw typeErrorCreate(\n          'TRUSTED_TYPES_POLICY configuration option must provide a \"createHTML\" hook.'\n        );\n      }\n\n      if (typeof cfg.TRUSTED_TYPES_POLICY.createScriptURL !== 'function') {\n        throw typeErrorCreate(\n          'TRUSTED_TYPES_POLICY configuration option must provide a \"createScriptURL\" hook.'\n        );\n      }\n\n      // Overwrite existing TrustedTypes policy.\n      trustedTypesPolicy = cfg.TRUSTED_TYPES_POLICY;\n\n      // Sign local variables required by `sanitize`.\n      emptyHTML = trustedTypesPolicy.createHTML('');\n    } else {\n      // Uninitialized policy, attempt to initialize the internal dompurify policy.\n      if (trustedTypesPolicy === undefined) {\n        trustedTypesPolicy = _createTrustedTypesPolicy(\n          trustedTypes,\n          currentScript\n        );\n      }\n\n      // If creating the internal policy succeeded sign internal variables.\n      if (trustedTypesPolicy !== null && typeof emptyHTML === 'string') {\n        emptyHTML = trustedTypesPolicy.createHTML('');\n      }\n    }\n\n    // Prevent further manipulation of configuration.\n    // Not available in IE8, Safari 5, etc.\n    if (freeze) {\n      freeze(cfg);\n    }\n\n    CONFIG = cfg;\n  };\n\n  /* Keep track of all possible SVG and MathML tags\n   * so that we can perform the namespace checks\n   * correctly. */\n  const ALL_SVG_TAGS = addToSet({}, [\n    ...TAGS.svg,\n    ...TAGS.svgFilters,\n    ...TAGS.svgDisallowed,\n  ]);\n  const ALL_MATHML_TAGS = addToSet({}, [\n    ...TAGS.mathMl,\n    ...TAGS.mathMlDisallowed,\n  ]);\n\n  /**\n   * @param element a DOM element whose namespace is being checked\n   * @returns Return false if the element has a\n   *  namespace that a spec-compliant parser would never\n   *  return. Return true otherwise.\n   */\n  const _checkValidNamespace = function (element: Element): boolean {\n    let parent = getParentNode(element);\n\n    // In JSDOM, if we're inside shadow DOM, then parentNode\n    // can be null. We just simulate parent in this case.\n    if (!parent || !parent.tagName) {\n      parent = {\n        namespaceURI: NAMESPACE,\n        tagName: 'template',\n      };\n    }\n\n    const tagName = stringToLowerCase(element.tagName);\n    const parentTagName = stringToLowerCase(parent.tagName);\n\n    if (!ALLOWED_NAMESPACES[element.namespaceURI]) {\n      return false;\n    }\n\n    if (element.namespaceURI === SVG_NAMESPACE) {\n      // The only way to switch from HTML namespace to SVG\n      // is via <svg>. If it happens via any other tag, then\n      // it should be killed.\n      if (parent.namespaceURI === HTML_NAMESPACE) {\n        return tagName === 'svg';\n      }\n\n      // The only way to switch from MathML to SVG is via`\n      // svg if parent is either <annotation-xml> or MathML\n      // text integration points.\n      if (parent.namespaceURI === MATHML_NAMESPACE) {\n        return (\n          tagName === 'svg' &&\n          (parentTagName === 'annotation-xml' ||\n            MATHML_TEXT_INTEGRATION_POINTS[parentTagName])\n        );\n      }\n\n      // We only allow elements that are defined in SVG\n      // spec. All others are disallowed in SVG namespace.\n      return Boolean(ALL_SVG_TAGS[tagName]);\n    }\n\n    if (element.namespaceURI === MATHML_NAMESPACE) {\n      // The only way to switch from HTML namespace to MathML\n      // is via <math>. If it happens via any other tag, then\n      // it should be killed.\n      if (parent.namespaceURI === HTML_NAMESPACE) {\n        return tagName === 'math';\n      }\n\n      // The only way to switch from SVG to MathML is via\n      // <math> and HTML integration points\n      if (parent.namespaceURI === SVG_NAMESPACE) {\n        return tagName === 'math' && HTML_INTEGRATION_POINTS[parentTagName];\n      }\n\n      // We only allow elements that are defined in MathML\n      // spec. All others are disallowed in MathML namespace.\n      return Boolean(ALL_MATHML_TAGS[tagName]);\n    }\n\n    if (element.namespaceURI === HTML_NAMESPACE) {\n      // The only way to switch from SVG to HTML is via\n      // HTML integration points, and from MathML to HTML\n      // is via MathML text integration points\n      if (\n        parent.namespaceURI === SVG_NAMESPACE &&\n        !HTML_INTEGRATION_POINTS[parentTagName]\n      ) {\n        return false;\n      }\n\n      if (\n        parent.namespaceURI === MATHML_NAMESPACE &&\n        !MATHML_TEXT_INTEGRATION_POINTS[parentTagName]\n      ) {\n        return false;\n      }\n\n      // We disallow tags that are specific for MathML\n      // or SVG and should never appear in HTML namespace\n      return (\n        !ALL_MATHML_TAGS[tagName] &&\n        (COMMON_SVG_AND_HTML_ELEMENTS[tagName] || !ALL_SVG_TAGS[tagName])\n      );\n    }\n\n    // For XHTML and XML documents that support custom namespaces\n    if (\n      PARSER_MEDIA_TYPE === 'application/xhtml+xml' &&\n      ALLOWED_NAMESPACES[element.namespaceURI]\n    ) {\n      return true;\n    }\n\n    // The code should never reach this place (this means\n    // that the element somehow got namespace that is not\n    // HTML, SVG, MathML or allowed via ALLOWED_NAMESPACES).\n    // Return false just in case.\n    return false;\n  };\n\n  /**\n   * _forceRemove\n   *\n   * @param node a DOM node\n   */\n  const _forceRemove = function (node: Node): void {\n    arrayPush(DOMPurify.removed, { element: node });\n\n    try {\n      // eslint-disable-next-line unicorn/prefer-dom-node-remove\n      getParentNode(node).removeChild(node);\n    } catch (_) {\n      remove(node);\n    }\n  };\n\n  /**\n   * _removeAttribute\n   *\n   * @param name an Attribute name\n   * @param element a DOM node\n   */\n  const _removeAttribute = function (name: string, element: Element): void {\n    try {\n      arrayPush(DOMPurify.removed, {\n        attribute: element.getAttributeNode(name),\n        from: element,\n      });\n    } catch (_) {\n      arrayPush(DOMPurify.removed, {\n        attribute: null,\n        from: element,\n      });\n    }\n\n    element.removeAttribute(name);\n\n    // We void attribute values for unremovable \"is\" attributes\n    if (name === 'is') {\n      if (RETURN_DOM || RETURN_DOM_FRAGMENT) {\n        try {\n          _forceRemove(element);\n        } catch (_) {}\n      } else {\n        try {\n          element.setAttribute(name, '');\n        } catch (_) {}\n      }\n    }\n  };\n\n  /**\n   * _initDocument\n   *\n   * @param dirty - a string of dirty markup\n   * @return a DOM, filled with the dirty markup\n   */\n  const _initDocument = function (dirty: string): Document {\n    /* Create a HTML document */\n    let doc = null;\n    let leadingWhitespace = null;\n\n    if (FORCE_BODY) {\n      dirty = '<remove></remove>' + dirty;\n    } else {\n      /* If FORCE_BODY isn't used, leading whitespace needs to be preserved manually */\n      const matches = stringMatch(dirty, /^[\\r\\n\\t ]+/);\n      leadingWhitespace = matches && matches[0];\n    }\n\n    if (\n      PARSER_MEDIA_TYPE === 'application/xhtml+xml' &&\n      NAMESPACE === HTML_NAMESPACE\n    ) {\n      // Root of XHTML doc must contain xmlns declaration (see https://www.w3.org/TR/xhtml1/normative.html#strict)\n      dirty =\n        '<html xmlns=\"http://www.w3.org/1999/xhtml\"><head></head><body>' +\n        dirty +\n        '</body></html>';\n    }\n\n    const dirtyPayload = trustedTypesPolicy\n      ? trustedTypesPolicy.createHTML(dirty)\n      : dirty;\n    /*\n     * Use the DOMParser API by default, fallback later if needs be\n     * DOMParser not work for svg when has multiple root element.\n     */\n    if (NAMESPACE === HTML_NAMESPACE) {\n      try {\n        doc = new DOMParser().parseFromString(dirtyPayload, PARSER_MEDIA_TYPE);\n      } catch (_) {}\n    }\n\n    /* Use createHTMLDocument in case DOMParser is not available */\n    if (!doc || !doc.documentElement) {\n      doc = implementation.createDocument(NAMESPACE, 'template', null);\n      try {\n        doc.documentElement.innerHTML = IS_EMPTY_INPUT\n          ? emptyHTML\n          : dirtyPayload;\n      } catch (_) {\n        // Syntax error if dirtyPayload is invalid xml\n      }\n    }\n\n    const body = doc.body || doc.documentElement;\n\n    if (dirty && leadingWhitespace) {\n      body.insertBefore(\n        document.createTextNode(leadingWhitespace),\n        body.childNodes[0] || null\n      );\n    }\n\n    /* Work on whole document or just its body */\n    if (NAMESPACE === HTML_NAMESPACE) {\n      return getElementsByTagName.call(\n        doc,\n        WHOLE_DOCUMENT ? 'html' : 'body'\n      )[0];\n    }\n\n    return WHOLE_DOCUMENT ? doc.documentElement : body;\n  };\n\n  /**\n   * Creates a NodeIterator object that you can use to traverse filtered lists of nodes or elements in a document.\n   *\n   * @param root The root element or node to start traversing on.\n   * @return The created NodeIterator\n   */\n  const _createNodeIterator = function (root: Node): NodeIterator {\n    return createNodeIterator.call(\n      root.ownerDocument || root,\n      root,\n      // eslint-disable-next-line no-bitwise\n      NodeFilter.SHOW_ELEMENT |\n        NodeFilter.SHOW_COMMENT |\n        NodeFilter.SHOW_TEXT |\n        NodeFilter.SHOW_PROCESSING_INSTRUCTION |\n        NodeFilter.SHOW_CDATA_SECTION,\n      null\n    );\n  };\n\n  /**\n   * _isClobbered\n   *\n   * @param element element to check for clobbering attacks\n   * @return true if clobbered, false if safe\n   */\n  const _isClobbered = function (element: Element): boolean {\n    return (\n      element instanceof HTMLFormElement &&\n      (typeof element.nodeName !== 'string' ||\n        typeof element.textContent !== 'string' ||\n        typeof element.removeChild !== 'function' ||\n        !(element.attributes instanceof NamedNodeMap) ||\n        typeof element.removeAttribute !== 'function' ||\n        typeof element.setAttribute !== 'function' ||\n        typeof element.namespaceURI !== 'string' ||\n        typeof element.insertBefore !== 'function' ||\n        typeof element.hasChildNodes !== 'function')\n    );\n  };\n\n  /**\n   * Checks whether the given object is a DOM node.\n   *\n   * @param value object to check whether it's a DOM node\n   * @return true is object is a DOM node\n   */\n  const _isNode = function (value: unknown): value is Node {\n    return typeof Node === 'function' && value instanceof Node;\n  };\n\n  function _executeHooks<T extends HookFunction>(\n    hooks: HookFunction[],\n    currentNode: Parameters<T>[0],\n    data: Parameters<T>[1]\n  ): void {\n    arrayForEach(hooks, (hook: T) => {\n      hook.call(DOMPurify, currentNode, data, CONFIG);\n    });\n  }\n\n  /**\n   * _sanitizeElements\n   *\n   * @protect nodeName\n   * @protect textContent\n   * @protect removeChild\n   * @param currentNode to check for permission to exist\n   * @return true if node was killed, false if left alive\n   */\n  const _sanitizeElements = function (currentNode: any): boolean {\n    let content = null;\n\n    /* Execute a hook if present */\n    _executeHooks(hooks.beforeSanitizeElements, currentNode, null);\n\n    /* Check if element is clobbered or can clobber */\n    if (_isClobbered(currentNode)) {\n      _forceRemove(currentNode);\n      return true;\n    }\n\n    /* Now let's check the element's type and name */\n    const tagName = transformCaseFunc(currentNode.nodeName);\n\n    /* Execute a hook if present */\n    _executeHooks(hooks.uponSanitizeElement, currentNode, {\n      tagName,\n      allowedTags: ALLOWED_TAGS,\n    });\n\n    /* Detect mXSS attempts abusing namespace confusion */\n    if (\n      SAFE_FOR_XML &&\n      currentNode.hasChildNodes() &&\n      !_isNode(currentNode.firstElementChild) &&\n      regExpTest(/<[/\\w!]/g, currentNode.innerHTML) &&\n      regExpTest(/<[/\\w!]/g, currentNode.textContent)\n    ) {\n      _forceRemove(currentNode);\n      return true;\n    }\n\n    /* Remove any occurrence of processing instructions */\n    if (currentNode.nodeType === NODE_TYPE.progressingInstruction) {\n      _forceRemove(currentNode);\n      return true;\n    }\n\n    /* Remove any kind of possibly harmful comments */\n    if (\n      SAFE_FOR_XML &&\n      currentNode.nodeType === NODE_TYPE.comment &&\n      regExpTest(/<[/\\w]/g, currentNode.data)\n    ) {\n      _forceRemove(currentNode);\n      return true;\n    }\n\n    /* Remove element if anything forbids its presence */\n    if (\n      !(\n        EXTRA_ELEMENT_HANDLING.tagCheck instanceof Function &&\n        EXTRA_ELEMENT_HANDLING.tagCheck(tagName)\n      ) &&\n      (!ALLOWED_TAGS[tagName] || FORBID_TAGS[tagName])\n    ) {\n      /* Check if we have a custom element to handle */\n      if (!FORBID_TAGS[tagName] && _isBasicCustomElement(tagName)) {\n        if (\n          CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp &&\n          regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, tagName)\n        ) {\n          return false;\n        }\n\n        if (\n          CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function &&\n          CUSTOM_ELEMENT_HANDLING.tagNameCheck(tagName)\n        ) {\n          return false;\n        }\n      }\n\n      /* Keep content except for bad-listed elements */\n      if (KEEP_CONTENT && !FORBID_CONTENTS[tagName]) {\n        const parentNode = getParentNode(currentNode) || currentNode.parentNode;\n        const childNodes = getChildNodes(currentNode) || currentNode.childNodes;\n\n        if (childNodes && parentNode) {\n          const childCount = childNodes.length;\n\n          for (let i = childCount - 1; i >= 0; --i) {\n            const childClone = cloneNode(childNodes[i], true);\n            childClone.__removalCount = (currentNode.__removalCount || 0) + 1;\n            parentNode.insertBefore(childClone, getNextSibling(currentNode));\n          }\n        }\n      }\n\n      _forceRemove(currentNode);\n      return true;\n    }\n\n    /* Check whether element has a valid namespace */\n    if (currentNode instanceof Element && !_checkValidNamespace(currentNode)) {\n      _forceRemove(currentNode);\n      return true;\n    }\n\n    /* Make sure that older browsers don't get fallback-tag mXSS */\n    if (\n      (tagName === 'noscript' ||\n        tagName === 'noembed' ||\n        tagName === 'noframes') &&\n      regExpTest(/<\\/no(script|embed|frames)/i, currentNode.innerHTML)\n    ) {\n      _forceRemove(currentNode);\n      return true;\n    }\n\n    /* Sanitize element content to be template-safe */\n    if (SAFE_FOR_TEMPLATES && currentNode.nodeType === NODE_TYPE.text) {\n      /* Get the element's text content */\n      content = currentNode.textContent;\n\n      arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], (expr: RegExp) => {\n        content = stringReplace(content, expr, ' ');\n      });\n\n      if (currentNode.textContent !== content) {\n        arrayPush(DOMPurify.removed, { element: currentNode.cloneNode() });\n        currentNode.textContent = content;\n      }\n    }\n\n    /* Execute a hook if present */\n    _executeHooks(hooks.afterSanitizeElements, currentNode, null);\n\n    return false;\n  };\n\n  /**\n   * _isValidAttribute\n   *\n   * @param lcTag Lowercase tag name of containing element.\n   * @param lcName Lowercase attribute name.\n   * @param value Attribute value.\n   * @return Returns true if `value` is valid, otherwise false.\n   */\n  // eslint-disable-next-line complexity\n  const _isValidAttribute = function (\n    lcTag: string,\n    lcName: string,\n    value: string\n  ): boolean {\n    /* Make sure attribute cannot clobber */\n    if (\n      SANITIZE_DOM &&\n      (lcName === 'id' || lcName === 'name') &&\n      (value in document || value in formElement)\n    ) {\n      return false;\n    }\n\n    /* Allow valid data-* attributes: At least one character after \"-\"\n        (https://html.spec.whatwg.org/multipage/dom.html#embedding-custom-non-visible-data-with-the-data-*-attributes)\n        XML-compatible (https://html.spec.whatwg.org/multipage/infrastructure.html#xml-compatible and http://www.w3.org/TR/xml/#d0e804)\n        We don't need to check the value; it's always URI safe. */\n    if (\n      ALLOW_DATA_ATTR &&\n      !FORBID_ATTR[lcName] &&\n      regExpTest(DATA_ATTR, lcName)\n    ) {\n      // This attribute is safe\n    } else if (ALLOW_ARIA_ATTR && regExpTest(ARIA_ATTR, lcName)) {\n      // This attribute is safe\n      /* Check if ADD_ATTR function allows this attribute */\n    } else if (\n      EXTRA_ELEMENT_HANDLING.attributeCheck instanceof Function &&\n      EXTRA_ELEMENT_HANDLING.attributeCheck(lcName, lcTag)\n    ) {\n      // This attribute is safe\n      /* Otherwise, check the name is permitted */\n    } else if (!ALLOWED_ATTR[lcName] || FORBID_ATTR[lcName]) {\n      if (\n        // First condition does a very basic check if a) it's basically a valid custom element tagname AND\n        // b) if the tagName passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.tagNameCheck\n        // and c) if the attribute name passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.attributeNameCheck\n        (_isBasicCustomElement(lcTag) &&\n          ((CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp &&\n            regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, lcTag)) ||\n            (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function &&\n              CUSTOM_ELEMENT_HANDLING.tagNameCheck(lcTag))) &&\n          ((CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof RegExp &&\n            regExpTest(CUSTOM_ELEMENT_HANDLING.attributeNameCheck, lcName)) ||\n            (CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof Function &&\n              CUSTOM_ELEMENT_HANDLING.attributeNameCheck(lcName, lcTag)))) ||\n        // Alternative, second condition checks if it's an `is`-attribute, AND\n        // the value passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.tagNameCheck\n        (lcName === 'is' &&\n          CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements &&\n          ((CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp &&\n            regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, value)) ||\n            (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function &&\n              CUSTOM_ELEMENT_HANDLING.tagNameCheck(value))))\n      ) {\n        // If user has supplied a regexp or function in CUSTOM_ELEMENT_HANDLING.tagNameCheck, we need to also allow derived custom elements using the same tagName test.\n        // Additionally, we need to allow attributes passing the CUSTOM_ELEMENT_HANDLING.attributeNameCheck user has configured, as custom elements can define these at their own discretion.\n      } else {\n        return false;\n      }\n      /* Check value is safe. First, is attr inert? If so, is safe */\n    } else if (URI_SAFE_ATTRIBUTES[lcName]) {\n      // This attribute is safe\n      /* Check no script, data or unknown possibly unsafe URI\n        unless we know URI values are safe for that attribute */\n    } else if (\n      regExpTest(IS_ALLOWED_URI, stringReplace(value, ATTR_WHITESPACE, ''))\n    ) {\n      // This attribute is safe\n      /* Keep image data URIs alive if src/xlink:href is allowed */\n      /* Further prevent gadget XSS for dynamically built script tags */\n    } else if (\n      (lcName === 'src' || lcName === 'xlink:href' || lcName === 'href') &&\n      lcTag !== 'script' &&\n      stringIndexOf(value, 'data:') === 0 &&\n      DATA_URI_TAGS[lcTag]\n    ) {\n      // This attribute is safe\n      /* Allow unknown protocols: This provides support for links that\n        are handled by protocol handlers which may be unknown ahead of\n        time, e.g. fb:, spotify: */\n    } else if (\n      ALLOW_UNKNOWN_PROTOCOLS &&\n      !regExpTest(IS_SCRIPT_OR_DATA, stringReplace(value, ATTR_WHITESPACE, ''))\n    ) {\n      // This attribute is safe\n      /* Check for binary attributes */\n    } else if (value) {\n      return false;\n    } else {\n      // Binary attributes are safe at this point\n      /* Anything else, presume unsafe, do not add it back */\n    }\n\n    return true;\n  };\n\n  /**\n   * _isBasicCustomElement\n   * checks if at least one dash is included in tagName, and it's not the first char\n   * for more sophisticated checking see https://github.com/sindresorhus/validate-element-name\n   *\n   * @param tagName name of the tag of the node to sanitize\n   * @returns Returns true if the tag name meets the basic criteria for a custom element, otherwise false.\n   */\n  const _isBasicCustomElement = function (tagName: string): RegExpMatchArray {\n    return tagName !== 'annotation-xml' && stringMatch(tagName, CUSTOM_ELEMENT);\n  };\n\n  /**\n   * _sanitizeAttributes\n   *\n   * @protect attributes\n   * @protect nodeName\n   * @protect removeAttribute\n   * @protect setAttribute\n   *\n   * @param currentNode to sanitize\n   */\n  const _sanitizeAttributes = function (currentNode: Element): void {\n    /* Execute a hook if present */\n    _executeHooks(hooks.beforeSanitizeAttributes, currentNode, null);\n\n    const { attributes } = currentNode;\n\n    /* Check if we have attributes; if not we might have a text node */\n    if (!attributes || _isClobbered(currentNode)) {\n      return;\n    }\n\n    const hookEvent = {\n      attrName: '',\n      attrValue: '',\n      keepAttr: true,\n      allowedAttributes: ALLOWED_ATTR,\n      forceKeepAttr: undefined,\n    };\n    let l = attributes.length;\n\n    /* Go backwards over all attributes; safely remove bad ones */\n    while (l--) {\n      const attr = attributes[l];\n      const { name, namespaceURI, value: attrValue } = attr;\n      const lcName = transformCaseFunc(name);\n\n      const initValue = attrValue;\n      let value = name === 'value' ? initValue : stringTrim(initValue);\n\n      /* Execute a hook if present */\n      hookEvent.attrName = lcName;\n      hookEvent.attrValue = value;\n      hookEvent.keepAttr = true;\n      hookEvent.forceKeepAttr = undefined; // Allows developers to see this is a property they can set\n      _executeHooks(hooks.uponSanitizeAttribute, currentNode, hookEvent);\n      value = hookEvent.attrValue;\n\n      /* Full DOM Clobbering protection via namespace isolation,\n       * Prefix id and name attributes with `user-content-`\n       */\n      if (SANITIZE_NAMED_PROPS && (lcName === 'id' || lcName === 'name')) {\n        // Remove the attribute with this value\n        _removeAttribute(name, currentNode);\n\n        // Prefix the value and later re-create the attribute with the sanitized value\n        value = SANITIZE_NAMED_PROPS_PREFIX + value;\n      }\n\n      /* Work around a security issue with comments inside attributes */\n      if (\n        SAFE_FOR_XML &&\n        regExpTest(/((--!?|])>)|<\\/(style|title|textarea)/i, value)\n      ) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n\n      /* Make sure we cannot easily use animated hrefs, even if animations are allowed */\n      if (lcName === 'attributename' && stringMatch(value, 'href')) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n\n      /* Did the hooks approve of the attribute? */\n      if (hookEvent.forceKeepAttr) {\n        continue;\n      }\n\n      /* Did the hooks approve of the attribute? */\n      if (!hookEvent.keepAttr) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n\n      /* Work around a security issue in jQuery 3.0 */\n      if (!ALLOW_SELF_CLOSE_IN_ATTR && regExpTest(/\\/>/i, value)) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n\n      /* Sanitize attribute content to be template-safe */\n      if (SAFE_FOR_TEMPLATES) {\n        arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], (expr: RegExp) => {\n          value = stringReplace(value, expr, ' ');\n        });\n      }\n\n      /* Is `value` valid for this attribute? */\n      const lcTag = transformCaseFunc(currentNode.nodeName);\n      if (!_isValidAttribute(lcTag, lcName, value)) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n\n      /* Handle attributes that require Trusted Types */\n      if (\n        trustedTypesPolicy &&\n        typeof trustedTypes === 'object' &&\n        typeof trustedTypes.getAttributeType === 'function'\n      ) {\n        if (namespaceURI) {\n          /* Namespaces are not yet supported, see https://bugs.chromium.org/p/chromium/issues/detail?id=1305293 */\n        } else {\n          switch (trustedTypes.getAttributeType(lcTag, lcName)) {\n            case 'TrustedHTML': {\n              value = trustedTypesPolicy.createHTML(value);\n              break;\n            }\n\n            case 'TrustedScriptURL': {\n              value = trustedTypesPolicy.createScriptURL(value);\n              break;\n            }\n\n            default: {\n              break;\n            }\n          }\n        }\n      }\n\n      /* Handle invalid data-* attribute set by try-catching it */\n      if (value !== initValue) {\n        try {\n          if (namespaceURI) {\n            currentNode.setAttributeNS(namespaceURI, name, value);\n          } else {\n            /* Fallback to setAttribute() for browser-unrecognized namespaces e.g. \"x-schema\". */\n            currentNode.setAttribute(name, value);\n          }\n\n          if (_isClobbered(currentNode)) {\n            _forceRemove(currentNode);\n          } else {\n            arrayPop(DOMPurify.removed);\n          }\n        } catch (_) {\n          _removeAttribute(name, currentNode);\n        }\n      }\n    }\n\n    /* Execute a hook if present */\n    _executeHooks(hooks.afterSanitizeAttributes, currentNode, null);\n  };\n\n  /**\n   * _sanitizeShadowDOM\n   *\n   * @param fragment to iterate over recursively\n   */\n  const _sanitizeShadowDOM = function (fragment: DocumentFragment): void {\n    let shadowNode = null;\n    const shadowIterator = _createNodeIterator(fragment);\n\n    /* Execute a hook if present */\n    _executeHooks(hooks.beforeSanitizeShadowDOM, fragment, null);\n\n    while ((shadowNode = shadowIterator.nextNode())) {\n      /* Execute a hook if present */\n      _executeHooks(hooks.uponSanitizeShadowNode, shadowNode, null);\n\n      /* Sanitize tags and elements */\n      _sanitizeElements(shadowNode);\n\n      /* Check attributes next */\n      _sanitizeAttributes(shadowNode);\n\n      /* Deep shadow DOM detected */\n      if (shadowNode.content instanceof DocumentFragment) {\n        _sanitizeShadowDOM(shadowNode.content);\n      }\n    }\n\n    /* Execute a hook if present */\n    _executeHooks(hooks.afterSanitizeShadowDOM, fragment, null);\n  };\n\n  // eslint-disable-next-line complexity\n  DOMPurify.sanitize = function (dirty, cfg = {}) {\n    let body = null;\n    let importedNode = null;\n    let currentNode = null;\n    let returnNode = null;\n    /* Make sure we have a string to sanitize.\n      DO NOT return early, as this will return the wrong type if\n      the user has requested a DOM object rather than a string */\n    IS_EMPTY_INPUT = !dirty;\n    if (IS_EMPTY_INPUT) {\n      dirty = '<!-->';\n    }\n\n    /* Stringify, in case dirty is an object */\n    if (typeof dirty !== 'string' && !_isNode(dirty)) {\n      if (typeof dirty.toString === 'function') {\n        dirty = dirty.toString();\n        if (typeof dirty !== 'string') {\n          throw typeErrorCreate('dirty is not a string, aborting');\n        }\n      } else {\n        throw typeErrorCreate('toString is not a function');\n      }\n    }\n\n    /* Return dirty HTML if DOMPurify cannot run */\n    if (!DOMPurify.isSupported) {\n      return dirty;\n    }\n\n    /* Assign config vars */\n    if (!SET_CONFIG) {\n      _parseConfig(cfg);\n    }\n\n    /* Clean up removed elements */\n    DOMPurify.removed = [];\n\n    /* Check if dirty is correctly typed for IN_PLACE */\n    if (typeof dirty === 'string') {\n      IN_PLACE = false;\n    }\n\n    if (IN_PLACE) {\n      /* Do some early pre-sanitization to avoid unsafe root nodes */\n      if ((dirty as Node).nodeName) {\n        const tagName = transformCaseFunc((dirty as Node).nodeName);\n        if (!ALLOWED_TAGS[tagName] || FORBID_TAGS[tagName]) {\n          throw typeErrorCreate(\n            'root node is forbidden and cannot be sanitized in-place'\n          );\n        }\n      }\n    } else if (dirty instanceof Node) {\n      /* If dirty is a DOM element, append to an empty document to avoid\n         elements being stripped by the parser */\n      body = _initDocument('<!---->');\n      importedNode = body.ownerDocument.importNode(dirty, true);\n      if (\n        importedNode.nodeType === NODE_TYPE.element &&\n        importedNode.nodeName === 'BODY'\n      ) {\n        /* Node is already a body, use as is */\n        body = importedNode;\n      } else if (importedNode.nodeName === 'HTML') {\n        body = importedNode;\n      } else {\n        // eslint-disable-next-line unicorn/prefer-dom-node-append\n        body.appendChild(importedNode);\n      }\n    } else {\n      /* Exit directly if we have nothing to do */\n      if (\n        !RETURN_DOM &&\n        !SAFE_FOR_TEMPLATES &&\n        !WHOLE_DOCUMENT &&\n        // eslint-disable-next-line unicorn/prefer-includes\n        dirty.indexOf('<') === -1\n      ) {\n        return trustedTypesPolicy && RETURN_TRUSTED_TYPE\n          ? trustedTypesPolicy.createHTML(dirty)\n          : dirty;\n      }\n\n      /* Initialize the document to work on */\n      body = _initDocument(dirty);\n\n      /* Check we have a DOM node from the data */\n      if (!body) {\n        return RETURN_DOM ? null : RETURN_TRUSTED_TYPE ? emptyHTML : '';\n      }\n    }\n\n    /* Remove first element node (ours) if FORCE_BODY is set */\n    if (body && FORCE_BODY) {\n      _forceRemove(body.firstChild);\n    }\n\n    /* Get node iterator */\n    const nodeIterator = _createNodeIterator(IN_PLACE ? dirty : body);\n\n    /* Now start iterating over the created document */\n    while ((currentNode = nodeIterator.nextNode())) {\n      /* Sanitize tags and elements */\n      _sanitizeElements(currentNode);\n\n      /* Check attributes next */\n      _sanitizeAttributes(currentNode);\n\n      /* Shadow DOM detected, sanitize it */\n      if (currentNode.content instanceof DocumentFragment) {\n        _sanitizeShadowDOM(currentNode.content);\n      }\n    }\n\n    /* If we sanitized `dirty` in-place, return it. */\n    if (IN_PLACE) {\n      return dirty;\n    }\n\n    /* Return sanitized string or DOM */\n    if (RETURN_DOM) {\n      if (RETURN_DOM_FRAGMENT) {\n        returnNode = createDocumentFragment.call(body.ownerDocument);\n\n        while (body.firstChild) {\n          // eslint-disable-next-line unicorn/prefer-dom-node-append\n          returnNode.appendChild(body.firstChild);\n        }\n      } else {\n        returnNode = body;\n      }\n\n      if (ALLOWED_ATTR.shadowroot || ALLOWED_ATTR.shadowrootmode) {\n        /*\n          AdoptNode() is not used because internal state is not reset\n          (e.g. the past names map of a HTMLFormElement), this is safe\n          in theory but we would rather not risk another attack vector.\n          The state that is cloned by importNode() is explicitly defined\n          by the specs.\n        */\n        returnNode = importNode.call(originalDocument, returnNode, true);\n      }\n\n      return returnNode;\n    }\n\n    let serializedHTML = WHOLE_DOCUMENT ? body.outerHTML : body.innerHTML;\n\n    /* Serialize doctype if allowed */\n    if (\n      WHOLE_DOCUMENT &&\n      ALLOWED_TAGS['!doctype'] &&\n      body.ownerDocument &&\n      body.ownerDocument.doctype &&\n      body.ownerDocument.doctype.name &&\n      regExpTest(EXPRESSIONS.DOCTYPE_NAME, body.ownerDocument.doctype.name)\n    ) {\n      serializedHTML =\n        '<!DOCTYPE ' + body.ownerDocument.doctype.name + '>\\n' + serializedHTML;\n    }\n\n    /* Sanitize final string template-safe */\n    if (SAFE_FOR_TEMPLATES) {\n      arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], (expr: RegExp) => {\n        serializedHTML = stringReplace(serializedHTML, expr, ' ');\n      });\n    }\n\n    return trustedTypesPolicy && RETURN_TRUSTED_TYPE\n      ? trustedTypesPolicy.createHTML(serializedHTML)\n      : serializedHTML;\n  };\n\n  DOMPurify.setConfig = function (cfg = {}) {\n    _parseConfig(cfg);\n    SET_CONFIG = true;\n  };\n\n  DOMPurify.clearConfig = function () {\n    CONFIG = null;\n    SET_CONFIG = false;\n  };\n\n  DOMPurify.isValidAttribute = function (tag, attr, value) {\n    /* Initialize shared config vars if necessary. */\n    if (!CONFIG) {\n      _parseConfig({});\n    }\n\n    const lcTag = transformCaseFunc(tag);\n    const lcName = transformCaseFunc(attr);\n    return _isValidAttribute(lcTag, lcName, value);\n  };\n\n  DOMPurify.addHook = function (\n    entryPoint: keyof HooksMap,\n    hookFunction: HookFunction\n  ) {\n    if (typeof hookFunction !== 'function') {\n      return;\n    }\n\n    arrayPush(hooks[entryPoint], hookFunction);\n  };\n\n  DOMPurify.removeHook = function (\n    entryPoint: keyof HooksMap,\n    hookFunction: HookFunction\n  ) {\n    if (hookFunction !== undefined) {\n      const index = arrayLastIndexOf(hooks[entryPoint], hookFunction);\n\n      return index === -1\n        ? undefined\n        : arraySplice(hooks[entryPoint], index, 1)[0];\n    }\n\n    return arrayPop(hooks[entryPoint]);\n  };\n\n  DOMPurify.removeHooks = function (entryPoint: keyof HooksMap) {\n    hooks[entryPoint] = [];\n  };\n\n  DOMPurify.removeAllHooks = function () {\n    hooks = _createHooksMap();\n  };\n\n  return DOMPurify;\n}\n\nexport default createDOMPurify();\n\nexport interface DOMPurify {\n  /**\n   * Creates a DOMPurify instance using the given window-like object. Defaults to `window`.\n   */\n  (root?: WindowLike): DOMPurify;\n\n  /**\n   * Version label, exposed for easier checks\n   * if DOMPurify is up to date or not\n   */\n  version: string;\n\n  /**\n   * Array of elements that DOMPurify removed during sanitation.\n   * Empty if nothing was removed.\n   */\n  removed: Array<RemovedElement | RemovedAttribute>;\n\n  /**\n   * Expose whether this browser supports running the full DOMPurify.\n   */\n  isSupported: boolean;\n\n  /**\n   * Set the configuration once.\n   *\n   * @param cfg configuration object\n   */\n  setConfig(cfg?: Config): void;\n\n  /**\n   * Removes the configuration.\n   */\n  clearConfig(): void;\n\n  /**\n   * Provides core sanitation functionality.\n   *\n   * @param dirty string or DOM node\n   * @param cfg object\n   * @returns Sanitized TrustedHTML.\n   */\n  sanitize(\n    dirty: string | Node,\n    cfg: Config & { RETURN_TRUSTED_TYPE: true }\n  ): TrustedHTML;\n\n  /**\n   * Provides core sanitation functionality.\n   *\n   * @param dirty DOM node\n   * @param cfg object\n   * @returns Sanitized DOM node.\n   */\n  sanitize(dirty: Node, cfg: Config & { IN_PLACE: true }): Node;\n\n  /**\n   * Provides core sanitation functionality.\n   *\n   * @param dirty string or DOM node\n   * @param cfg object\n   * @returns Sanitized DOM node.\n   */\n  sanitize(dirty: string | Node, cfg: Config & { RETURN_DOM: true }): Node;\n\n  /**\n   * Provides core sanitation functionality.\n   *\n   * @param dirty string or DOM node\n   * @param cfg object\n   * @returns Sanitized document fragment.\n   */\n  sanitize(\n    dirty: string | Node,\n    cfg: Config & { RETURN_DOM_FRAGMENT: true }\n  ): DocumentFragment;\n\n  /**\n   * Provides core sanitation functionality.\n   *\n   * @param dirty string or DOM node\n   * @param cfg object\n   * @returns Sanitized string.\n   */\n  sanitize(dirty: string | Node, cfg?: Config): string;\n\n  /**\n   * Checks if an attribute value is valid.\n   * Uses last set config, if any. Otherwise, uses config defaults.\n   *\n   * @param tag Tag name of containing element.\n   * @param attr Attribute name.\n   * @param value Attribute value.\n   * @returns Returns true if `value` is valid. Otherwise, returns false.\n   */\n  isValidAttribute(tag: string, attr: string, value: string): boolean;\n\n  /**\n   * Adds a DOMPurify hook.\n   *\n   * @param entryPoint entry point for the hook to add\n   * @param hookFunction function to execute\n   */\n  addHook(entryPoint: BasicHookName, hookFunction: NodeHook): void;\n\n  /**\n   * Adds a DOMPurify hook.\n   *\n   * @param entryPoint entry point for the hook to add\n   * @param hookFunction function to execute\n   */\n  addHook(entryPoint: ElementHookName, hookFunction: ElementHook): void;\n\n  /**\n   * Adds a DOMPurify hook.\n   *\n   * @param entryPoint entry point for the hook to add\n   * @param hookFunction function to execute\n   */\n  addHook(\n    entryPoint: DocumentFragmentHookName,\n    hookFunction: DocumentFragmentHook\n  ): void;\n\n  /**\n   * Adds a DOMPurify hook.\n   *\n   * @param entryPoint entry point for the hook to add\n   * @param hookFunction function to execute\n   */\n  addHook(\n    entryPoint: 'uponSanitizeElement',\n    hookFunction: UponSanitizeElementHook\n  ): void;\n\n  /**\n   * Adds a DOMPurify hook.\n   *\n   * @param entryPoint entry point for the hook to add\n   * @param hookFunction function to execute\n   */\n  addHook(\n    entryPoint: 'uponSanitizeAttribute',\n    hookFunction: UponSanitizeAttributeHook\n  ): void;\n\n  /**\n   * Remove a DOMPurify hook at a given entryPoint\n   * (pops it from the stack of hooks if hook not specified)\n   *\n   * @param entryPoint entry point for the hook to remove\n   * @param hookFunction optional specific hook to remove\n   * @returns removed hook\n   */\n  removeHook(\n    entryPoint: BasicHookName,\n    hookFunction?: NodeHook\n  ): NodeHook | undefined;\n\n  /**\n   * Remove a DOMPurify hook at a given entryPoint\n   * (pops it from the stack of hooks if hook not specified)\n   *\n   * @param entryPoint entry point for the hook to remove\n   * @param hookFunction optional specific hook to remove\n   * @returns removed hook\n   */\n  removeHook(\n    entryPoint: ElementHookName,\n    hookFunction?: ElementHook\n  ): ElementHook | undefined;\n\n  /**\n   * Remove a DOMPurify hook at a given entryPoint\n   * (pops it from the stack of hooks if hook not specified)\n   *\n   * @param entryPoint entry point for the hook to remove\n   * @param hookFunction optional specific hook to remove\n   * @returns removed hook\n   */\n  removeHook(\n    entryPoint: DocumentFragmentHookName,\n    hookFunction?: DocumentFragmentHook\n  ): DocumentFragmentHook | undefined;\n\n  /**\n   * Remove a DOMPurify hook at a given entryPoint\n   * (pops it from the stack of hooks if hook not specified)\n   *\n   * @param entryPoint entry point for the hook to remove\n   * @param hookFunction optional specific hook to remove\n   * @returns removed hook\n   */\n  removeHook(\n    entryPoint: 'uponSanitizeElement',\n    hookFunction?: UponSanitizeElementHook\n  ): UponSanitizeElementHook | undefined;\n\n  /**\n   * Remove a DOMPurify hook at a given entryPoint\n   * (pops it from the stack of hooks if hook not specified)\n   *\n   * @param entryPoint entry point for the hook to remove\n   * @param hookFunction optional specific hook to remove\n   * @returns removed hook\n   */\n  removeHook(\n    entryPoint: 'uponSanitizeAttribute',\n    hookFunction?: UponSanitizeAttributeHook\n  ): UponSanitizeAttributeHook | undefined;\n\n  /**\n   * Removes all DOMPurify hooks at a given entryPoint\n   *\n   * @param entryPoint entry point for the hooks to remove\n   */\n  removeHooks(entryPoint: HookName): void;\n\n  /**\n   * Removes all DOMPurify hooks.\n   */\n  removeAllHooks(): void;\n}\n\n/**\n * An element removed by DOMPurify.\n */\nexport interface RemovedElement {\n  /**\n   * The element that was removed.\n   */\n  element: Node;\n}\n\n/**\n * An element removed by DOMPurify.\n */\nexport interface RemovedAttribute {\n  /**\n   * The attribute that was removed.\n   */\n  attribute: Attr | null;\n\n  /**\n   * The element that the attribute was removed.\n   */\n  from: Node;\n}\n\ntype BasicHookName =\n  | 'beforeSanitizeElements'\n  | 'afterSanitizeElements'\n  | 'uponSanitizeShadowNode';\ntype ElementHookName = 'beforeSanitizeAttributes' | 'afterSanitizeAttributes';\ntype DocumentFragmentHookName =\n  | 'beforeSanitizeShadowDOM'\n  | 'afterSanitizeShadowDOM';\ntype UponSanitizeElementHookName = 'uponSanitizeElement';\ntype UponSanitizeAttributeHookName = 'uponSanitizeAttribute';\n\ninterface HooksMap {\n  beforeSanitizeElements: NodeHook[];\n  afterSanitizeElements: NodeHook[];\n  beforeSanitizeShadowDOM: DocumentFragmentHook[];\n  uponSanitizeShadowNode: NodeHook[];\n  afterSanitizeShadowDOM: DocumentFragmentHook[];\n  beforeSanitizeAttributes: ElementHook[];\n  afterSanitizeAttributes: ElementHook[];\n  uponSanitizeElement: UponSanitizeElementHook[];\n  uponSanitizeAttribute: UponSanitizeAttributeHook[];\n}\n\ntype ArrayElement<T> = T extends Array<infer U> ? U : never;\n\ntype HookFunction = ArrayElement<HooksMap[keyof HooksMap]>;\n\nexport type HookName =\n  | BasicHookName\n  | ElementHookName\n  | DocumentFragmentHookName\n  | UponSanitizeElementHookName\n  | UponSanitizeAttributeHookName;\n\nexport type NodeHook = (\n  this: DOMPurify,\n  currentNode: Node,\n  hookEvent: null,\n  config: Config\n) => void;\n\nexport type ElementHook = (\n  this: DOMPurify,\n  currentNode: Element,\n  hookEvent: null,\n  config: Config\n) => void;\n\nexport type DocumentFragmentHook = (\n  this: DOMPurify,\n  currentNode: DocumentFragment,\n  hookEvent: null,\n  config: Config\n) => void;\n\nexport type UponSanitizeElementHook = (\n  this: DOMPurify,\n  currentNode: Node,\n  hookEvent: UponSanitizeElementHookEvent,\n  config: Config\n) => void;\n\nexport type UponSanitizeAttributeHook = (\n  this: DOMPurify,\n  currentNode: Element,\n  hookEvent: UponSanitizeAttributeHookEvent,\n  config: Config\n) => void;\n\nexport interface UponSanitizeElementHookEvent {\n  tagName: string;\n  allowedTags: Record<string, boolean>;\n}\n\nexport interface UponSanitizeAttributeHookEvent {\n  attrName: string;\n  attrValue: string;\n  keepAttr: boolean;\n  allowedAttributes: Record<string, boolean>;\n  forceKeepAttr: boolean | undefined;\n}\n\n/**\n * A `Window`-like object containing the properties and types that DOMPurify requires.\n */\nexport type WindowLike = Pick<\n  typeof globalThis,\n  | 'DocumentFragment'\n  | 'HTMLTemplateElement'\n  | 'Node'\n  | 'Element'\n  | 'NodeFilter'\n  | 'NamedNodeMap'\n  | 'HTMLFormElement'\n  | 'DOMParser'\n> & {\n  document?: Document;\n  MozNamedAttrMap?: typeof window.NamedNodeMap;\n} & Pick<TrustedTypesWindow, 'trustedTypes'>;\n", "import { marked } from \"marked\";\nimport * as dompurify from \"dompurify\";\n\nimport type { Result } from \"./types\";\n\nexport function nothrow<T>(cb: () => T): Result<T, any> {\n\ttry {\n\t\treturn { success: true, value: cb() };\n\t} catch (error: any) {\n\t\treturn { success: false, error };\n\t}\n}\n\nexport function nothrowAsync<T>(cb: Promise<T>): Promise<Result<T, any>> {\n\treturn new Promise(resolve => {\n\t\tcb\n\t\t\t.then(value => resolve({ success: true, value }))\n\t\t\t.catch(error => resolve({ success: false, error }))\n\t});\n}\n\nexport function sleep(ms: number) {\n\treturn new Promise(resolve => setTimeout(resolve, ms));\n}\n\nexport function revolvers<T = void>() {\n\tlet _resolve: any;\n\tconst promise = new Promise<T>(resolve => _resolve = resolve);\n\treturn { promise, resolve: _resolve as ((v: T) => void) };\n}\n\nexport function makeResizable(textarea: HTMLTextAreaElement, initialHeight: number = 52) {\n\tconst update = () => {\n\t\ttextarea.style.height = \"auto\";\n\t\ttextarea.style.height = `${Math.max(initialHeight, textarea.scrollHeight + 7)}px`;\n\t};\n\ttextarea.addEventListener(\"input\", update);\n\tupdate();\n}\n\nexport function getRoute() {\n\treturn window.location.hash.slice(1).split(\".\");\n}\n\nexport function renderMD(content: string) {\n\treturn dompurify.default.sanitize(marked.parse(content, { async: false }));\n}\nexport async function renderMDAsync(content: string) {\n\treturn dompurify.default.sanitize(await marked.parse(content));\n}\n\nconst PLACHEOLDER = \"assets/gfx/placeholder.png\";\nexport function placeholder(url: string | null) {\n\treturn url || PLACHEOLDER;\n}\n", "import { Chat, ChatContents, Persona, Result, ScenarioCard } from \"./types\";\r\nimport { revolvers } from \"./utils\";\r\n\r\ntype IDBStorageSchema = {\r\n\tmedia: {\r\n\t\tid: string,\r\n\t\tmedia: Blob,\r\n\t\tmime: string\r\n\t},\r\n\tpersonas: Persona,\r\n\tchats: Chat,\r\n\tchatContents: ChatContents,\r\n\tscenarios: ScenarioCard\r\n};\r\nconst IDB_INDESEX = {\r\n\tpersonas:  \"lastUpdate\",\r\n\tchats:     \"lastUpdate\",\r\n\tscenarios: \"lastUpdate\"\r\n} satisfies {\r\n\t[T in keyof IDBStorageSchema]?: keyof IDBStorageSchema[T]\r\n};\r\nconst INDEX_SORTED = \"sorted\";\r\nexport type IDBStore = keyof IDBStorageSchema;\r\nexport type LocalKey = \"theme\" | \"engines\" | \"rember\" | \"activeEngine\";\r\n\r\ntype StorageUpdate = {\r\n\tstorage: \"idb\",\r\n\tstore: IDBStore;\r\n} | {\r\n\tstorage: \"local\",\r\n\tkey: LocalKey\r\n};\r\ntype StorageListener = (event: StorageUpdate) => void;\r\n\r\nconst storageListeners: StorageListener[] = [];\r\nconst bc = new BroadcastChannel(\"storage-updates\");\r\nbc.onmessage = ({ data }) => {\r\n\tstorageListeners.forEach(l => l(data));\r\n};\r\nconst { promise: dbInitPromise, resolve: dbInitComplete } = revolvers<IDBDatabase>();\r\n\r\nexport function listen(listener: StorageListener) {\r\n\tstorageListeners.push(listener);\r\n}\r\n\r\nexport async function init() {\r\n\tconst result = await open();\r\n\tif (result.success) dbInitComplete(result.value);\r\n\telse console.error(result.error);\r\n\treturn result.success;\r\n}\r\n\r\nexport const idb = { get, set, getAll, del };\r\nexport const local = { get: localGet, set: localSet };\r\n\r\nasync function get<T extends IDBStore>(store: T, key: IDBStorageSchema[T][\"id\"]): Promise<Result<IDBStorageSchema[T], any>> {\r\n\tconst db = await dbInitPromise;\r\n\r\n\tconst r = db\r\n\t\t.transaction(store, \"readonly\")\r\n\t\t.objectStore(store)\r\n\t\t.get(key);\r\n\r\n\treturn await new Promise(resolve => {\r\n\t\tr.onsuccess = () => resolve({ success: true, value: r.result });\r\n\t\tr.onerror = () => resolve({ success: false, error: \"read error\" });\r\n\t});\r\n}\r\n\r\nasync function getAll<T extends IDBStore>(store: T): Promise<Result<IDBStorageSchema[T][], any>> {\r\n\tconst db = await dbInitPromise;\r\n\r\n\tconst r = (store in IDB_INDESEX)\r\n\t\t? db\r\n\t\t\t.transaction(store, \"readonly\")\r\n\t\t\t.objectStore(store)\r\n\t\t\t.index(\"sorted\")\r\n\t\t\t.getAll()\r\n\t\t: db\r\n\t\t\t.transaction(store, \"readonly\")\r\n\t\t\t.objectStore(store)\r\n\t\t\t.getAll();\r\n\r\n\treturn await new Promise(resolve => {\r\n\t\tr.onsuccess = () => resolve({ success: true, value: r.result });\r\n\t\tr.onerror = () => resolve({ success: false, error: \"read error\" });\r\n\t});\r\n}\r\n\r\nasync function set<T extends IDBStore>(store: T, value: IDBStorageSchema[T]) {\r\n\tconst db = await dbInitPromise;\r\n\r\n\tconst r = db\r\n\t\t.transaction(store, \"readwrite\")\r\n\t\t.objectStore(store)\r\n\t\t.put(value);\r\n\r\n\treturn await new Promise(resolve => {\r\n\t\tr.onsuccess = () => {\r\n\t\t\tresolve({ success: true, value: r.result });\r\n\t\t\tconst update: StorageUpdate = { storage: \"idb\", store: store };\r\n\t\t\tbc.postMessage(update);\r\n\t\t\tstorageListeners.forEach(l => l(update));\r\n\t\t};\r\n\t\tr.onerror = () => resolve({ success: false, error: \"write error\" });\r\n\t});\r\n}\r\n\r\nasync function del<T extends IDBStore>(store: T, id: string) {\r\n\tconst db = await dbInitPromise;\r\n\r\n\tconst r = db\r\n\t\t.transaction(store, \"readwrite\")\r\n\t\t.objectStore(store)\r\n\t\t.delete(id);\r\n\r\n\treturn await new Promise(resolve => {\r\n\t\tr.onsuccess = () => {\r\n\t\t\tresolve({ success: true, value: r.result });\r\n\t\t\tconst update: StorageUpdate = { storage: \"idb\", store: store };\r\n\t\t\tbc.postMessage(update);\r\n\t\t\tstorageListeners.forEach(l => l(update));\r\n\t\t};\r\n\t\tr.onerror = () => resolve({ success: false, error: \"write error\" });\r\n\t});\r\n}\r\n\r\nfunction open() {\r\n\treturn new Promise<Result<IDBDatabase, any>>(resolve => {\r\n\t\tconst r = window.indexedDB.open(\"ehh\", 1);\r\n\t\tr.onsuccess = () => resolve({ success: true,  value: r.result });\r\n\t\tr.onerror =   () => resolve({ success: false, error: r.error });\r\n\t\tr.onupgradeneeded = () => {\r\n\t\t\tconst db = r.result;\r\n\r\n\t\t\t                  db.createObjectStore(\"media\",        { keyPath: \"id\" });\r\n\t\t\tconst personas =  db.createObjectStore(\"personas\",     { keyPath: \"id\" });\r\n\t\t\tconst chats =     db.createObjectStore(\"chats\",        { keyPath: \"id\" });\r\n\t\t\t                  db.createObjectStore(\"chatContents\", { keyPath: \"id\" });\r\n\t\t\tconst scenarios = db.createObjectStore(\"scenarios\",    { keyPath: \"id\" });\r\n\t\t\t\r\n\t\t\t personas.createIndex(INDEX_SORTED, IDB_INDESEX.personas);\r\n\t\t\t    chats.createIndex(INDEX_SORTED, IDB_INDESEX.chats);\r\n\t\t\tscenarios.createIndex(INDEX_SORTED, IDB_INDESEX.scenarios);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction localGet(key: LocalKey) {\r\n\treturn window.localStorage.getItem(key)\r\n}\r\nfunction localSet(key: LocalKey, value: string) {\r\n\twindow.localStorage.setItem(key, value);\r\n\tconst update: StorageUpdate = { storage: \"local\", key };\r\n\tbc.postMessage(update);\r\n\tstorageListeners.forEach(l => l(update));\r\n}\r\n\r\nexport async function upload(blob: Blob) {\r\n\tconst id = crypto.randomUUID();\r\n\tawait set(\"media\", {\r\n\t\tid,\r\n\t\tmedia: blob,\r\n\t\tmime: blob.type\r\n\t});\r\n\treturn id;\r\n}\r\nconst map = new Map<string, string>();\r\nexport async function getBlobLink(imageRef: string) {\r\n\tif (map.has(imageRef)) {\r\n\t\treturn map.get(imageRef)!;\r\n\t}\r\n\tconst blob = await get(\"media\", imageRef);\r\n\tif (!blob.success || !blob.value) return null;\r\n\r\n\tconst link = URL.createObjectURL(blob.value.media);\r\n\tmap.set(imageRef, link);\r\n\treturn link;\r\n}\r\nexport function revokeBlobLink(imageRef: string) {\r\n\tconst link = map.get(imageRef);\r\n\tmap.delete(imageRef);\r\n\tif (link) URL.revokeObjectURL(link);\r\n}\r\n", "import { getBlobLink, upload } from \"@root/persist\";\r\nimport { placeholder } from \"@root/utils\";\r\nimport { mudcrack } from \"rampike\";\r\n\r\n// value, placeholder, accept\r\nclass _RampikeImagePicker extends HTMLElement {\r\n\tget value(): File | string {\r\n\t\treturn this.file ?? this.getAttribute(\"value\") ?? \"\";\r\n\t}\r\n\tset value(v: string) {\r\n\t\tthis.setAttribute(\"value\", v);\r\n\t\tthis.input.value = \"\";\r\n\t\tif (v) {\r\n\t\t\tgetBlobLink(v).then(src => {\r\n\t\t\t\tif (!src) return;\r\n\t\t\t\tthis.image = src\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\tget input() {\r\n\t\treturn this.querySelector<HTMLInputElement>(`input[type=\"file\"]`)!;\r\n\t}\r\n\tget file() {\r\n\t\treturn this.input.files?.[0];\r\n\t}\r\n\tset image(v: string) {\r\n\t\tconst img = this.querySelector<HTMLImageElement>(`img`)!;\r\n\t\tthis.revokeBlob?.();\r\n\t\timg.src = v;\r\n\t\tthis.onDirty?.();\r\n\t}\r\n\r\n\tusePlaceholder() {\r\n\t\tthis.image = placeholder(this.getAttribute(\"placeholder\"));\r\n\t\tthis.input.value = \"\";\r\n\t\tthis.setAttribute(\"value\", \"\");\r\n\t}\r\n\tpaste(file: File) {\r\n\t\tconst container = new DataTransfer();\r\n\t\tcontainer.items.add(file);\r\n\t\tthis.input.files = container.files;\r\n\t\tthis.setFile(file);\r\n\t}\r\n\tasync valueHandle(): Promise<string | null> {\r\n\t\treturn typeof this.value === \"string\"\r\n\t\t\t? this.value || null\r\n\t\t\t: (await upload(this.value));\r\n\t}\r\n\tonDirty: (() => void) | null = null;\r\n\r\n\tprivate revokeBlob: (() => void) | null = null;\r\n\tprivate setFile(file: File) {\r\n\t\tconst link = URL.createObjectURL(file);\r\n\t\tthis.image = link;\r\n\t\tthis.revokeBlob = () => {\r\n\t\t\tURL.revokeObjectURL(link);\r\n\t\t\tthis.revokeBlob = null;\r\n\t\t}\r\n\t\tthis.setAttribute(\"value\", \"\");\r\n\t\tthis.onDirty?.();\r\n\t}\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tconst image = mudcrack({\r\n\t\t\ttagName: \"img\",\r\n\t\t\tattributes: {\r\n\t\t\t\tsrc: placeholder(this.getAttribute(\"placeholder\"))\r\n\t\t\t}\r\n\t\t});\r\n\t\tconst preview = this.getAttribute(\"value\");\r\n\t\tif (preview) getBlobLink(preview).then(src => {\r\n\t\t\tif (!src) return;\r\n\t\t\timage.src = src;\r\n\t\t})\r\n\t\tconst input = mudcrack({\r\n\t\t\ttagName: \"input\",\r\n\t\t\tattributes: {\r\n\t\t\t\ttype: \"file\",\r\n\t\t\t\taccept: this.getAttribute(\"accept\") ?? \"\",\r\n\t\t\t},\r\n\t\t\tstyle: {\r\n\t\t\t\tdisplay: \"none\"\r\n\t\t\t},\r\n\t\t\tevents: {\r\n\t\t\t\tinput: (_ev, el) => {\r\n\t\t\t\t\tconst file = el.files?.[0];\r\n\t\t\t\t\tif (!file?.type.startsWith(\"image/\")) return;\r\n\r\n\t\t\t\t\tthis.setFile(file);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tconst contents = mudcrack({\r\n\t\t\ttagName: \"label\",\r\n\t\t\tstyle: {\r\n\t\t\t\tdisplay: \"contents\"\r\n\t\t\t},\r\n\t\t\tcontents: [ input, image ]\r\n\t\t});\r\n\t\tthis.append(contents);\r\n\t}\r\n};\r\n\r\nexport function define(tagName: string) {\r\n\twindow.customElements.define(tagName, _RampikeImagePicker);\r\n}\r\n\r\nexport type RampikeImagePicker = _RampikeImagePicker;\r\n", "import { RampikeTabs } from \"@rampike/tabs\";\r\nimport { RampikeUnit } from \"./types\";\r\nimport { getRoute } from \"@root/utils\";\r\n\r\nexport const navigationUnit: RampikeUnit = {\r\n\tinit: () => {\r\n\t\tconst tabs = document.querySelector<RampikeTabs>(\"ram-tabs#tabs-main\")!;\r\n\t\tfunction nav(to: string) {\r\n\t\t\twindow.location.hash = to;\r\n\t\t}\r\n\t\tfunction readHash() {\r\n\t\t\ttabs.tab = getRoute()[0] ?? \"chats\";\r\n\t\t}\r\n\r\n\t\twindow.addEventListener(\"hashchange\", readHash);\r\n\t\treadHash();\r\n\r\n\t\t// const hash = getRoute()[0];\r\n\t\t// if (hash) nav(hash);\r\n\r\n\t\tconst buttons = document.querySelectorAll<HTMLButtonElement>(\"button[data-to]\");\r\n\t\tbuttons.forEach(b => b.addEventListener(\"click\", () => nav(b.dataset.to!)));\r\n\t}\r\n}\r\n", "import { listen, local } from \"@root/persist\";\r\nimport { ActiveEngines, Engine, EngineMap, EngineMapWithActive } from \"@root/types\";\r\nimport { nothrow } from \"@root/utils\";\r\nimport { RampikeUnit } from \"@units/types\";\r\nimport { mudcrack } from \"rampike\";\r\n\r\nexport const enginesUnit: RampikeUnit = {\r\n\tinit: () => {\r\n\t\tconst inputs = {\r\n\t\t\tname:  document.querySelector<HTMLInputElement>(\"#settings-engines-name\")!,\r\n\t\t\turl:   document.querySelector<HTMLInputElement>(\"#settings-engines-url\")!,\r\n\t\t\tkey:   document.querySelector<HTMLInputElement>(\"#settings-engines-key\")!,\r\n\t\t\tmodel: document.querySelector<HTMLInputElement>(\"#settings-engines-model\")!,\r\n\t\t\ttemp:   document.querySelector<HTMLInputElement>(\"#settings-engines-temp\")!,\r\n\t\t\tmax:    document.querySelector<HTMLInputElement>(\"#settings-engines-max\")!,\r\n\t\t\tparams: document.querySelector<HTMLInputElement>(\"#settings-engines-additional\")!\r\n\t\t};\r\n\t\tconst defaults = {\r\n\t\t\ttemp:    .9,\r\n\t\t\tmax:     720\r\n\t\t};\r\n\t\tconst submitButton = document.querySelector<HTMLButtonElement>(\"#settings-engines-submit\")!;\r\n\t\tconst list = document.querySelector<HTMLElement>(\"#settings-engines-list\")!;\r\n\t\tlet editing: string | null = null;\r\n\r\n\t\tsubmitButton.addEventListener(\"click\", submit);\r\n\r\n\t\tlisten(update => {\r\n\t\t\tif (update.storage !== \"local\") return;\r\n\t\t\tif (update.key !== \"engines\") return;\r\n\r\n\t\t\tupdateList();\r\n\t\t});\r\n\t\tupdateList();\r\n\r\n\t\tfunction submit() {\r\n\t\t\tconst id = editing ?? crypto.randomUUID();\r\n\t\t\tfunction parseNumber(key: keyof typeof defaults) {\r\n\t\t\t\tconst f = parseFloat(inputs[key].value);\r\n\t\t\t\tif (isNaN(f) || f < 0) return defaults[key];\r\n\t\t\t\treturn f;\r\n\t\t\t}\r\n\t\t\tfunction parseParams(raw: string) {\r\n\t\t\t\tconst result = nothrow(() => JSON.parse(raw));\r\n\t\t\t\tconst value = result.success ? result.value : {};\r\n\t\t\t\tif (typeof value !== \"object\") return {};\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t\tconst e: Engine = {\r\n\t\t\t\tname:  inputs.name.value,\r\n\t\t\t\turl:   inputs.url.value,\r\n\t\t\t\tkey:   inputs.key.value,\r\n\t\t\t\tmodel: inputs.model.value,\r\n\t\t\t\ttemp:    parseNumber(\"temp\"),\r\n\t\t\t\tmax:     parseNumber(\"max\"),\r\n\t\t\t\tparams:  parseParams(inputs.params.value)\r\n\t\t\t};\r\n\t\t\tconst missing = ([\"name\", \"url\", \"model\"] as const).some(k => !e[k]);\r\n\t\t\tif (missing) return;\r\n\r\n\t\t\tconst eMap = readEngines();\r\n\t\t\t// @ts-expect-error isActive missing\r\n\t\t\teMap[id] = e;\r\n\t\t\tsaveEngines(eMap);\r\n\t\t\tediting = null;\r\n\t\t\tinputs.name.value =  \"\";\r\n\t\t\tinputs.url.value =   \"\";\r\n\t\t\tinputs.key.value =   \"\";\r\n\t\t\tinputs.model.value = \"\";\r\n\t\t\tinputs.temp.value =   String(defaults.temp);\r\n\t\t\tinputs.max.value =    String(defaults.max);\r\n\t\t\tinputs.params.value = \"\";\r\n\t\t}\r\n\t\tfunction edit(id: string, e: Engine) {\r\n\t\t\tfunction stringifyParams() {\r\n\t\t\t\tif (!e.params) return \"\";\r\n\t\t\t\tif (Object.keys(e.params).length === 0) return \"\";\r\n\r\n\t\t\t\treturn JSON.stringify(e.params);\r\n\t\t\t}\r\n\t\t\tediting = id;\r\n\t\t\tinputs.name.value =  e.name;\r\n\t\t\tinputs.url.value =   e.url;\r\n\t\t\tinputs.key.value =   e.key;\r\n\t\t\tinputs.model.value = e.model;\r\n\t\t\tinputs.temp.value =   String(e.temp);\r\n\t\t\tinputs.max.value =    String(e.max);\r\n\t\t\tinputs.params.value = stringifyParams();\r\n\r\n\t\t\tinputs.name.scrollIntoView({ behavior: \"smooth\" });\r\n\t\t}\r\n\r\n\t\tfunction updateList() {\r\n\t\t\tlist.innerHTML = \"\";\r\n\t\t\tconst enginesMap = readEngines();\r\n\t\t\tconst engines = Object.entries(enginesMap);\r\n\t\t\tconst items = engines.map(([id, e]) => \r\n\t\t\t\tmudcrack({\r\n\t\t\t\t\tclassName: \"lineout row settings-engine-item\",\r\n\t\t\t\t\tcontents: [\r\n\t\t\t\t\t\tmudcrack({\r\n\t\t\t\t\t\t\tcontents: e.name\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t\tmudcrack({\r\n\t\t\t\t\t\t\ttagName: \"button\",\r\n\t\t\t\t\t\t\tclassName: \"lineout\",\r\n\t\t\t\t\t\t\tevents: {\r\n\t\t\t\t\t\t\t\tclick: () => deleteEngine(id)\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcontents: \"delete\"\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t],\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\tclick: () => edit(id, e)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t\tif (items.length > 0)\r\n\t\t\t\tlist.append(...items);\r\n\t\t\telse\r\n\t\t\t\tlist.append(mudcrack({\r\n\t\t\t\t\tclassName: \"placeholder\",\r\n\t\t\t\t\tcontents: \"No engines found\"\r\n\t\t\t\t}));\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function readEngines(): EngineMapWithActive {\r\n\tconst enginesRaw = local.get(\"engines\");\r\n\tif (!enginesRaw) return {};\r\n\tconst engines = nothrow<EngineMapWithActive>(() => JSON.parse(enginesRaw));\r\n\tif (!engines.success) return {};\r\n\r\n\tconst activeEngines = readActiveEngines();\r\n\tfor (const e in engines.value) {\r\n\t\tengines.value[e].isActive = e === activeEngines.main;\r\n\t}\r\n\r\n\treturn engines.value;\r\n}\r\nfunction saveEngines(eMap: EngineMap) {\r\n\tlocal.set(\"engines\", JSON.stringify(eMap));\r\n\r\n}\r\nfunction deleteEngine(id: string) {\r\n\tif (!confirm(\"confirm deletion\")) return;\r\n\tconst e = readEngines();\r\n\tdelete e[id];\r\n\tsaveEngines(e);\r\n}\r\n\r\nexport function readActiveEngines(): ActiveEngines {\r\n\tconst defaultEngines = {\r\n\t\tmain: null,\r\n\t\trember: null\r\n\t}\r\n\tconst activeRaw = local.get(\"activeEngine\");\r\n\tif (!activeRaw) return defaultEngines;\r\n\tconst parsed = nothrow<ActiveEngines>(() => JSON.parse(activeRaw));\r\n\tif (!parsed.success) return defaultEngines;\r\n\r\n\treturn parsed.value;\r\n}\r\n", "import { RampikeUnit } from \"@units/types\";\r\nimport { getBlobLink, idb, listen, upload } from \"@root/persist\";\r\nimport { mudcrack } from \"rampike\";\r\nimport { Persona, Pronouns } from \"@root/types\";\r\nimport type { RampikeImagePicker } from \"@rampike/imagepicker\";\r\nimport { placeholder } from \"@root/utils\";\r\n\r\nconst PRONOUNS_HE: Pronouns = {\r\n\tsubjective: \"he\",\r\n\tobjective: \"him\",\r\n\tpossessiveAdj: \"his\",\r\n\tpossessivePro: \"his\",\r\n\treflexive: \"himself\"\r\n};\r\nconst PRONOUNS_SHE: Pronouns = {\r\n\tsubjective: \"she\",\r\n\tobjective: \"her\",\r\n\tpossessiveAdj: \"her\",\r\n\tpossessivePro: \"hers\",\r\n\treflexive: \"herself\"\r\n};\r\nexport const PRONOUNS_THEY: Pronouns = {\r\n\tsubjective: \"they\",\r\n\tobjective: \"them\",\r\n\tpossessiveAdj: \"their\",\r\n\tpossessivePro: \"theirs\",\r\n\treflexive: \"themselves\"\r\n};\r\n\r\nexport const personaUnit: RampikeUnit = {\r\n\tinit: () => {\r\n\t\tconst filePicker = document.querySelector<RampikeImagePicker>(\"#settings-persona-picture\")!;\r\n\t\tconst clearButton = document.querySelector<HTMLButtonElement>(\"#settings-persona-picture-clear\")!;\r\n\t\tconst nameInput = document.querySelector<HTMLInputElement>(\"#settings-persona-name\")!;\r\n\t\tconst descInput = document.querySelector<HTMLTextAreaElement>(\"#settings-persona-desc\")!;\r\n\t\tconst personaList = document.querySelector<HTMLElement>(\"#settings-persona-list\")!;\r\n\t\tconst submitButton = document.querySelector<HTMLButtonElement>(\"#settings-add-persona\")!;\r\n\t\tconst form = document.querySelector<HTMLElement>(\"#settings-persona-form\")!;\r\n\t\tlet editingPersona: Persona | null = null;\r\n\r\n\t\tfunction clear() {\r\n\t\t\tfilePicker.usePlaceholder();\r\n\t\t\tclearButton.hidden = true;\r\n\t\t}\r\n\t\tclearButton.addEventListener(\"click\", () => {\r\n\t\t\tclear();\r\n\t\t});\r\n\t\tfilePicker.onDirty = () => {\r\n\t\t\tclearButton.hidden = filePicker.value === \"\";\r\n\t\t};\r\n\t\tsubmitButton.addEventListener(\"click\", async () => {\r\n\t\t\tconst name = nameInput.value;\r\n\t\t\tconst desc = descInput.value;\r\n\t\t\tif (!name || !desc) return;\r\n\r\n\t\t\tconst file = filePicker.value;\r\n\t\t\t\r\n\t\t\tconst picture = typeof file === \"string\"\r\n\t\t\t\t? file || null\r\n\t\t\t\t: (await upload(file));\r\n\r\n\t\t\tawait idb.set(\"personas\", {\r\n\t\t\t\tid: editingPersona?.id ?? crypto.randomUUID(),\r\n\t\t\t\tname,\r\n\t\t\t\tdescription: desc,\r\n\t\t\t\tpronouns: PRONOUNS_THEY,\r\n\t\t\t\tpicture,\r\n\t\t\t\tlastUpdate: Date.now()\r\n\t\t\t});\r\n\r\n\t\t\tfilePicker.input.value = \"\";\r\n\t\t\tclear();\r\n\t\t\tnameInput.value = \"\";\r\n\t\t\tdescInput.value = \"\";\r\n\t\t\teditingPersona = null;\r\n\t\t});\r\n\r\n\t\tform.addEventListener(\"paste\", e => {\r\n\t\t\tconst file = e.clipboardData?.files[0];\r\n\t\t\tif (!file) return;\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tfilePicker.paste(file);\r\n\t\t});\r\n\r\n\t\tfunction removePersona(id: string) {\r\n\t\t\tif (!confirm(\"confirm deletion\")) return;\r\n\t\t\treturn idb.del(\"personas\", id);\r\n\t\t}\r\n\t\tasync function startEditing(persona: Persona) {\r\n\t\t\teditingPersona = persona;\r\n\t\t\tnameInput.value = persona.name;\r\n\t\t\tdescInput.value = persona.description;\r\n\t\t\tif (persona.picture) {\r\n\t\t\t\tfilePicker.value = persona.picture;\r\n\t\t\t}\r\n\t\t\tnameInput.scrollIntoView({ behavior: \"smooth\" });\r\n\t\t}\r\n\t\tasync function updatePersonaList() {\r\n\t\t\tconst personas = await idb.getAll(\"personas\");\r\n\t\t\tif (!personas.success) return;\r\n\r\n\t\t\tpersonaList.innerHTML = \"\";\r\n\t\t\tconst items = personas.value.reverse().map(p => mudcrack({\r\n\t\t\t\tclassName: \"lineout row settings-persona-item\",\r\n\t\t\t\tattributes: {\r\n\t\t\t\t\t\"data-id\": p.id\r\n\t\t\t\t},\r\n\t\t\t\tcontents: [\r\n\t\t\t\t\tmudcrack({\r\n\t\t\t\t\t\ttagName: \"img\",\r\n\t\t\t\t\t\tclassName: \"shadow\",\r\n\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\tsrc: placeholder(null)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tmudcrack({\r\n\t\t\t\t\t\tclassName: \"list settings-persona-item-main\",\r\n\t\t\t\t\t\tcontents: [\r\n\t\t\t\t\t\t\tmudcrack({\r\n\t\t\t\t\t\t\t\tclassName: \"row-compact\",\r\n\t\t\t\t\t\t\t\tcontents: [\r\n\t\t\t\t\t\t\t\t\tmudcrack({\r\n\t\t\t\t\t\t\t\t\t\ttagName: \"h6\",\r\n\t\t\t\t\t\t\t\t\t\tcontents: p.name\r\n\t\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\t\tmudcrack({\r\n\t\t\t\t\t\t\t\t\t\ttagName: \"button\",\r\n\t\t\t\t\t\t\t\t\t\tclassName: \"lineout\",\r\n\t\t\t\t\t\t\t\t\t\tevents: {\r\n\t\t\t\t\t\t\t\t\t\t\tclick: () => startEditing(p)\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\tcontents: \"edit\"\r\n\t\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\t\tmudcrack({\r\n\t\t\t\t\t\t\t\t\t\ttagName: \"button\",\r\n\t\t\t\t\t\t\t\t\t\tclassName: \"lineout\",\r\n\t\t\t\t\t\t\t\t\t\tevents: {\r\n\t\t\t\t\t\t\t\t\t\t\tclick: () => removePersona(p.id)\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\tcontents: \"delete\"\r\n\t\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\tmudcrack({\r\n\t\t\t\t\t\t\t\tcontents: p.description\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t})\r\n\t\t\t\t]\r\n\t\t\t}));\r\n\r\n\t\t\tpersonas.value.forEach(async ({ picture }, ix) => {\r\n\t\t\t\tif (!picture) return;\r\n\t\t\t\tconst src = await getBlobLink(picture);\r\n\t\t\t\tif (src)\r\n\t\t\t\t\titems[ix].querySelector(\"img\")!.src = src;\r\n\t\t\t});\r\n\r\n\t\t\tif (items.length > 0)\r\n\t\t\t\tpersonaList.append(...items);\r\n\t\t\telse\r\n\t\t\t\tpersonaList.append(mudcrack({\r\n\t\t\t\t\tclassName: \"placeholder\",\r\n\t\t\t\t\tcontents: \"No personas found\"\r\n\t\t\t\t}));\r\n\t\t}\r\n\t\tlisten(async update => {\r\n\t\t\tif (update.storage !== \"idb\") return;\r\n\t\t\tif (update.store !== \"personas\") return;\r\n\r\n\t\t\tupdatePersonaList();\r\n\t\t});\r\n\t\tupdatePersonaList();\r\n\t}\r\n}\r\n", "import { fromTemplateFirst } from \"rampike\";\r\n\r\nconst STORAGE_KEY_THEME = \"theme\";\r\nconst CSS_THEMES_FILE = \"theme.css\";\r\n\r\nexport function initTheme() {\r\n\tconst theme = window.localStorage.getItem(STORAGE_KEY_THEME);\r\n\tif (theme) switchTheme(theme);\r\n\r\n\tconst rules: CSSStyleRule[] = []\r\n\tfor (const ss of Array.from(document.styleSheets))\r\n\t\tif (ss.href?.includes(CSS_THEMES_FILE)) {\r\n\t\t\tconst raw = [...Array.from(ss.cssRules)];\r\n\t\t\trules.push(...raw.filter(r => r.constructor.name === \"CSSStyleRule\") as any);\r\n\t\t}\r\n\r\n\t// @ts-ignore\r\n\tconst themes: RegExpMatchArray[] = rules\r\n\t\t.map(r => r.selectorText.match(/\\.theme-(.*)/))\r\n\t\t.filter(r => r);\r\n\r\n\tdocument.querySelector(\"#settings-themes\")?.append(...themes.map(t => selectorItem(t[1])));\r\n}\r\n\r\nfunction selectorItem(name: string) {\r\n\tconst template = document.querySelector<HTMLTemplateElement>(\"#template-theme-selector\")!;\r\n\tconst button = fromTemplateFirst(template)!;\r\n\t// if (!button) return null;\r\n\tconst themeClassName = `theme-${name}`;\r\n\tbutton.classList.add(themeClassName);\r\n\tbutton.addEventListener(\"click\", () => switchTheme(themeClassName))\r\n\treturn button;\r\n}\r\n\r\nfunction switchTheme(themeClassName: string) {\r\n\tdocument.body.classList.forEach(c => {\r\n\t\tif (c.startsWith(\"theme-\")) document.body.classList.remove(c);\r\n\t});\r\n\tdocument.body.classList.add(themeClassName);\r\n\twindow.localStorage.setItem(STORAGE_KEY_THEME, themeClassName);\r\n}\r\n", "import { RampikeFilePicker } from \"@rampike/filepicker\";\r\nimport { idb, local } from \"@root/persist\";\r\nimport { mudcrack } from \"rampike\";\r\n\r\nexport function initBackup() {\r\n\tconst saveButton = document.querySelector(\"#settings-backup-save\")!;\r\n\tsaveButton.addEventListener(\"click\", backup);\r\n\tconst importPicker = document.querySelector<RampikeFilePicker>(\"#settings-backup-import\")!;\r\n\timportPicker.addEventListener(\"input\", () => restore(importPicker));\r\n}\r\n\r\nasync function backup() {\r\n\tconst [chatContents, chats, personas, scenarios] = (await Promise.all([\r\n\t\tidb.getAll(\"chatContents\"),\r\n\t\tidb.getAll(\"chats\"),\r\n\t\tidb.getAll(\"personas\"),\r\n\t\tidb.getAll(\"scenarios\")\r\n\t])).filter(v => v.success).map(v => v.value);\r\n\tconst localData = {\r\n\t\tengines: local.get(\"engines\"),\r\n\t\trember: local.get(\"rember\"),\r\n\t\ttheme: local.get(\"theme\"),\r\n\t};\r\n\r\n\tconst payload = JSON.stringify({ idb: { chatContents, chats, personas, scenarios }, local: localData });\r\n\r\n\tconst blob = new Blob([payload], { type: \"text/plain\" });\r\n\tconst url = URL.createObjectURL(blob);\r\n\r\n\tmudcrack({\r\n\t\ttagName: \"a\",\r\n\t\tattributes: {\r\n\t\t\thref: url,\r\n\t\t\tdownload: `backup-${new Date().toLocaleString()}.json`\r\n\t\t}\r\n\t}).click();\r\n\r\n\tURL.revokeObjectURL(url);\r\n}\r\n\r\nasync function restore(picker: RampikeFilePicker) {\r\n\tconst file = picker.input.files?.[0];\r\n\tif (!file) return;\r\n\r\n\tconst raw = await file.text();\r\n\tconst parsed = JSON.parse(raw);\r\n\r\n\tconsole.log(parsed.idb)\r\n\tfor (const [store, data] of Object.entries(parsed.idb)) {\r\n\t\tfor (const item of data as any) {\r\n\t\t\t// @ts-ignore\r\n\t\t\tawait idb.set(store, item);\r\n\t\t}\r\n\t}\r\n}\r\n", "import { mudcrack } from \"rampike\";\r\nimport { enginesUnit } from \"./settings/engines\";\r\nimport { personaUnit } from \"./settings/persona\";\r\nimport { RampikeUnit } from \"./types\";\r\nimport { initTheme } from \"@units/settings/themes\";\r\nimport { initBackup } from \"./settings/backup\";\r\n\r\nexport const settingsUnit: RampikeUnit = {\r\n\tinit: () => {\r\n\t\tinitTheme();\r\n\t\tpersonaUnit.init!(undefined);\r\n\t\tenginesUnit.init!(undefined);\r\n\t\tinitBackup();\r\n\t}\r\n}\r\n\r\n", "import { ChatMessage, Engine, Result } from \"./types\";\r\nimport { nothrow, nothrowAsync } from \"./utils\";\r\n\r\n\r\nexport const abortController = new AbortController();\r\n\r\nexport async function runEngine(\r\n\tchat: ChatMessage[],\r\n\tengine: Engine,\r\n\tonChunk: (v: string) => void\r\n): Promise<Result<string, string>> {\r\n\tconst chonks: string[] = [];\r\n\r\n\ttry {\r\n\t\tconst response = await fetch(engine.url, {\r\n\t\t\tmethod: \"POST\",\r\n\t\t\theaders: {\r\n\t\t\t\tAuthorization: `Bearer ${engine.key}`,\r\n\t\t\t\t\"Content-Type\": \"application/json\",\r\n\t\t\t},\r\n\t\t\tbody: JSON.stringify({\r\n\t\t\t\tmodel: engine.model,\r\n\t\t\t\tmessages: chat.map(m => ({\r\n\t\t\t\t\trole: m.from === \"model\" ? \"assistant\" : m.from,\r\n\t\t\t\t\tcontent: m.swipes[m.selectedSwipe]\r\n\t\t\t\t})),\r\n\t\t\t\tstream: true,\r\n\t\t\t\treasoning: {\r\n\t\t\t\t\teffort: \"none\"\r\n\t\t\t\t},\r\n\t\t\t\tmax_completion_tokens: engine.max,\r\n\t\t\t\ttemperature: engine.temp,\r\n\t\t\t\t...engine.params\r\n\t\t\t}),\r\n\t\t\tsignal: abortController.signal\r\n\t\t});\r\n\r\n\t\tconst reader = response.body?.getReader();\r\n\t\tif (!reader) {\r\n\t\t\treturn {\r\n\t\t\t\tsuccess: false,\r\n\t\t\t\terror: \"Response body is not readable\"\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst decoder = new TextDecoder();\r\n\t\tlet buffer = \"\";\r\n\r\n\t\twhile (true) {\r\n\t\t\tconst { done, value } = await reader.read();\r\n\t\t\tif (done) break;\r\n\t\t\r\n\t\t\t// Append new chunk to buffer\r\n\t\t\tbuffer += decoder.decode(value, { stream: true });\r\n\t\t\r\n\t\t\t// Process complete lines from buffer\r\n\t\t\twhile (true) {\r\n\t\t\t\tconst lineEnd = buffer.indexOf(\"\\n\");\r\n\t\t\t\tif (lineEnd === -1) break;\r\n\r\n\t\t\t\tconst line = buffer.slice(0, lineEnd).trim();\r\n\t\t\t\tbuffer = buffer.slice(lineEnd + 1);\r\n\r\n\t\t\t\tif (line.startsWith(\"data: \")) {\r\n\t\t\t\t\tconst data = line.slice(6);\r\n\t\t\t\t\tif (data === \"[DONE]\") break;\r\n\r\n\t\t\t\t\tconst parsed = nothrow<any>(() => JSON.parse(data));\r\n\t\t\t\t\tif (!parsed.success) continue;\r\n\t\t\t\t\tconst content = parsed.value.choices[0].delta.content;\r\n\t\t\t\t\tif (content) {\r\n\t\t\t\t\t\tchonks.push(content);\r\n\t\t\t\t\t\tonChunk(content);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t} catch(e) {\r\n\t\tconsole.error(e);\r\n\t}\r\n\t\r\n\treturn { success: true, value: chonks.join(\"\") };\r\n}\r\n", "import { RampikeTabs } from \"@rampike/tabs\";\r\nimport { getBlobLink, idb, IDBStore } from \"@root/persist\";\r\nimport { runEngine } from \"@root/run\";\r\nimport { Chat, ChatMessage } from \"@root/types\";\r\nimport { nothrowAsync, placeholder, renderMDAsync } from \"@root/utils\";\r\nimport { readEngines } from \"@units/settings/engines\";\r\nimport { RampikeMessageView } from \"./message-view\";\r\n\r\nexport async function setSwipe(chatId: string, messageId: number, swipeIx: number, value: string) {\r\n\tconst contents = await idb.get(\"chatContents\", chatId);\r\n\tif (!contents.success) return;\r\n\r\n\tconst tix = contents.value.messages.findIndex(m => m.id === messageId);\r\n\tif (tix < 0) return;\r\n\r\n\tcontents.value.messages[tix].swipes[swipeIx] = value;\r\n\tawait idb.set(\"chatContents\", contents.value);\r\n}\r\n\r\nexport async function pushSwipe(chatId: string, messageId: number, value: string) {\r\n\tconst [contents, chat] = await Promise.all([\r\n\t\tidb.get(\"chatContents\", chatId),\r\n\t\tidb.get(\"chats\", chatId)\r\n\t]);\r\n\tif (!contents.success || !chat.success) return null;\r\n\tconst messages = contents.value.messages;\r\n\r\n\tconst mix = messages.findIndex(m => m.id === messageId);\r\n\tif (mix < 0) return;\r\n\r\n\tmessages[mix].swipes = messages[mix].swipes.filter(m => m.trim());\r\n\tmessages[mix].swipes.push(value);\r\n\tmessages[mix].selectedSwipe = messages[mix].swipes.length - 1;\r\n\r\n\tchat.value.lastUpdate = Date.now();\r\n\tawait Promise.all([\r\n\t\tidb.set(\"chatContents\", contents.value),\r\n\t\tidb.set(\"chats\", chat.value)\r\n\t]);\r\n\r\n\treturn messages[mix];\r\n}\r\n\r\nexport async function addMessage(chatId: string, value: string, fromUser: boolean, name: string) {\r\n\tconst [contents, chat] = await Promise.all([\r\n\t\tidb.get(\"chatContents\", chatId),\r\n\t\tidb.get(\"chats\", chatId)\r\n\t]);\r\n\tif (!contents.success || !chat.success) return null;\r\n\tconst messages = contents.value.messages;\r\n\r\n\tconst newMessage: ChatMessage = {\r\n\t\tfrom: fromUser ? \"user\" : \"model\",\r\n\t\tid: messages.length,\r\n\t\tname: name,\r\n\t\trember: null,\r\n\t\tselectedSwipe: 0,\r\n\t\tswipes: [value]\r\n\t};\r\n\tmessages.push(newMessage);\r\n\r\n\tchat.value.lastUpdate = Date.now();\r\n\tchat.value.messageCount = messages.length;\r\n\r\n\tawait Promise.all([\r\n\t\tidb.set(\"chatContents\", contents.value),\r\n\t\tidb.set(\"chats\", chat.value)\r\n\t]);\r\n\r\n\treturn newMessage;\r\n}\r\n\r\nexport async function deleteMessage(chatId: string, messageId: number) {\r\n\tconst [contents, chat] = await Promise.all([\r\n\t\tidb.get(\"chatContents\", chatId),\r\n\t\tidb.get(\"chats\", chatId)\r\n\t]);\r\n\tif (!contents.success || !chat.success) return;\r\n\tconst messages = contents.value.messages;\r\n\r\n\tconst mix = messages.findIndex(m => m.id === messageId);\r\n\tif (mix < 0) return;\r\n\r\n\tcontents.value.messages.splice(mix);\r\n\tchat.value.lastUpdate = Date.now();\r\n\tchat.value.messageCount = messages.length;\r\n\r\n\tawait Promise.all([\r\n\t\tidb.set(\"chatContents\", contents.value),\r\n\t\tidb.set(\"chats\", chat.value)\r\n\t]);\r\n\r\n\tconst messageViews = document.querySelectorAll<RampikeMessageView>(\".message[data-mid]\");\r\n\tmessageViews.forEach(m => {\r\n\t\tconst mid = parseInt(m.dataset.mid!, 10);\r\n\t\tif (mid >= messageId) m.remove();\r\n\t});\r\n}\r\n\r\nexport async function reroll(chatId: string, messageId: number, name: string) {\r\n\tconst payload = await prepareRerollPayload(chatId, messageId);\r\n\tif (!payload) return;\r\n\tloadResponse(payload, messageId, chatId, name);\r\n}\r\n\r\n// TODO: Get tail length from settings\r\nconst MESSAGES_TAIL = 10;\r\n\r\nexport async function preparePayload(contents: ChatMessage[], systemPrompt: string, userMessage: string) {\r\n\tconst system: ChatMessage = { from: \"system\", id: -1, name: \"\", rember: null, swipes: [systemPrompt], selectedSwipe: 0 };\r\n\tconst payload: ChatMessage[] = [\r\n\t\tsystem,\r\n\t\t...contents.slice(-MESSAGES_TAIL)\r\n\t];\r\n\tif (!userMessage) return payload;\r\n\r\n\tconst user: ChatMessage = { from: \"user\", id: -1, name: \"\", rember: null, swipes: [userMessage], selectedSwipe: 0 };\r\n\tpayload.push(user);\r\n\treturn payload;\r\n}\r\n\r\nexport async function prepareRerollPayload(chatId: string, messageId: number) {\r\n\tconst [contents, chat] = await Promise.all([\r\n\t\tidb.get(\"chatContents\", chatId),\r\n\t\tidb.get(\"chats\", chatId)\r\n\t]);\r\n\tif (!contents.success || !chat.success) return null;\r\n\t\r\n\tconst messages = contents.value.messages;\r\n\tconst mix = messages.findIndex(m => m.id === messageId);\r\n\tif (mix < 0) return null;\r\n\r\n\tconst history = messages.slice(0, mix);\r\n\r\n\tconst system: ChatMessage = { from: \"system\", id: -1, name: \"\", rember: null, swipes: [chat.value.scenario.definition], selectedSwipe: 0 };\r\n\tconst payload: ChatMessage[] = [\r\n\t\tsystem,\r\n\t\t...history.slice(-MESSAGES_TAIL)\r\n\t];\r\n\r\n\treturn payload;\r\n}\r\n\r\nexport async function loadResponse(payload: ChatMessage[], msgId: number, chatId: string, name: string) {\r\n\tconst inputModes = document.querySelector<RampikeTabs>(\"#chat-controls\")!;\r\n\tinputModes.tab = \"pending\";\r\n\r\n\t// TODO: Pick default engine\r\n\tconst [, engine] = Object.entries(readEngines())[0];\r\n\r\n\tconst messageView = getMessageViewByID(msgId);\r\n\tif (!messageView) {\r\n\t\twindow.location.reload();\r\n\t\treturn;\r\n\t}\r\n\tconst responseMessageControls = messageView.rampike.params;\r\n\tconst responseStreamingUpdater = responseMessageControls.startStreaming();\r\n\r\n\tconst streamingResult = await runEngine(payload, engine, responseStreamingUpdater);\r\n\tif (streamingResult.success) {\r\n\t\tconst updatedMessage = await pushSwipe(chatId, msgId, streamingResult.value);\r\n\t\tif (!updatedMessage) {\r\n\t\t\tconsole.error(\"failed to save response message\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tresponseMessageControls.updateMessage(updatedMessage);\r\n\t}\r\n\r\n\tresponseMessageControls.endStreaming();\r\n\tinputModes.tab = \"main\";\r\n}\r\n\r\nexport async function loadPictures(chat: Chat) {\r\n\treturn await Promise.all([\r\n\t\tchat.userPersona.picture && getBlobLink(chat.userPersona.picture),\r\n\t\tchat.scenario.picture    && getBlobLink(chat.scenario.picture)\r\n\t]);\r\n}\r\n\r\nexport function getMessageViewByID(messageId: number) {\r\n\tconst list = document.querySelector<HTMLDivElement>(\"#play-messages\")!;\r\n\treturn list.querySelector<RampikeMessageView>(`.message[data-mid=\"${messageId}\"]`);\r\n}\r\n", "import { getBlobLink } from \"@root/persist\";\r\nimport { Chat, ChatMessage } from \"@root/types\";\r\nimport { placeholder, renderMDAsync } from \"@root/utils\";\r\nimport { mudcrack, rampike } from \"rampike\";\r\n\r\nexport function makeMessageView(\r\n\tmsg: ChatMessage,\r\n\t[userPic, modelPic]: (string | null)[],\r\n\tisLast: boolean,\r\n\tonEdit: (swipeIx: number, value: string) => void,\r\n\tonReroll: () => void,\r\n\tonDelete: () => void\r\n) {\r\n\tfunction controlButton(caption: string, hint: string, cb: () => void) {\r\n\t\treturn mudcrack({\r\n\t\t\ttagName: \"button\",\r\n\t\t\tclassName: \"strip ghost pointer\",\r\n\t\t\tcontents: caption,\r\n\t\t\tattributes: { title: hint },\r\n\t\t\tevents: { click: cb }\r\n\t\t});\r\n\t}\r\n\r\n\tconst text = msg.swipes[msg.selectedSwipe];\r\n\tconst textBox = mudcrack({\r\n\t\ttagName: \"div\",\r\n\t\tclassName: \"message-text\",\r\n\t\tcontents: text\r\n\t});\r\n\tconst swipesCaption = mudcrack({\r\n\t\ttagName: \"span\",\r\n\t\tcontents: \"\"\r\n\t});\r\n\tconst swipesControl = mudcrack({\r\n\t\ttagName: \"div\",\r\n\t\tclassName: \"row-compact\",\r\n\t\tcontents: [\r\n\t\t\tcontrolButton(\r\n\t\t\t\t\"<\", \"prev swipe\",\r\n\t\t\t\t() => changeSwipe(-1)\r\n\t\t\t),\r\n\t\t\tswipesCaption,\r\n\t\t\tcontrolButton(\r\n\t\t\t\t\"<\", \"next swipe\",\r\n\t\t\t\t() => changeSwipe(+1)\r\n\t\t\t)\r\n\t\t],\r\n\t\tstyle: {\r\n\t\t\tdisplay: \"none\"\r\n\t\t}\r\n\t});\r\n\tasync function changeSwipe(delta: number) {\r\n\t\tmsg.selectedSwipe += delta;\r\n\t\tif (msg.selectedSwipe < 0) msg.selectedSwipe = msg.swipes.length - 1;\r\n\t\tif (msg.selectedSwipe >= msg.swipes.length) msg.selectedSwipe = 0;\r\n\t\ttextBox.innerHTML = await renderMDAsync(msg.swipes[msg.selectedSwipe]);\r\n\t\tswipesCaption.textContent = `${msg.selectedSwipe + 1} / ${msg.swipes.length}`;\r\n\t\tswipesControl.style.display = (isLast && msg.swipes.length > 1) ? \"flex\" : \"none\";\r\n\t}\r\n\tasync function setSwipeToLast() {\r\n\t\tmsg.selectedSwipe = msg.swipes.length - 1;\r\n\t\ttextBox.innerHTML = await renderMDAsync(msg.swipes[msg.selectedSwipe]);\r\n\t\tswipesCaption.textContent = `${msg.selectedSwipe + 1} / ${msg.swipes.length}`;\r\n\t\tswipesControl.style.display = (msg.swipes.length > 1) ? \"flex\" : \"none\";\r\n\t}\r\n\r\n\tfunction tab(contents: string | Element[]) {\r\n\t\treturn mudcrack({\r\n\t\t\ttagName: \"div\",\r\n\t\t\tclassName: \"virtual\",\r\n\t\t\tcontents\r\n\t\t});\r\n\t}\r\n\tconst editButton = controlButton(\r\n\t\t\"\u270E\", \"edit message\",\r\n\t\t() => {\r\n\t\t\ttextBox.setAttribute(\"contenteditable\", \"true\");\r\n\t\t\ttextBox.textContent = msg.swipes[msg.selectedSwipe];\r\n\t\t\ttextBox.focus();\r\n\t\t\tchangeControlsState(\"editing\");\r\n\t\t}\r\n\t);\r\n\tconst rerollButton = controlButton(\r\n\t\t\"\u21BA\", \"reroll this message\",\r\n\t\tonReroll\r\n\t);\r\n\tconst deleteButton = controlButton(\r\n\t\t\"\uD83D\uDDD9\", \"delete message along with following\",\r\n\t\t() => {\r\n\t\t\tif (!confirm(\"all the following messages will be deleted too\")) return;\r\n\t\t\tonDelete();\r\n\t\t}\r\n\t);\r\n\tconst copyButton = controlButton(\r\n\t\t\"\u29C9\", \"copy message\",\r\n\t\t() => navigator.clipboard.writeText(msg.swipes[msg.selectedSwipe])\r\n\t);\r\n\r\n\tfunction updateRerollButtonStatus() {\r\n\t\tif (msg.from === \"model\" && isLast)\r\n\t\t\trerollButton.style.removeProperty(\"display\");\r\n\t\telse\r\n\t\t\trerollButton.style.display = \"none\";\r\n\t}\r\n\tconst mainControls = [\r\n\t\tswipesControl,\r\n\t\teditButton,\r\n\t\tcopyButton,\r\n\t\trerollButton\r\n\t];\r\n\tif (msg.from === \"user\") mainControls.push(deleteButton);\r\n\r\n\tif (msg.from === \"model\" && isLast) {\r\n\t\tmainControls.push(\r\n\t\t\t\r\n\t\t);\r\n\t}\r\n\tconst controls = [\r\n\t\ttab(mainControls),\r\n\t\ttab([\r\n\t\t\tcontrolButton(\r\n\t\t\t\t\"\u2714\", \"save\",\r\n\t\t\t\tasync () => {\r\n\t\t\t\t\tconst newContents = textBox.innerText;\r\n\t\t\t\t\tmsg.swipes[msg.selectedSwipe] = newContents;\r\n\t\t\t\t\ttextBox.removeAttribute(\"contenteditable\");\r\n\t\t\t\t\tchangeControlsState(\"main\");\r\n\t\t\t\t\tonEdit(msg.selectedSwipe, newContents)\r\n\t\t\t\t\t// updateSwipe(meta.id, msg.id, msg.selectedSwipe, newContents);\r\n\t\t\t\t\ttextBox.innerHTML = await renderMDAsync(newContents);\r\n\t\t\t\t}\r\n\t\t\t),\r\n\t\t\tcontrolButton(\r\n\t\t\t\t\"\u2718\", \"cancel\",\r\n\t\t\t\tasync () => {\r\n\t\t\t\t\ttextBox.removeAttribute(\"contenteditable\");\r\n\t\t\t\t\tchangeControlsState(\"main\");\r\n\t\t\t\t\ttextBox.innerHTML = await renderMDAsync(msg.swipes[msg.selectedSwipe]);\r\n\t\t\t\t}\r\n\t\t\t)\r\n\t\t]),\r\n\t\ttab([])\r\n\t];\r\n\tfunction changeControlsState(state: \"main\" | \"editing\" | \"streaming\") {\r\n\t\tconst tix = {\r\n\t\t\tmain: 0,\r\n\t\t\tediting: 1,\r\n\t\t\tstreaming: 2\r\n\t\t}[state];\r\n\t\tcontrols.forEach((tab, i) => tab.style.display = i === tix ? \"contents\" : \"none\");\r\n\t}\r\n\r\n\tconst element = mudcrack({\r\n\t\ttagName: \"div\",\r\n\t\tclassName: \"message\",\r\n\t\tattributes: {\r\n\t\t\t\"data-mid\": String(msg.id)\r\n\t\t},\r\n\t\tcontents: [\r\n\t\t\tmudcrack({\r\n\t\t\t\ttagName: \"img\",\r\n\t\t\t\tattributes: {\r\n\t\t\t\t\tsrc: placeholder(msg.from === \"user\" ? userPic : modelPic)\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t\tmudcrack({\r\n\t\t\t\tcontents: [\r\n\t\t\t\t\tmudcrack({\r\n\t\t\t\t\t\tclassName: \"row\",\r\n\t\t\t\t\t\tcontents: [\r\n\t\t\t\t\t\t\tmudcrack({\r\n\t\t\t\t\t\t\t\tclassName: \"message-name\",\r\n\t\t\t\t\t\t\t\tcontents: msg.name\r\n\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t...controls\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t}),\r\n\t\t\t\t\ttextBox\r\n\t\t\t\t]\r\n\t\t\t})\r\n\t\t]\r\n\t});\r\n\tchangeSwipe(0);\r\n\tchangeControlsState(\"main\");\r\n\tupdateRerollButtonStatus();\r\n\r\n\tfunction updateMessage(value: ChatMessage) {\r\n\t\tmsg = value;\r\n\t}\r\n\tfunction startStreaming() {\r\n\t\ttextBox.removeAttribute(\"contenteditable\");\r\n\t\ttextBox.innerHTML = \"\";\r\n\t\tchangeControlsState(\"streaming\");\r\n\r\n\t\treturn (value: string) => {\r\n\t\t\ttextBox.innerText += value;\r\n\t\t};\r\n\t}\r\n\tfunction endStreaming() {\r\n\t\tsetSwipeToLast();\r\n\t\tchangeControlsState(\"main\");\r\n\t}\r\n\tfunction setIsLast(value: boolean) {\r\n\t\tisLast = value;\r\n\t\tchangeSwipe(0);\r\n\t\tupdateRerollButtonStatus();\r\n\t}\r\n\r\n\tconst viewControls = {\r\n\t\tupdateSwipe: changeSwipe,\r\n\t\tchangeControlsState,\r\n\t\tupdateMessage,\r\n\t\tstartStreaming,\r\n\t\tendStreaming,\r\n\t\tsetIsLast\r\n\t};\r\n\tconst wrapped = rampike(\r\n\t\telement,\r\n\t\tviewControls,\r\n\t\t() => {},\r\n\t\t{ skipInitialRender: true }\r\n\t);\r\n\t// function me() {\r\n\t// \treturn wrapped;\r\n\t// }\r\n\treturn wrapped;\r\n}\r\nexport type RampikeMessageView = ReturnType<typeof makeMessageView>;\r\n", "import { idb } from \"@root/persist\";\r\nimport { deleteMessage, loadPictures, loadResponse, preparePayload, prepareRerollPayload, reroll, setSwipe } from \"./utils\";\r\nimport { makeMessageView } from \"./message-view\";\r\n\r\nexport async function loadMessages(chatId: string) {\r\n\tconst list = document.querySelector<HTMLDivElement>(\"#play-messages\")!;\r\n\tlist.innerHTML = \"\";\r\n\r\n\tconst [contents, meta] = await Promise.all([\r\n\t\tidb.get(\"chatContents\", chatId),\r\n\t\tidb.get(\"chats\", chatId)\r\n\t]);\r\n\tif (!contents.success || !meta.success) return;\r\n\r\n\tconst [userPic, modelPic] = await loadPictures(meta.value);\r\n\r\n\tconst messages = contents.value.messages;\r\n\tconst items = messages.map((item, ix) => {\r\n\t\treturn makeMessageView(\r\n\t\t\titem,\r\n\t\t\t// meta.value,\r\n\t\t\t[userPic, modelPic],\r\n\t\t\tix === messages.length - 1,\r\n\t\t\t(swipeIx, value) => {\r\n\t\t\t\tsetSwipe(chatId, item.id, swipeIx, value);\r\n\t\t\t},\r\n\t\t\t() => reroll(chatId, item.id, meta.value.scenario.name),\r\n\t\t\t() => deleteMessage(chatId, item.id)\r\n\t\t);\r\n\t});\r\n\r\n\tlist.append(...items);\r\n}\r\n", "import { getRoute } from \"@root/utils\";\r\nimport { idb } from \"@root/persist\";\r\nimport { addMessage, deleteMessage, getMessageViewByID, loadPictures, loadResponse, preparePayload, pushSwipe, setSwipe } from \"./utils\";\r\nimport { makeMessageView } from \"./message-view\";\r\n\r\nexport async function sendMessage() {\r\n\tconst list = document.querySelector<HTMLDivElement>(\"#play-messages\")!;\r\n\tconst textarea = document.querySelector<HTMLTextAreaElement>(\"#chat-textarea\")!;\r\n\r\n\tconst message = textarea.value?.trim();\r\n\tif (!message) return;\r\n\r\n\tconst [, chatId] = getRoute();\r\n\tif (!chatId) return;\r\n\r\n\tconst [messages, meta] = await Promise.all([\r\n\t\tidb.get(\"chatContents\", chatId),\r\n\t\tidb.get(\"chats\", chatId)\r\n\t]);\r\n\tif (!messages.success || !meta.success) return;\r\n\r\n\tconst payload = await preparePayload(messages.value.messages, meta.value.scenario.definition, message);\r\n\r\n\tconst lastMessageId = messages.value.messages.findLast(() => true)?.id;\r\n\tgetMessageViewByID(lastMessageId!)?.rampike.params.setIsLast(false);\r\n\r\n\tconst newUserMessage = await addMessage(meta.value.id, message, true, meta.value.userPersona.name);\r\n\tif (!newUserMessage) {\r\n\t\tconsole.error(\"failed to save user message\");\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst userMessage = makeMessageView(\r\n\t\tnewUserMessage,\r\n\t\tawait loadPictures(meta.value),\r\n\t\tfalse,\r\n\t\t// on edit\r\n\t\t(swipeIx, value) => {\r\n\t\t\tsetSwipe(chatId, newUserMessage.id, swipeIx, value);\r\n\t\t},\r\n\t\t// on reroll\r\n\t\t() => { throw Error(\"haha nope\"); },\r\n\t\t() => deleteMessage(chatId, newUserMessage.id)\r\n\t);\r\n\tconst newModelMessage = await addMessage(meta.value.id, \"\", false, meta.value.scenario.name);\r\n\tif (!newModelMessage) {\r\n\t\tconsole.error(\"failed to save user message\");\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst generateSwipe = () => loadResponse(payload, newModelMessage.id, meta.value.id, meta.value.scenario.name);\r\n\r\n\tconst responseMessage = makeMessageView(\r\n\t\tnewModelMessage,\r\n\t\tawait loadPictures(meta.value),\r\n\t\ttrue,\r\n\t\t// on edit\r\n\t\t(swipeIx, value) => {\r\n\t\t\tsetSwipe(chatId, newModelMessage.id, swipeIx, value);\r\n\t\t},\r\n\t\t// reroll\r\n\t\tgenerateSwipe,\r\n\t\t() => { throw Error(\"haha nope\"); }\r\n\t);\r\n\tlist.append(userMessage, responseMessage);\r\n\r\n\tgenerateSwipe();\r\n\r\n\ttextarea.value = \"\";\r\n}\r\n", "import { getRoute, makeResizable } from \"@root/utils\";\r\nimport { RampikeUnit } from \"./types\";\r\nimport { loadMessages } from \"./chat/load\";\r\nimport { RampikeTabs } from \"@rampike/tabs\";\r\nimport { listen } from \"@root/persist\";\r\nimport { readEngines } from \"./settings/engines\";\r\nimport { sendMessage } from \"./chat/send\";\r\nimport { abortController } from \"@root/run\";\r\n\r\nexport const chatUnit: RampikeUnit = {\r\n\tinit: () => {\r\n\t\tconst textarea = document.querySelector<HTMLTextAreaElement>(\"#chat-textarea\")!;\r\n\t\tconst sendButton = document.querySelector<HTMLButtonElement>(\"#chat-send-button\")!;\r\n\t\tconst stopButton = document.querySelector<HTMLButtonElement>(\"#chat-stop-button\")!;\r\n\r\n\t\tmakeResizable(textarea);\r\n\t\twindow.addEventListener(\"hashchange\", update);\r\n\t\tlisten(u => {\r\n\t\t\tif (u.storage !== \"local\") return;\r\n\t\t\tif (u.key !== \"engines\") return;\r\n\t\t\tupdateEngines();\r\n\t\t});\r\n\t\tsendButton.addEventListener(\"click\", sendMessage);\r\n\t\tstopButton.addEventListener(\"click\", () => abortController.abort());\r\n\r\n\t\tupdate();\r\n\t\tupdateEngines();\r\n\t}\r\n};\r\n\r\nasync function update() {\r\n\tconst route = getRoute();\r\n\tif (route[0] !== \"play\") return;\r\n\tif (!route[1]) return;\r\n\r\n\tawait loadMessages(route[1]);\r\n}\r\n\r\nfunction updateEngines() {\r\n\tconst inputModes = document.querySelector<RampikeTabs>(\"#chat-controls\")!;\r\n\r\n\tconst engineMap = readEngines();\r\n\r\n\tconst engineOptions = Object.entries(engineMap);\r\n\tif (engineOptions.length > 0)\r\n\t\tinputModes.tab = \"main\";\r\n\telse\r\n\t\tinputModes.tab = \"disabled\";\r\n}\r\n", "import { RampikeFilePicker } from \"@rampike/filepicker\";\r\nimport { RampikeUnit } from \"./types\";\r\nimport { nothrow, nothrowAsync, placeholder } from \"@root/utils\";\r\nimport { ChatMessage } from \"@root/types\";\r\nimport { idb, listen } from \"@root/persist\";\r\nimport { mudcrack } from \"rampike\";\r\n\r\nexport const mainUnit: RampikeUnit = {\r\n\tinit: () => {\r\n\t\t// const chatImport = document.querySelector<RampikeFilePicker>(\"#main-chats-import\")!;\r\n\t\t// chatImport.addEventListener(\"input\", async () => {\r\n\t\t// \t// todo ask to pick a persona\r\n\t\t// \tconst file = chatImport.input.files?.[0];\r\n\t\t// \tif (!file) return;\r\n\r\n\t\t// \tconst raw = await nothrowAsync(file.text());\r\n\t\t// \tif (!raw.success) return;\r\n\t\t// \tconst messages = raw.value\r\n\t\t// \t\t.split(\"\\n\")\r\n\t\t// \t\t.filter(l => l.trim())\r\n\t\t// \t\t.map(l => nothrow<STCMessage>(JSON.parse(l)))\r\n\t\t// \t\t.filter(c => c.success)\r\n\t\t// \t\t.map((c, ix) => stcToInternal(c.value, ix));\r\n\t\t// });\r\n\r\n\t\tlisten(update => {\r\n\t\t\tif (update.storage !== \"idb\") return;\r\n\t\t\tif (update.store !== \"chats\") return;\r\n\r\n\t\t\tupdateChatHandles();\r\n\t\t});\r\n\t\tupdateChatHandles();\r\n\t}\r\n}\r\n\r\nasync function updateChatHandles() {\r\n\tconst list = document.querySelector(\"#main-chats\")!;\r\n\tconst handles = await idb.getAll(\"chats\");\r\n\tif (!handles.success) return;\r\n\tlist.innerHTML = \"\";\r\n\r\n\tconst items = handles.value.reverse().map(handle => mudcrack({\r\n\t\tclassName: \"lineout row main-chats-item\",\r\n\t\tcontents: [\r\n\t\t\tmudcrack({\r\n\t\t\t\ttagName: \"img\",\r\n\t\t\t\tattributes: {\r\n\t\t\t\t\tsrc: placeholder(null)\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t\tmudcrack({\r\n\t\t\t\tclassName: \"list wide\",\r\n\t\t\t\tcontents: [\r\n\t\t\t\t\tmudcrack({\r\n\t\t\t\t\t\ttagName: \"h2\",\r\n\t\t\t\t\t\tcontents: handle.scenario.name,\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tmudcrack({\r\n\t\t\t\t\t\tclassName: \"hint\",\r\n\t\t\t\t\t\tcontents: messagesCaption(handle.messageCount),\r\n\t\t\t\t\t})\r\n\t\t\t\t]\r\n\t\t\t}),\r\n\t\t\tmudcrack({\r\n\t\t\t\tclassName: \"list\",\r\n\t\t\t\tcontents: [\r\n\t\t\t\t\tmudcrack({\r\n\t\t\t\t\t\ttagName: \"button\",\r\n\t\t\t\t\t\tclassName: \"lineout\",\r\n\t\t\t\t\t\tcontents: \"play\",\r\n\t\t\t\t\t\tevents: {\r\n\t\t\t\t\t\t\tclick: () => window.location.hash = `play.${handle.id}`\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tmudcrack({\r\n\t\t\t\t\t\ttagName: \"button\",\r\n\t\t\t\t\t\tclassName: \"lineout\",\r\n\t\t\t\t\t\tcontents: \"delete\",\r\n\t\t\t\t\t\tevents: {\r\n\t\t\t\t\t\t\tclick: () => deleteChat(handle.id, handle.scenario.name, handle.messageCount)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t]\r\n\t\t\t})\r\n\t\t]\r\n\t}));\r\n\r\n\tif (items.length === 0) list.append(mudcrack({ className: \"placeholder\", contents: \"No chats found\" }));\r\n\tlist.append(...items);\r\n}\r\n\r\nfunction stcToInternal(stc: STCMessage, index: number): ChatMessage {\r\n\treturn {\r\n\t\tid: index,\r\n\t\tfrom: stc.is_system\r\n\t\t\t? \"system\"\r\n\t\t\t: stc.is_user\r\n\t\t\t\t? \"user\"\r\n\t\t\t\t: \"model\",\r\n\t\tname: stc.name,\r\n\t\tswipes: stc.swipes ?? [stc.mes],\r\n\t\tselectedSwipe: 0,\r\n\t\trember: null\r\n\t};\r\n}\r\n\r\ntype STCMessage = {\r\n\tname: string,\r\n\tis_user: boolean,\r\n\tis_system: boolean,\r\n\tmes: string,\r\n\tswipes?: string[]\r\n}\r\n\r\nfunction messagesCaption(count: number) {\r\n\treturn (count % 10 === 1) ? `${count} message` : `${count} messages`;\r\n}\r\n\r\nfunction deleteChat(id: string, name: string, messageCount: number) {\r\n\tconst confirmed = confirm(`Chat with ${name} (${messagesCaption(messageCount)}) will be deleted`);\r\n\tif (!confirmed) return;\r\n\r\n\tidb.del(\"chatContents\", id);\r\n\tidb.del(\"chats\", id);\r\n}\r\n", "import { idb, upload } from \"@root/persist\";\r\nimport { RampikeUnit } from \"./types\";\r\nimport { getRoute, makeResizable, renderMD } from \"@root/utils\";\r\nimport { ScenarioCard } from \"@root/types\";\r\nimport { RampikeImagePicker } from \"@rampike/imagepicker\";\r\n\r\nexport const scenarioUnit: RampikeUnit = {\r\n\tinit: () => {\r\n\t\tconst chatIcon         = document.querySelector<RampikeImagePicker> (\"#scenario-chat-picture\")!;\r\n\t\tconst cardIcon         = document.querySelector<RampikeImagePicker> (\"#scenario-card-picture\")!;\r\n\t\tconst cardTitle        = document.querySelector<HTMLInputElement>   (\"#scenario-card-title\")!;\r\n\t\tconst cardDescription  = document.querySelector<HTMLTextAreaElement>(\"#scenario-description\")!;\r\n\t\tconst cardTags         = document.querySelector<HTMLTextAreaElement>(\"#scenario-tags\")!;\r\n\t\tconst preview          = document.querySelector<HTMLDivElement>     (\"#scenario-preview\")!;\r\n\t\tconst characterName    = document.querySelector<HTMLInputElement>   (\"#scenario-character-name\")!;\r\n\t\tconst defintion        = document.querySelector<HTMLTextAreaElement>(\"#scenario-defintion\")!;\r\n\t\tconst previewButton    = document.querySelector<HTMLButtonElement>  (\"#scenario-preview-button\")!;\r\n\t\tconst submitButton     = document.querySelector<HTMLButtonElement>  (\"#scenario-submit-button\")!;\r\n\t\tmakeResizable(cardDescription);\r\n\t\tmakeResizable(defintion);\r\n\t\tconst messagesControl = initFirstMessages()\r\n\r\n\t\twindow.addEventListener(\"hashchange\", async () => {\r\n\t\t\tconst path = getRoute();\r\n\t\t\tif (path[0] !== \"scenario-editor\") return;\r\n\t\t\tif (path[1]) {\r\n\t\t\t\tconst scenario = await idb.get(\"scenarios\", path[1]);\r\n\t\t\t\tif (!scenario.success) return;\r\n\t\t\t\tcardIcon.value = scenario.value.card.picture ?? \"\";\r\n\t\t\t\tcardTitle.value = scenario.value.card.title;\r\n\t\t\t\tcardDescription.value = scenario.value.card.description;\r\n\t\t\t\tcardTags.value = scenario.value.card.tags.join(\", \");\r\n\r\n\t\t\t\tchatIcon.value = scenario.value.chat.picture ?? \"\";\r\n\t\t\t\tcharacterName.value = scenario.value.chat.name;\r\n\t\t\t\tdefintion.value = scenario.value.chat.definition;\r\n\t\t\t\t\r\n\t\t\t\tmessagesControl.set(scenario.value.chat.initials);\r\n\t\t\t} else {\r\n\t\t\t\tcardIcon.value = \"\";\r\n\t\t\t\tcardTitle.value = \"\";\r\n\t\t\t\tcardDescription.value = \"\";\r\n\t\t\t\tcardTags.value = \"\";\r\n\r\n\t\t\t\tchatIcon.value = \"\";\r\n\t\t\t\tcharacterName.value = \"\";\r\n\t\t\t\tdefintion.value = \"\";\r\n\r\n\t\t\t\tmessagesControl.set([\"\"]);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tsubmitButton.addEventListener(\"click\", async () => {\r\n\t\t\tconst firstMessages = messagesControl.get();\r\n\t\t\tconst required = [\r\n\t\t\t\tcardTitle.value,\r\n\t\t\t\tdefintion.value,\r\n\t\t\t];\r\n\t\t\tif (required.some(v => !v) || firstMessages.length <= 0) return;\r\n\r\n\t\t\tconst cardPicture = await cardIcon.valueHandle();\r\n\t\t\tconst chatPicture = await chatIcon.valueHandle();\r\n\t\t\tconst tags = cardTags.value.trim().split(\",\").map(t => t.trim());\r\n\r\n\t\t\tconst id = getRoute()[1] ?? crypto.randomUUID();\r\n\t\t\tconst payload: ScenarioCard = {\r\n\t\t\t\tid,\r\n\t\t\t\tlastUpdate: Date.now(),\r\n\t\t\t\tcard: {\r\n\t\t\t\t\tpicture: cardPicture,\r\n\t\t\t\t\ttitle: cardTitle.value,\r\n\t\t\t\t\tdescription: cardDescription.value,\r\n\t\t\t\t\ttags\r\n\t\t\t\t},\r\n\t\t\t\tchat: {\r\n\t\t\t\t\tpicture: chatPicture,\r\n\t\t\t\t\tname: characterName.value,\r\n\t\t\t\t\tdefinition: defintion.value,\r\n\t\t\t\t\tinitials: firstMessages\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tawait idb.set(\"scenarios\", payload);\r\n\t\t\twindow.location.hash = \"library\";\r\n\t\t});\r\n\r\n\t\tpreviewButton.addEventListener(\"click\", () => {\r\n\t\t\tconst content = cardDescription.value;\r\n\t\t\tpreview.innerHTML = renderMD(content);\r\n\t\t\tpreview.hidden = false;\r\n\t\t});\r\n\t}\r\n}\r\n\r\nfunction initFirstMessages() {\r\n\tconst messagesControls        = document.querySelector<HTMLElement>        (\"#scenario-messages-clicker\")!;\r\n\tconst messagesControlsButtons = messagesControls.querySelectorAll(\"button\");\r\n\tconst messagesControlsCaption = messagesControls.querySelector(\"div\")!;\r\n\tconst messages                = document.querySelector<HTMLTextAreaElement>(\"#scenario-messages\")!;\r\n\tconst messagesState: string[] = [\"\"];\r\n\tlet messageIndex = 0;\r\n\r\n\tmakeResizable(messages);\r\n\r\n\tfunction clickMessagesPager(delta: number) {\r\n\t\tlet newIndex = messageIndex + delta;\r\n\t\tif (newIndex < 0) newIndex = messagesState.length - 1;\r\n\t\telse if (newIndex >= messagesState.length) {\r\n\t\t\tif (messagesState[messageIndex].trim()) {\r\n\t\t\t\tmessagesState.push(\"\");\r\n\t\t\t} else {\r\n\t\t\t\tnewIndex = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t\tmessageIndex = newIndex;\r\n\t\tupdateMessagesPager();\r\n\t}\r\n\tfunction updateMessagesPager() {\r\n\t\tmessagesControlsCaption.textContent = `${messageIndex + 1}/${messagesState.length}`;\r\n\t\tmessages.value = messagesState[messageIndex];\r\n\t}\r\n\tmessages.addEventListener(\"input\", () => {\r\n\t\tmessagesState[messageIndex] = messages.value;\r\n\t});\r\n\tmessagesControlsButtons[0].addEventListener(\"click\", () => clickMessagesPager(-1));\r\n\tmessagesControlsButtons[1].addEventListener(\"click\", () => clickMessagesPager(+1));\r\n\tupdateMessagesPager();\r\n\r\n\treturn {\r\n\t\tset: (values: string[]) => {\r\n\t\t\tmessagesState.splice(0, messagesState.length);\r\n\t\t\tmessagesState.push(...values);\r\n\t\t\tmessageIndex = 0;\r\n\t\t\tmessages.value = messagesState[messageIndex];\r\n\t\t\tupdateMessagesPager();\r\n\t\t},\r\n\t\tget: () => {\r\n\t\t\treturn messagesState.map(v => v.trim()).filter(v => v);\r\n\t\t}\r\n\t};\r\n}\r\n", "import { idb } from \"@root/persist\";\r\nimport { Chat, Persona, Pronouns, ScenarioCard } from \"@root/types\";\r\nimport { PRONOUNS_THEY } from \"@units/settings/persona\";\r\n\r\nconst PRON_MACROS: Record<string, keyof Pronouns> = {\r\n\t\"{{sub}}\":    \"subjective\",\r\n\t\"{{obj}}\":    \"objective\",\r\n\t\"{{poss}}\":   \"possessiveAdj\",\r\n\t\"{{poss_p}}\": \"possessivePro\",\r\n\t\"{{ref}}\":    \"reflexive\"\r\n};\r\nconst CHAR_NAME_MACRO = \"{{char}}\";\r\nconst USER_NAME_MACRO = \"{{user}}\";\r\nconst PERSONA_MACRO = \"{{persona}}\";\r\n\r\nexport async function start(personaId: string, scenarioId: string) {\r\n\tconst [persona, scenario] = await Promise.all([\r\n\t\tidb.get(\"personas\", personaId),\r\n\t\tidb.get(\"scenarios\", scenarioId)\r\n\t]);\r\n\tif (!persona.success || !scenario.success) return;\r\n\r\n\tconst preparedScenario = prepareScenario(scenario.value, persona.value);\r\n\tconst chatId = crypto.randomUUID();\r\n\tawait Promise.all([\r\n\t\tidb.set(\"chats\", {\r\n\t\t\tid: chatId,\r\n\t\t\tlastUpdate: Date.now(),\r\n\t\t\tmessageCount: 1,\r\n\t\t\tscenario: preparedScenario,\r\n\t\t\tuserPersona: persona.value\r\n\t\t}),\r\n\t\tidb.set(\"chatContents\", {\r\n\t\t\tid: chatId,\r\n\t\t\tmessages: [{\r\n\t\t\t\tid: 0,\r\n\t\t\t\tfrom: \"model\",\r\n\t\t\t\tname: scenario.value.chat.name,\r\n\t\t\t\trember: null,\r\n\t\t\t\tselectedSwipe: 0,\r\n\t\t\t\tswipes: preparedScenario.initials\r\n\t\t\t}]\r\n\t\t})\r\n\t]);\r\n\r\n\twindow.location.hash = `play.${chatId}`;\r\n}\r\n\r\nfunction macros(template: string, pronouns: Pronouns, charName: string, userName: string, persona: string) {\r\n\tfor (const [from, toKey] of Object.entries(PRON_MACROS)) {\r\n\t\ttemplate = template.replaceAll(from, pronouns[toKey]);\r\n\t}\r\n\ttemplate = template.replaceAll(CHAR_NAME_MACRO, charName);\r\n\ttemplate = template.replaceAll(USER_NAME_MACRO, userName);\r\n\ttemplate = template.replaceAll(PERSONA_MACRO, persona);\r\n\treturn template;\r\n}\r\n\r\nfunction prepareScenario(origin: ScenarioCard, persona: Persona): Chat[\"scenario\"] {\r\n\tconst runMacros = (template: string) => macros(\r\n\t\ttemplate,\r\n\t\tpersona.pronouns ?? PRONOUNS_THEY,\r\n\t\torigin.chat.name, persona.name,\r\n\t\tpersona.description\r\n\t);\r\n\t\r\n\treturn {\r\n\t\tid: origin.id,\r\n\t\tpicture: origin.chat.picture || origin.card.picture,\r\n\t\tname: origin.chat.name || origin.card.title,\r\n\t\tdefinition: runMacros(origin.chat.definition),\r\n\t\tinitials: origin.chat.initials.map(runMacros)\r\n\t};\r\n}\r\n", "import { getBlobLink, idb, listen } from \"@root/persist\";\r\nimport { RampikeUnit } from \"./types\";\r\nimport { mudcrack } from \"rampike\";\r\nimport { placeholder, renderMD } from \"@root/utils\";\r\nimport { RampikeModal } from \"@rampike/modal\";\r\nimport { start } from \"./chat/start\";\r\n\r\nlet openerRelay: {\r\n\tscenarioId: string\r\n} | null = null;\r\n\r\nexport const libraryUnit: RampikeUnit = {\r\n\tinit: () => {\r\n\t\tconst startButton = document.querySelector<HTMLButtonElement>(\"#library-start-button\")!;\r\n\t\tconst startPersonaPicker = document.querySelector<HTMLSelectElement>(\"#library-start-persona\")!;\r\n\t\tconst modal = document.querySelector<RampikeModal>(\"#library-start\")!;\r\n\r\n\t\tstartButton.addEventListener(\"click\", async () => {\r\n\t\t\tif (!openerRelay) return;\r\n\t\t\tconst personaId = startPersonaPicker.value;\r\n\t\t\tif (!personaId) return;\r\n\t\t\tawait start(personaId, openerRelay.scenarioId);\r\n\t\t\tmodal.close();\r\n\t\t});\r\n\r\n\t\tlisten(async u => {\r\n\t\t\tif (u.storage !== \"idb\") return;\r\n\t\t\tif (u.store !== \"scenarios\") return;\r\n\r\n\t\t\tupdate();\r\n\t\t});\r\n\t\tupdate();\r\n\t}\r\n};\r\n\r\nasync function update() {\r\n\tconst list = document.querySelector<HTMLElement>(\"#library-cards\")!;\r\n\r\n\tlist.innerHTML = \"\";\r\n\tconst items = await idb.getAll(\"scenarios\");\r\n\tif (!items.success) return;\r\n\r\n\tconst contents = items.value.reverse().map(item => {\r\n\t\tlet icon = mudcrack({\r\n\t\t\ttagName: \"img\",\r\n\t\t\tattributes: {\r\n\t\t\t\tsrc: placeholder(null)\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (item.card.picture) {\r\n\t\t\tgetBlobLink(item.card.picture)\r\n\t\t\t\t.then(src => { if (src) icon.src = src });\r\n\t\t}\r\n\t\tconst description = mudcrack({\r\n\t\t\tclassName: \"scenario-card-description\"\r\n\t\t});\r\n\t\tdescription.innerHTML = renderMD(item.card.description);\r\n\t\treturn mudcrack({\r\n\t\t\tclassName: \"scenario-card lineout\",\r\n\t\t\tcontents: [\r\n\t\t\t\ticon,\r\n\t\t\t\tmudcrack({\r\n\t\t\t\t\tclassName: \"list\",\r\n\t\t\t\t\tcontents: [\r\n\t\t\t\t\t\tmudcrack({\r\n\t\t\t\t\t\t\tclassName: \"row-compact\",\r\n\t\t\t\t\t\t\tcontents: [\r\n\t\t\t\t\t\t\t\tmudcrack({\r\n\t\t\t\t\t\t\t\t\ttagName: \"h6\",\r\n\t\t\t\t\t\t\t\t\tcontents: item.card.title\r\n\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\tmudcrack({\r\n\t\t\t\t\t\t\t\t\ttagName: \"button\",\r\n\t\t\t\t\t\t\t\t\tclassName: \"lineout\",\r\n\t\t\t\t\t\t\t\t\tevents: {\r\n\t\t\t\t\t\t\t\t\t\tclick: () => deleteScenario(item.id, item.card.title)\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tcontents: \"delete\"\r\n\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\tmudcrack({\r\n\t\t\t\t\t\t\t\t\ttagName: \"button\",\r\n\t\t\t\t\t\t\t\t\tclassName: \"lineout\",\r\n\t\t\t\t\t\t\t\t\tevents: {\r\n\t\t\t\t\t\t\t\t\t\tclick: () => {\r\n\t\t\t\t\t\t\t\t\t\t\tdocument.location.hash = `scenario-editor.${item.id}`\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tcontents: \"edit\"\r\n\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\tmudcrack({\r\n\t\t\t\t\t\t\t\t\ttagName: \"button\",\r\n\t\t\t\t\t\t\t\t\tclassName: \"lineout\",\r\n\t\t\t\t\t\t\t\t\tevents: {\r\n\t\t\t\t\t\t\t\t\t\tclick: () => openStartModal(item.id)\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tcontents: \"play\"\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t\tmudcrack({\r\n\t\t\t\t\t\t\ttagName: \"hr\"\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t\tdescription,\r\n\t\t\t\t\t\tmudcrack({\r\n\t\t\t\t\t\t\tclassName: \"scenario-card-tags\",\r\n\t\t\t\t\t\t\tcontents: item.card.tags.map(tag =>\r\n\t\t\t\t\t\t\t\tmudcrack({\r\n\t\t\t\t\t\t\t\t\ttagName: \"span\",\r\n\t\t\t\t\t\t\t\t\tclassName: \"pointer\",\r\n\t\t\t\t\t\t\t\t\tcontents: tag\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t).toReversed()\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t]\r\n\t\t\t\t})\r\n\t\t\t]\r\n\t\t})\r\n\t});\r\n\r\n\tlist.append(...contents);\r\n}\r\n\r\nfunction deleteScenario(id: string, name: string) {\r\n\tconst ok = confirm(`scenario \"${name}\" will be deleted`);\r\n\tif (!ok) return;\r\n\r\n\tidb.del(\"scenarios\", id);\r\n}\r\n\r\nasync function openStartModal(scenario: string) {\r\n\tconst modal = document.querySelector<RampikeModal>(\"#library-start\")!;\r\n\tconst form = modal.querySelector(\"form\")!;\r\n\tconst picker = modal.querySelector<HTMLSelectElement>(\"#library-start-persona\")!;\r\n\r\n\tconst personas = await idb.getAll(\"personas\");\r\n\tif (!personas.success) return;\r\n\r\n\tconst options = personas.value.map(p => mudcrack({\r\n\t\ttagName: \"option\",\r\n\t\tattributes: {\r\n\t\t\tvalue: p.id\r\n\t\t},\r\n\t\tcontents: p.name\r\n\t}));\r\n\tpicker.innerHTML = \"\";\r\n\tpicker.append(...options);\r\n\tif (personas.value.length > 0)\r\n\t\tpicker.value = personas.value[0].id;\r\n\r\n\topenerRelay = {\r\n\t\tscenarioId: scenario\r\n\t};\r\n\r\n\tmodal.open();\r\n}\r\n", "import { define as defineRadio }       from \"@rampike/radio\";\nimport { define as defineTabs }        from \"@rampike/tabs\";\nimport { define as defineModal }       from \"@rampike/modal\";\nimport { define as definePages }       from \"@rampike/pagination\";\nimport { define as defineSVGImport }   from \"@rampike/import\";\nimport { define as defineFilePicker}   from \"@rampike/filepicker\";\nimport { define as defineLabeled }     from \"@rampike/fieldset\";\nimport { define as defineImagePicker } from \"@rampike/imagepicker\";\nimport { navigationUnit } from \"@units/navigation\";\nimport { RampikeUnit }    from \"@units/types\";\nimport { settingsUnit }   from \"@units/settings\";\nimport { chatUnit }       from \"@units/chat\";\nimport { mainUnit }       from \"@units/main\";\nimport { scenarioUnit }   from \"@units/scenario\";\nimport { init as initPersist } from \"./persist\";\nimport { libraryUnit } from \"@units/library\";\n\ndefineTabs();\ndefineRadio();\ndefineModal(\"ram-modal\");\ndefinePages();\ndefineSVGImport(\"ram-import\");\ndefineFilePicker(\"ram-file-picker\");\ndefineImagePicker(\"ram-image-picker\");\ndefineLabeled(\"ram-labeled\");\n\nwindow.addEventListener(\"DOMContentLoaded\", main);\n\nconst units: RampikeUnit[] = [\n\tnavigationUnit,\n\tsettingsUnit,\n\tchatUnit,\n\tmainUnit,\n\tlibraryUnit,\n\tscenarioUnit\n];\n\nasync function main() {\n\tunits.forEach(u => u.init?.(undefined));\n\n\tconst dbAvailable = initPersist();\n\tif (!dbAvailable) alert(\"indexeddb init failed\");\n}\n"],
  "mappings": "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wB,QAAQE,QAAQ;AAE7D,UAAIJ,iBAAiB;AACnB,YAAIpD,MAAM0D,QAAQD,KAAK,GAAG;AACxBF,oBAAUC,QAAQ,IAAIN,WAAWO,KAAK;QACxC,WACEA,SACA,OAAOA,UAAU,YACjBA,MAAME,gBAAgBzE,QACtB;AACAqE,oBAAUC,QAAQ,IAAIH,MAAMI,KAAK;QACnC,OAAO;AACLF,oBAAUC,QAAQ,IAAIC;QACxB;MACF;IACF;AAEA,WAAOF;EACT;AASA,WAASK,aACPN,QACAO,MAAY;AAEZ,WAAOP,WAAW,MAAM;AACtB,YAAMQ,OAAO7E,yBAAyBqE,QAAQO,IAAI;AAElD,UAAIC,MAAM;AACR,YAAIA,KAAKC,KAAK;AACZ,iBAAOzD,QAAQwD,KAAKC,GAAG;QACzB;AAEA,YAAI,OAAOD,KAAKL,UAAU,YAAY;AACpC,iBAAOnD,QAAQwD,KAAKL,KAAK;QAC3B;MACF;AAEAH,eAAStE,eAAesE,MAAM;IAChC;AAEA,aAASU,gBAAa;AACpB,aAAO;IACT;AAEA,WAAOA;EACT;ACjNO,MAAMC,SAAO9E,OAAO,CACzB,KACA,QACA,WACA,WACA,QACA,WACA,SACA,SACA,KACA,OACA,OACA,OACA,SACA,cACA,QACA,MACA,UACA,UACA,WACA,UACA,QACA,QACA,OACA,YACA,WACA,QACA,YACA,MACA,aACA,OACA,WACA,OACA,UACA,OACA,OACA,MACA,MACA,WACA,MACA,YACA,cACA,UACA,QACA,UACA,QACA,MACA,MACA,MACA,MACA,MACA,MACA,QACA,UACA,UACA,MACA,QACA,KACA,OACA,SACA,OACA,OACA,SACA,UACA,MACA,QACA,OACA,QACA,WACA,QACA,YACA,SACA,OACA,QACA,MACA,YACA,UACA,UACA,KACA,WACA,OACA,YACA,KACA,MACA,MACA,QACA,KACA,QACA,UACA,WACA,UACA,UACA,QACA,SACA,UACA,UACA,QACA,UACA,UACA,SACA,OACA,WACA,OACA,SACA,SACA,MACA,YACA,YACA,SACA,MACA,SACA,QACA,MACA,SACA,MACA,KACA,MACA,OACA,SACA,KAAK,CACG;AAEH,MAAM+E,QAAM/E,OAAO,CACxB,OACA,KACA,YACA,eACA,gBACA,gBACA,iBACA,oBACA,UACA,YACA,QACA,QACA,WACA,gBACA,eACA,UACA,QACA,KACA,SACA,YACA,SACA,SACA,aACA,QACA,kBACA,UACA,QACA,YACA,SACA,QACA,QACA,WACA,WACA,YACA,kBACA,QACA,QACA,SACA,UACA,UACA,QACA,YACA,SACA,QACA,SACA,QACA,OAAO,CACC;AAEH,MAAMgF,aAAahF,OAAO,CAC/B,WACA,iBACA,uBACA,eACA,oBACA,qBACA,qBACA,kBACA,gBACA,WACA,WACA,WACA,WACA,WACA,kBACA,WACA,WACA,eACA,gBACA,YACA,gBACA,sBACA,eACA,UACA,cAAc,CACN;AAMH,MAAMiF,gBAAgBjF,OAAO,CAClC,WACA,iBACA,UACA,WACA,aACA,oBACA,kBACA,iBACA,iBACA,iBACA,SACA,aACA,QACA,gBACA,aACA,WACA,iBACA,UACA,OACA,cACA,WACA,KAAK,CACG;AAEH,MAAMkF,WAASlF,OAAO,CAC3B,QACA,YACA,UACA,WACA,SACA,UACA,MACA,cACA,iBACA,MACA,MACA,SACA,WACA,YACA,SACA,QACA,MACA,UACA,SACA,UACA,QACA,QACA,WACA,UACA,OACA,SACA,OACA,UACA,cACA,aAAa,CACL;AAIH,MAAMmF,mBAAmBnF,OAAO,CACrC,WACA,eACA,cACA,YACA,aACA,WACA,WACA,UACA,UACA,SACA,aACA,cACA,kBACA,eACA,MAAM,CACE;AAEH,MAAMoF,OAAOpF,OAAO,CAAC,OAAO,CAAU;AC1RtC,MAAM8E,OAAO9E,OAAO,CACzB,UACA,UACA,SACA,OACA,kBACA,gBACA,wBACA,YACA,cACA,WACA,UACA,WACA,eACA,eACA,WACA,QACA,SACA,SACA,SACA,QACA,WACA,YACA,gBACA,UACA,eACA,YACA,YACA,WACA,OACA,YACA,2BACA,yBACA,YACA,aACA,WACA,gBACA,eACA,QACA,OACA,WACA,UACA,UACA,QACA,QACA,YACA,MACA,SACA,aACA,aACA,SACA,QACA,SACA,QACA,QACA,WACA,QACA,OACA,OACA,aACA,SACA,UACA,OACA,aACA,YACA,SACA,QACA,SACA,WACA,cACA,UACA,QACA,WACA,QACA,WACA,eACA,eACA,WACA,iBACA,uBACA,UACA,WACA,WACA,cACA,YACA,OACA,YACA,OACA,YACA,QACA,QACA,WACA,cACA,SACA,YACA,SACA,QACA,SACA,QACA,QACA,WACA,SACA,OACA,UACA,QACA,SACA,WACA,YACA,SACA,aACA,QACA,UACA,UACA,SACA,SACA,QACA,SACA,MAAM,CACE;AAEH,MAAM+E,MAAM/E,OAAO,CACxB,iBACA,cACA,YACA,sBACA,aACA,UACA,iBACA,iBACA,WACA,iBACA,kBACA,SACA,QACA,MACA,SACA,QACA,iBACA,aACA,aACA,SACA,uBACA,+BACA,iBACA,mBACA,MACA,MACA,KACA,MACA,MACA,mBACA,aACA,WACA,WACA,OACA,YACA,aACA,OACA,YACA,QACA,gBACA,aACA,UACA,eACA,eACA,iBACA,eACA,aACA,oBACA,gBACA,cACA,gBACA,eACA,MACA,MACA,MACA,MACA,cACA,YACA,iBACA,qBACA,UACA,QACA,MACA,mBACA,MACA,OACA,aACA,KACA,MACA,MACA,MACA,MACA,WACA,aACA,cACA,YACA,QACA,gBACA,kBACA,gBACA,oBACA,kBACA,SACA,cACA,cACA,gBACA,gBACA,eACA,eACA,oBACA,aACA,OACA,QACA,aACA,SACA,UACA,QACA,OACA,QACA,cACA,UACA,YACA,WACA,SACA,UACA,eACA,UACA,YACA,eACA,QACA,cACA,uBACA,oBACA,gBACA,UACA,iBACA,uBACA,kBACA,KACA,MACA,MACA,UACA,QACA,QACA,eACA,aACA,WACA,UACA,UACA,SACA,QACA,mBACA,SACA,oBACA,oBACA,gBACA,eACA,gBACA,eACA,cACA,gBACA,oBACA,qBACA,kBACA,mBACA,qBACA,kBACA,UACA,gBACA,SACA,gBACA,kBACA,YACA,eACA,WACA,WACA,aACA,oBACA,eACA,mBACA,kBACA,cACA,QACA,MACA,MACA,WACA,UACA,WACA,cACA,WACA,cACA,iBACA,iBACA,SACA,gBACA,QACA,gBACA,oBACA,oBACA,KACA,MACA,MACA,SACA,KACA,MACA,MACA,KACA,YAAY,CACJ;AAEH,MAAMkF,SAASlF,OAAO,CAC3B,UACA,eACA,SACA,YACA,SACA,gBACA,eACA,cACA,cACA,SACA,OACA,WACA,gBACA,YACA,SACA,SACA,UACA,QACA,MACA,WACA,UACA,iBACA,UACA,UACA,kBACA,aACA,YACA,eACA,WACA,WACA,iBACA,YACA,YACA,QACA,YACA,YACA,cACA,WACA,UACA,UACA,eACA,iBACA,wBACA,aACA,aACA,cACA,YACA,kBACA,kBACA,aACA,WACA,SACA,OAAO,CACR;AAEM,MAAMqF,MAAMrF,OAAO,CACxB,cACA,UACA,eACA,aACA,aAAa,CACL;ACpXH,MAAMsF,gBAAgBrF,KAAK,2BAA2B;AACtD,MAAMsF,WAAWtF,KAAK,uBAAuB;AAC7C,MAAMuF,cAAcvF,KAAK,eAAe;AACxC,MAAMwF,YAAYxF,KAAK,8BAA8B;AACrD,MAAMyF,YAAYzF,KAAK,gBAAgB;AACvC,MAAM0F,iBAAiB1F;IAC5B;;;AAEK,MAAM2F,oBAAoB3F,KAAK,uBAAuB;AACtD,MAAM4F,kBAAkB5F;IAC7B;;;AAEK,MAAM6F,eAAe7F,KAAK,SAAS;AACnC,MAAM8F,iBAAiB9F,KAAK,0BAA0B;;;;;;;;;;;;;;ACsB7D,MAAM+F,YAAY;IAChBnC,SAAS;IACToC,WAAW;IACXb,MAAM;IACNc,cAAc;IACdC,iBAAiB;;IACjBC,YAAY;;IACZC,wBAAwB;IACxBC,SAAS;IACTC,UAAU;IACVC,cAAc;IACdC,kBAAkB;IAClBC,UAAU;;;AAGZ,MAAMC,YAAY,SAAZA,aAAY;AAChB,WAAO,OAAOC,WAAW,cAAc,OAAOA;EAChD;AAUA,MAAMC,4BAA4B,SAA5BA,2BACJC,cACAC,mBAAoC;AAEpC,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",
  "names": ["v", "v", "TAG_NAME", "TAG_NAME", "b", "define", "mudcrack", "options", "tagName", "elementOptions", "el", "soilborne", "source", "attributes", "className", "style", "events", "contents", "styleKey", "typedKeys", "attributeKey", "eventKey", "e", "value", "defaultOptions", "rampike", "params", "render", "skipInitialRender", "root", "fromTemplateFirst", "template", "extractElements", "extractElements", "template", "contents", "elements", "node", "define", "TAG_NAME", "i", "define", "TAG_NAME", "c", "v", "define", "define", "define", "_getDefaults", "_defaults", "changeDefaults", "newDefaults", "noopTest", "edit", "regex", "opt", "source", "obj", "name", "val", "valSource", "other", "supportsLookbehind", "bull", "indent", "newline", "blockCode", "fences", "hr", "heading", "bullet", "lheadingCore", "lheading", "lheadingGfm", "_paragraph", "blockText", "_blockLabel", "def", "list", "_tag", "_comment", "html", "paragraph", "blockquote", "blockNormal", "gfmTable", "blockGfm", "blockPedantic", "escape", "inlineCode", "br", "inlineText", "_punctuation", "_punctuationOrSpace", "_notPunctuationOrSpace", "punctuation", "_punctuationGfmStrongEm", "_punctuationOrSpaceGfmStrongEm", "_notPunctuationOrSpaceGfmStrongEm", "blockSkip", "emStrongLDelimCore", "emStrongLDelim", "emStrongLDelimGfm", "emStrongRDelimAstCore", "emStrongRDelimAst", "emStrongRDelimAstGfm", "emStrongRDelimUnd", "anyPunctuation", "autolink", "_inlineComment", "tag", "_inlineLabel", "link", "reflink", "nolink", "reflinkSearch", "_caseInsensitiveProtocol", "inlineNormal", "inlinePedantic", "inlineGfm", "inlineBreaks", "block", "inline", "escapeReplacements", "getEscapeReplacement", "ch", "encode", "cleanUrl", "href", "splitCells", "tableRow", "count", "row", "match", "offset", "str", "escaped", "curr", "cells", "i", "rtrim", "c", "invert", "l", "suffLen", "currChar", "findClosingBracket", "b", "level", "outputLink", "cap", "raw", "lexer", "rules", "title", "text", "token", "indentCodeCompensation", "matchIndentToCode", "indentToCode", "node", "matchIndentInNode", "indentInNode", "_Tokenizer", "options", "src", "trimmed", "lines", "tokens", "inBlockquote", "currentLines", "currentRaw", "currentText", "top", "lastToken", "oldToken", "newText", "newToken", "isordered", "itemRegex", "endsWithBlankLine", "endEarly", "itemContents", "line", "t", "nextLine", "blankLine", "nextBulletRegex", "hrRegex", "fencesBeginRegex", "headingBeginRegex", "htmlBeginRegex", "rawLine", "nextLineWithoutTabs", "lastItem", "item", "taskRaw", "checkboxToken", "spacers", "hasMultipleLineBreaks", "headers", "aligns", "rows", "align", "cell", "trimmedUrl", "rtrimSlash", "lastParenIndex", "linkLen", "links", "linkString", "maskedSrc", "prevChar", "lLength", "rDelim", "rLength", "delimTotal", "midDelimTotal", "endReg", "lastCharLength", "hasNonSpaceChars", "hasSpaceCharsOnBothEnds", "prevCapZero", "_Lexer", "__Lexer", "next", "lastParagraphClipped", "extTokenizer", "cutSrc", "startIndex", "tempSrc", "tempStart", "getStartIndex", "errMsg", "keepPrevChar", "_Renderer", "lang", "langString", "code", "depth", "ordered", "start", "body", "j", "type", "startAttr", "checked", "header", "k", "content", "cleanHref", "out", "_TextRenderer", "_Parser", "__Parser", "anyToken", "genericToken", "ret", "renderer", "_Hooks", "markdown", "Marked", "args", "callback", "values", "tableToken", "listToken", "childTokens", "extensions", "pack", "opts", "ext", "prevRenderer", "extLevel", "prop", "rendererProp", "rendererFunc", "tokenizer", "tokenizerProp", "tokenizerFunc", "prevTokenizer", "hooks", "hooksProp", "hooksFunc", "prevHook", "arg", "walkTokens", "packWalktokens", "blockType", "origOpt", "throwError", "processedSrc", "processedTokens", "e", "silent", "async", "msg", "markedInstance", "marked", "setOptions", "use", "parseInline", "parser", "_Parser", "lexer", "_Lexer", "entries", "setPrototypeOf", "isFrozen", "getPrototypeOf", "getOwnPropertyDescriptor", "Object", "freeze", "seal", "create", "apply", "construct", "Reflect", "x", "func", "thisArg", "_len", "arguments", "length", "args", "Array", "_key", "Func", "_len2", "_key2", "arrayForEach", "unapply", "prototype", "forEach", "arrayLastIndexOf", "lastIndexOf", "arrayPop", "pop", "arrayPush", "push", "arraySplice", "splice", "stringToLowerCase", "String", "toLowerCase", "stringToString", "toString", "stringMatch", "match", "stringReplace", "replace", "stringIndexOf", "indexOf", "stringTrim", "trim", "objectHasOwnProperty", "hasOwnProperty", "regExpTest", "RegExp", "test", "typeErrorCreate", "unconstruct", "TypeError", "lastIndex", "_len3", "_key3", "_len4", "_key4", "addToSet", "set", "array", "transformCaseFunc", "l", "element", "lcElement", "cleanArray", "index", "isPropertyExist", "clone", "object", "newObject", "property", "value", "isArray", "constructor", "lookupGetter", "prop", "desc", "get", "fallbackValue", "html", "svg", "svgFilters", "svgDisallowed", "mathMl", "mathMlDisallowed", "text", "xml", "MUSTACHE_EXPR", "ERB_EXPR", "TMPLIT_EXPR", "DATA_ATTR", "ARIA_ATTR", "IS_ALLOWED_URI", "IS_SCRIPT_OR_DATA", "ATTR_WHITESPACE", "DOCTYPE_NAME", "CUSTOM_ELEMENT", "NODE_TYPE", "attribute", "cdataSection", "entityReference", "entityNode", "progressingInstruction", "comment", "document", "documentType", "documentFragment", "notation", "getGlobal", "window", "_createTrustedTypesPolicy", "trustedTypes", "purifyHostElement", "createPolicy", "suffix", "ATTR_NAME", "hasAttribute", "getAttribute", "policyName", "createHTML", "createScriptURL", "scriptUrl", "_", "console", "warn", "_createHooksMap", "afterSanitizeAttributes", "afterSanitizeElements", "afterSanitizeShadowDOM", "beforeSanitizeAttributes", "beforeSanitizeElements", "beforeSanitizeShadowDOM", "uponSanitizeAttribute", "uponSanitizeElement", "uponSanitizeShadowNode", "createDOMPurify", "undefined", "DOMPurify", "root", "version", "VERSION", "removed", "nodeType", "Element", "isSupported", "originalDocument", "currentScript", "DocumentFragment", "HTMLTemplateElement", "Node", "NodeFilter", "NamedNodeMap", "MozNamedAttrMap", "HTMLFormElement", "DOMParser", "ElementPrototype", "cloneNode", "remove", "getNextSibling", "getChildNodes", "getParentNode", "template", "createElement", "content", "ownerDocument", "trustedTypesPolicy", "emptyHTML", "implementation", "createNodeIterator", "createDocumentFragment", "getElementsByTagName", "importNode", "hooks", "createHTMLDocument", "EXPRESSIONS", "ALLOWED_TAGS", "DEFAULT_ALLOWED_TAGS", "TAGS", "ALLOWED_ATTR", "DEFAULT_ALLOWED_ATTR", "ATTRS", "CUSTOM_ELEMENT_HANDLING", "tagNameCheck", "writable", "configurable", "enumerable", "attributeNameCheck", "allowCustomizedBuiltInElements", "FORBID_TAGS", "FORBID_ATTR", "EXTRA_ELEMENT_HANDLING", "tagCheck", "attributeCheck", "ALLOW_ARIA_ATTR", "ALLOW_DATA_ATTR", "ALLOW_UNKNOWN_PROTOCOLS", "ALLOW_SELF_CLOSE_IN_ATTR", "SAFE_FOR_TEMPLATES", "SAFE_FOR_XML", "WHOLE_DOCUMENT", "SET_CONFIG", "FORCE_BODY", "RETURN_DOM", "RETURN_DOM_FRAGMENT", "RETURN_TRUSTED_TYPE", "SANITIZE_DOM", "SANITIZE_NAMED_PROPS", "SANITIZE_NAMED_PROPS_PREFIX", "KEEP_CONTENT", "IN_PLACE", "USE_PROFILES", "FORBID_CONTENTS", "DEFAULT_FORBID_CONTENTS", "DATA_URI_TAGS", "DEFAULT_DATA_URI_TAGS", "URI_SAFE_ATTRIBUTES", "DEFAULT_URI_SAFE_ATTRIBUTES", "MATHML_NAMESPACE", "SVG_NAMESPACE", "HTML_NAMESPACE", "NAMESPACE", "IS_EMPTY_INPUT", "ALLOWED_NAMESPACES", "DEFAULT_ALLOWED_NAMESPACES", "MATHML_TEXT_INTEGRATION_POINTS", "HTML_INTEGRATION_POINTS", "COMMON_SVG_AND_HTML_ELEMENTS", "PARSER_MEDIA_TYPE", "SUPPORTED_PARSER_MEDIA_TYPES", "DEFAULT_PARSER_MEDIA_TYPE", "CONFIG", "formElement", "isRegexOrFunction", "testValue", "Function", "_parseConfig", "cfg", "ADD_URI_SAFE_ATTR", "ADD_DATA_URI_TAGS", "ALLOWED_URI_REGEXP", "ADD_TAGS", "ADD_ATTR", "ADD_FORBID_CONTENTS", "table", "tbody", "TRUSTED_TYPES_POLICY", "ALL_SVG_TAGS", "ALL_MATHML_TAGS", "_checkValidNamespace", "parent", "tagName", "namespaceURI", "parentTagName", "Boolean", "_forceRemove", "node", "removeChild", "_removeAttribute", "name", "getAttributeNode", "from", "removeAttribute", "setAttribute", "_initDocument", "dirty", "doc", "leadingWhitespace", "matches", "dirtyPayload", "parseFromString", "documentElement", "createDocument", "innerHTML", "body", "insertBefore", "createTextNode", "childNodes", "call", "_createNodeIterator", "SHOW_ELEMENT", "SHOW_COMMENT", "SHOW_TEXT", "SHOW_PROCESSING_INSTRUCTION", "SHOW_CDATA_SECTION", "_isClobbered", "nodeName", "textContent", "attributes", "hasChildNodes", "_isNode", "_executeHooks", "currentNode", "data", "hook", "_sanitizeElements", "allowedTags", "firstElementChild", "_isBasicCustomElement", "parentNode", "childCount", "i", "childClone", "__removalCount", "expr", "_isValidAttribute", "lcTag", "lcName", "_sanitizeAttributes", "hookEvent", "attrName", "attrValue", "keepAttr", "allowedAttributes", "forceKeepAttr", "attr", "initValue", "getAttributeType", "setAttributeNS", "_sanitizeShadowDOM", "fragment", "shadowNode", "shadowIterator", "nextNode", "sanitize", "importedNode", "returnNode", "appendChild", "firstChild", "nodeIterator", "shadowroot", "shadowrootmode", "serializedHTML", "outerHTML", "doctype", "setConfig", "clearConfig", "isValidAttribute", "tag", "addHook", "entryPoint", "hookFunction", "removeHook", "removeHooks", "removeAllHooks", "update", "d", "l", "update", "v", "define", "b", "update", "k", "update", "c", "v", "m", "m", "text", "tab", "i", "u", "update", "v", "u", "update", "define", "u"]
}
